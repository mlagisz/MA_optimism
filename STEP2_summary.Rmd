---
title: "summary"
author: "ML"
date: "11/29/2017"
output: html_document
---

# MA of cognitive bias (optimism) in animal studies.

## STEP2 - summarising data

```{r setup, eval=TRUE}
sessionInfo()
options(scipen=100)

#install.packages("devtools","fulltxt")
#library(readxl)
#update.packages("fulltxt")
#devtools::install_github("ropensci/rotl", dependencies = TRUE, build_vignette=TRUE)
#install.packages("rotl")
pacman::p_load(tidyverse, magrittr, fulltext, rotl, ape, dplyr, tidyr, rotl, fulltext, metafor, car)
```

```{r load data, eval=TRUE} 
######## load merged (latency+proportion) data
dat <- read.csv("data_with_ES.csv")
dim(dat) #265 70
str(dat)
names(dat)
```


```{r plot d vs Vd all data, eval=TRUE} 
######## load merged (latency+proportion) data
plot(dat$d, dat$Vd, col=dat$MeasureType)
```


```{r check continuous variables, eval=TRUE} 
names(dat)
hist(as.numeric(dat$Year)) #some "Unpublished" messing this up
dat$Year[which(dat$Year == "Unpublished")] <- "NA" #substitute "Unpublished" with NA
dat$Year2 <- as.numeric(levels(dat$Year))[dat$Year]
hist(dat$Year2)
hist(dat$BetterN)  
hist(dat$WorseN)
plot(dat$Year2, dat$d)
```

```{r check categorical variables, eval=TRUE} 
#one-way tables
table(dat$Species_Latin)
table(dat$Taxa) #mostly mammals and birds
table(dat$Sex) #mosty females
table(dat$Age) #mosty adults
table(dat$AffectManipCat) #mostly stress
table(dat$AffectManipTiming) #mostly long-term, then before
table(dat$StudyDesign) #mostly between
table(dat$CrossoverDesign)
table(dat$Automated) #usually no (or no info)
#table(table(dat$Automated, dat$ArticleID)[2,]>0) #number of papers with automation 6
table(dat$Blind) #usually no (or no info)
#table(table(dat$Blind, dat$ArticleID)[2,]>0) #number of papers with blinding 12
table(dat$FoodDeprived) #usually no
table(dat$CueTypeCat) #mostly spatial or visual
table(dat$ComparisonCategory) #mostly Benign-Worse
table(dat$ReinforcementCat) # mostly R-P, then R-Null
table(dat$AmbigReinforced) #mostly no
table(dat$TaskType) # 202 go/no-go, 63 active choice
table(dat$MeasureType) #approx. half latency

#two-way tables
addmargins(table(dat$ArticleID, dat$MeasureType)) #a few studies with both latency and proportion
addmargins(table(dat$ArticleID, dat$Sex)) #a few studies with both sexes separated
addmargins(table(dat$ArticleID, dat$AffectManipCat)) #a few studies with two types of manipulation
addmargins(table(dat$ArticleID, dat$StudyDesign)) #one study with both within and between subject data
addmargins(table(dat$ArticleID, dat$ComparisonCategory)) #one study with more than one comparison type
addmargins(table(dat$Measure, dat$Sex)) #a few studies with both sexes separated
#sapply(tapply(dat$ExperimentID, dat$ArticleID, unique), paste) #a few studies with more than one experiment
#sapply(tapply(dat$GroupID, dat$ArticleID, unique), paste) #a few studies with more than one group of animals
table(dat$Blind, dat$StudyDesign) 
table(dat$StudyDesign, dat$Blind) 
table(dat$Blind, dat$ComparisonCategory) 
table(dat$StudyDesign, dat$ReinforcementCat) 
table(dat$Blind, dat$ReinforcementCat) 
table(dat$FoodDeprived, dat$ReinforcementCat) 
table(dat$MeasureType, dat$Sex) 
```


### simple boxplots

```{r boxplots} 
par(mar=c(12,4,2,0))
boxplot(dat$d ~ dat$Species_Latin, las=2, ylab="Hg", varwidth=TRUE)
par(mar=c(4,4,2,0))
boxplot(dat$d ~ dat$Taxa, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$Sex, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$MeasureType, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$AffectManipCat, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$StudyDesign, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$CrossoverDesign, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$Blind, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$Automated, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$FoodDeprived, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$AmbigReinforced, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$CueTypeCat, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$ComparisonCategory, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$AffectManipTiming, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$Stress, ylab="Hg", varwidth=TRUE)
boxplot(dat$d ~ dat$ReinforcementCat, ylab="Hg", varwidth=TRUE)

```


### TABLE OF INCLUDED PUBLICATIONS

```{r table inculded papers} 
dat_gr <-  group_by(dat, ArticleID)
countES <- dplyr::summarise(dat_gr, k=n())
pastecols <- dplyr::summarise(dat_gr, first(Species_Latin), toString(unique(Taxa)), toString(unique(Captive_Wild.caught)), toString(unique(Sex)), toString(unique(Age)), toString(unique(AffectManipCat)), toString(unique(Stress)), toString(unique(AffectManipTiming)), toString(unique(FoodDeprived)), toString(unique(TaskType)),toString(unique(CueTypeCat)),toString(unique(AmbigReinforced)), toString(unique(StudyDesign)), toString(unique(Blind)), toString(unique(Automated)), toString(unique(ComparisonCategory)), toString(unique(ReinforcementCat)), toString(unique(MeasureType)))

tab <- data.frame(pastecols, countES$k)
names(tab) <- c("Reference", "Species", "Taxon", "Origin", "Sex", "Age", "Manipulation", "Stress", "Manipulation timing", "Food deprivation", "Task type","Cue", "Ambiguous reinforced", "Design", "Blinding", "Automation", "Comparison", "Reinforcement", "Measure", "k")
tab <- dplyr::arrange(tab, Reference)
write.csv(tab,"tables/papers_table.csv")

#for Systematic Review summary diagram:
table(tab$Species)
table(tab$Taxon)
table(tab$Sex)
table(tab$Origin)
table(tab$Age)
table(tab$Design)
table(tab$Stress)
table(tab$Manipulation)
table(tab$Comparison)
table(tab$`Food deprivation`)
table(tab$`Task type`)
table(tab$Cue)
table(tab$Reinforcement)
table(tab$Automation)
table(tab$Measure)
table(tab$`Ambiguous reinforced`)
table(tab$`Manipulation timing`)
```



###############################################################################

NEXT: "STEP3_models.Rmd"
