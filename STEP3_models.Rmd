---
title: "meta-analysis"
author: "ML"
date: "6/12/2017"
output: html_document
---

# MA of cognitive bias (optimism) in animal studies.

## STEP3 - MA modelling

(originally script: "Meta-Analaysis_merged_ML2.R")


```{r setup}
sessionInfo()
options(scipen=100)
pacman::p_load(tidyverse, magrittr, fulltext, rotl, ape, dplyr, tidyr, rotl, fulltext, metafor, car, robumeta)
#source("functions.R")
```

```{r load data} 
dat <- read.csv("data_with_ES_subsets.csv")
dim(dat) #264
str(dat) 
names(dat)

### SUBSETS by MeasureType:
table(dat$MeasureType) # 138 "latency", 126 "proportion"
dat_lat <- dplyr::filter(dat, MeasureType == "latency") #subset latency data
dim(dat_lat) 
dat_lat <- droplevels(dat_lat) 
str(dat_lat) #only 13 species
dat_prop <- dplyr::filter(dat, MeasureType == "proportion") #subset proportion data
dim(dat_prop)
dat_prop <- droplevels(dat_prop) 
str(dat_prop) #only 15 species


### SUBSETS by picking only one ES from the curves/tests with 3 ScalePoints (A,B,C) [we use the columns that code already code these choices):
dat_max_ES <- dplyr::filter(dat, max_ES == 1) #subset by picking maximum ES from each triplet (i.e. get the most positive=optimistic response available)
dim(dat_max_ES) 
dat_max_absES <- dplyr::filter(dat, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)
dim(dat_max_absES) 
dat_max_meanES <- dplyr::filter(dat, biggest_meandir == 1) #subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the response)
dim(dat_max_meanES) 
dat_B_ES <- dplyr::filter(dat, ScalePoint == "B") #subset by picking only middle (B) ES from each triplet
dim(dat_B_ES) 
```

```{r VCV matrices} 
## prepare VCV matrix - all data
VCV <- make_VCV_matrix(data = dat, V = "Vd", cluster = "GroupID", obs = "EffectID")

## prepare VCV matrix - proportion data
VCV_prop <- make_VCV_matrix(data = dat_prop, V = "Vd", cluster = "GroupID", obs = "EffectID")

## prepare VCV matrix - latency data
VCV_lat <- make_VCV_matrix(data = dat_lat, V = "Vd", cluster = "GroupID", obs = "EffectID")

## prepare VCV matrix - dat_max_ES data
VCV_max_ES <- make_VCV_matrix(data = dat_max_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")

## prepare VCV matrix - dat_max_ES data
VCV_B_ES <- make_VCV_matrix(data = dat_B_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")

## prepare VCV matrix - latency data
VCV_max_absES <- make_VCV_matrix(data = dat_max_absES, V = "Vd", cluster = "GroupID", obs = "EffectID")

## prepare VCV matrix - latency data
VCV_max_meanES <- make_VCV_matrix(data = dat_max_meanES, V = "Vd", cluster = "GroupID", obs = "EffectID")
```

```{r phylo matrices} 
## prepare species correlation matrix - all data (also usable for  ES subsets from ScalePoint triplets)
tree <- read.tree(file="tree_all.tre")
is.binary.tree(tree) #TRUE
is.ultrametric(tree) #TRUE
# plot(tree, cex=0.8) #plot with branch lengths
CorMatrix_all <- vcv(tree, corr=TRUE)
#setdiff(colnames(CorMatrix_all), unique(dat$Species_Latin)) #all ok

## prepare species correlation matrix - proportion data
setdiff(unique(dat$Species_Latin), unique(dat_prop$Species_Latin) ) #missing species
tree_prop <- drop.tip(tree, setdiff(unique(dat$Species_Latin), unique(dat_prop$Species_Latin) )) # remove missing species from the tree
is.binary.tree(tree_prop) #TRUE
is.ultrametric(tree_prop) #TRUE
#plot(tree_prop)
CorMatrix_prop <- vcv(tree_prop, corr=TRUE)
#setdiff(colnames(CorMatrix_prop), unique(dat_prop$Species_Latin)) #all ok

## prepare species correlation matrix - latency data
setdiff(unique(dat$Species_Latin), unique(dat_lat$Species_Latin) ) #missing species
tree_lat <- drop.tip(tree, setdiff(unique(dat$Species_Latin), unique(dat_lat$Species_Latin) )) # remove missing species from the tree
is.binary.tree(tree_lat) #TRUE
is.ultrametric(tree_lat) #TRUE
#plot(tree_lat)
CorMatrix_lat <- vcv(tree_lat, corr=TRUE)
#setdiff(colnames(CorMatrix_lat), unique(dat_lat$Species_Latin)) #all ok
```


###############################################################################################################
#########################################       META-ANALYSIS       ########################################### 
###############################################################################################################

########################################################
#### All data points (full data set) - preliminary

```{r MA all data prelim} 
#sorting out random effects

######## random-effect model (no VCV matrix, no phylogeny)
MA_all_null <- rma.mv(yi=d, V=Vd, data = dat, method="ML") 
MA_all_study <- rma.mv(yi=d, V=Vd,  random=list(~1|ArticleID), data = dat, method="ML") 
anova(MA_all_study, MA_all_null) #ArticleID important

MA_all_species <- rma.mv(yi=d, V=Vd,  random=list(~1|ArticleID, ~1|Species_Latin), data = dat, method="ML") 
anova(MA_all_species, MA_all_study) #Species not important

MA_all_random <- rma.mv(yi=d, V=Vd, random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), data = dat, method="ML") 
anova(MA_all_random, MA_all_study) #full better

MA_all_random2 <- rma.mv(yi=d, V=Vd, random=list(~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), data = dat, method="ML") 
anova(MA_all_random, MA_all_random2) #species no diff

MA_all_random3 <- rma.mv(yi=d, V=Vd, random=list(~1|ArticleID, ~1|GroupID, ~1|EffectID), data = dat, method="ML") 
anova(MA_all_random, MA_all_random3) #experiment no diff

MA_all_random4 <- rma.mv(yi=d, V=Vd, random=list(~1|ExperimentID, ~1|EffectID), data = dat, method="ML") 
anova(MA_all_random, MA_all_random4) #group no diff
```


########################################################
#### All data points (full data set)

```{r MA all data} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_all_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MA_all_random) 
calc.I2(dat$Vd, MA_all_random) 
save(MA_all_random, file = "Rdata/MA_all_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_all_random_VCV <- rma.mv(yi = d, V = VCV, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat, method = "REML")
summary(MA_all_random_VCV)
calc.I2(dat$Vd, MA_all_random_VCV)
save(MA_all_random_VCV, file = "Rdata/MA_all_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_all_random_VCV_phylo <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat, method = "REML") 
summary(MA_all_random_VCV_phylo)   
calc.I2(dat$Vd, MA_all_random_VCV_phylo) #77% Htotal, 4.5% phylogeny, 0% speciesID
save(MA_all_random_VCV_phylo, file = "Rdata/MA_all_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_all <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat, method = "REML") 
summary(MA_all)    
calc.I2(dat$Vd, MA_all) #77% Htotal, 4.5% phylogeny
save(MA_all, file = "Rdata/MA_all.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_all_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat)
print(MA_all_robu) #0.191  0.0732    0.31
#save(MA_all_robu,file="Rdata/MA_all_robu.Rdata")

#robust metafor
MA_all_robust <- robust(MA_all, cluster = dat$ExperimentID)
summary(MA_all_robust) #0.19  0.07  0.31
save(MA_all_robust,file = "Rdata/MA_all_robust.Rdata")
```


########################################################
##### Max ES data subset (dat_max_ES, k=106)
##subset by picking maximum ES from each triplet (i.e. get the most positive=optimistic response available)

#subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)
dim(dat_max_absES) 
#subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the response)
dim(dat_max_meanES) 

```{r MA dat_max_ES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_max_ES, method="REML") 
summary(MA_maxES_random) 
calc.I2(dat_max_ES$Vd, MA_maxES_random) 
save(MA_maxES_random, file = "Rdata/MA_maxES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxES_random_VCV <- rma.mv(yi = d, V = VCV_max_ES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_ES, method = "REML")
summary(MA_maxES_random_VCV)
calc.I2(dat_max_ES$Vd, MA_maxES_random_VCV)
save(MA_maxES_random_VCV, file = "Rdata/MA_maxES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES_random_VCV_phylo)   
calc.I2(dat_max_ES$Vd, MA_maxES_random_VCV_phylo) #77% Htotal, 0% phylogeny, 0% speciesID
save(MA_maxES_random_VCV_phylo, file = "Rdata/MA_maxES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxES <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES)    
calc.I2(dat_max_ES$Vd, MA_maxES) #78% Htotal, 0% phylogeny
save(MA_maxES, file = "Rdata/MA_maxES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxES = TRUE, data = dat_max_ES)
print(MA_maxES_robu) #0.54  0.4    0.7
#save(MA_maxES_robu,file="Rdata/MA_maxES_robu.Rdata")

#robust metafor
MA_maxES_robust <- robust(MA_maxES, cluster = dat_max_ES$ExperimentID)
summary(MA_maxES_robust) #0.54  0.4  0.7
save(MA_maxES_robust,file = "Rdata/MA_maxES_robust.Rdata")
```


########################################################
##### Max absolute ES data subset (dat_max_absES, k=106)
#subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)


```{r MA dat_max_absES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxabsES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_max_absES, method="REML") 
summary(MA_maxabsES_random) 
calc.I2(dat_max_absES$Vd, MA_maxabsES_random) 
save(MA_maxabsES_random, file = "Rdata/MA_maxabsES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxabsES_random_VCV <- rma.mv(yi = d, V = VCV_max_absES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_absES, method = "REML")
summary(MA_maxabsES_random_VCV)
calc.I2(dat_max_absES$Vd, MA_maxabsES_random_VCV)
save(MA_maxabsES_random_VCV, file = "Rdata/MA_maxabsES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxabsES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_absES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES_random_VCV_phylo)   
calc.I2(dat_max_absES$Vd, MA_maxabsES_random_VCV_phylo) #89% Htotal, 0.6% phylogeny, 0% speciesID
save(MA_maxabsES_random_VCV_phylo, file = "Rdata/MA_maxabsES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxabsES <- rma.mv(yi=d, V=VCV_max_absES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES)    
calc.I2(dat_max_absES$Vd, MA_maxabsES) #89% Htotal, 1.7% phylogeny
save(MA_maxabsES, file = "Rdata/MA_maxabsES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxabsES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxabsES = TRUE, data = dat_max_absES)
print(MA_maxabsES_robu) #0.38  0.17    0.59
#save(MA_maxabsES_robu,file="Rdata/MA_maxabsES_robu.Rdata")

#robust metafor
MA_maxabsES_robust <- robust(MA_maxabsES, cluster = dat_max_absES$ExperimentID)
summary(MA_maxabsES_robust) #0.37  0.16  0.60
save(MA_maxabsES_robust,file = "Rdata/MA_maxabsES_robust.Rdata")
```



########################################################
##### Max mean ES data subset (dat_max_meanES, k=106)
#subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the overall response)

```{r MA dat_max_meanES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxmeanES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_max_meanES, method="REML") 
summary(MA_maxmeanES_random) 
calc.I2(dat_max_meanES$Vd, MA_maxmeanES_random) 
save(MA_maxmeanES_random, file = "Rdata/MA_maxmeanES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxmeanES_random_VCV <- rma.mv(yi = d, V = VCV_max_meanES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_meanES, method = "REML")
summary(MA_maxmeanES_random_VCV)
calc.I2(dat_max_meanES$Vd, MA_maxmeanES_random_VCV)
save(MA_maxmeanES_random_VCV, file = "Rdata/MA_maxmeanES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxmeanES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_meanES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_meanES, method = "REML") 
summary(MA_maxmeanES_random_VCV_phylo)   
calc.I2(dat_max_meanES$Vd, MA_maxmeanES_random_VCV_phylo) #89% Htotal, 0.7% phylogeny, 0% speciesID
save(MA_maxmeanES_random_VCV_phylo, file = "Rdata/MA_maxmeanES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxmeanES <- rma.mv(yi=d, V=VCV_max_meanES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_meanES, method = "REML") 
summary(MA_maxmeanES)    
calc.I2(dat_max_meanES$Vd, MA_maxmeanES) #89% Htotal, 1.5% phylogeny
save(MA_maxmeanES, file = "Rdata/MA_maxmeanES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxmeanES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxmeanES = TRUE, data = dat_max_meanES)
print(MA_maxmeanES_robu) #0.38  0.17    0.58
#save(MA_maxmeanES_robu,file="Rdata/MA_maxmeanES_robu.Rdata")

#robust metafor
MA_maxmeanES_robust <- robust(MA_maxmeanES, cluster = dat_max_meanES$ExperimentID)
summary(MA_maxmeanES_robust) #0.37  0.15  0.59
save(MA_maxmeanES_robust,file = "Rdata/MA_maxmeanES_robust.Rdata")
```



########################################################
##### Max B ES data subset (dat_B_ES, k=106)
#subset by picking ES from each triplet which isin the midpoint (i.e. B) 

```{r MA dat_B_ES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_B_ES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_B_ES, method="REML") 
summary(MA_B_ES_random) 
calc.I2(dat_B_ES$Vd, MA_B_ES_random) 
save(MA_B_ES_random, file = "Rdata/MA_B_ES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_B_ES_random_VCV <- rma.mv(yi = d, V = VCV_B_ES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_B_ES, method = "REML")
summary(MA_B_ES_random_VCV)
calc.I2(dat_B_ES$Vd, MA_B_ES_random_VCV)
save(MA_B_ES_random_VCV, file = "Rdata/MA_B_ES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_B_ES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_B_ES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_B_ES, method = "REML") 
summary(MA_B_ES_random_VCV_phylo)   
calc.I2(dat_B_ES$Vd, MA_B_ES_random_VCV_phylo) #82% Htotal, 3.6% phylogeny, 0% speciesID
save(MA_B_ES_random_VCV_phylo, file = "Rdata/MA_B_ES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_B_ES <- rma.mv(yi=d, V=VCV_B_ES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_B_ES, method = "REML") 
summary(MA_B_ES )    
calc.I2(dat_B_ES$Vd, MA_B_ES ) #82% Htotal, 3.6% phylogeny
save(MA_B_ES, file = "Rdata/MA_B_ES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_B_ES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smB_ES  = TRUE, data = dat_B_ES)
print(MA_B_ES_robu) #0.21  0.07    0.36
#save(MA_B_ES_robu,file="Rdata/MA_B_ES_robu.Rdata")

#robust metafor
MA_B_ES_robust <- robust(MA_B_ES , cluster = dat_B_ES$ExperimentID)
summary(MA_B_ES_robust) #0.2  0.04  0.37
save(MA_B_ES_robust,file = "Rdata/MA_B_ES_robust.Rdata")
```



###############################################################################################################
#########################################     UNIVARIATE  META-REGRESSIONS       ##############################
###############################################################################################################

Univariate MR models for:    
- Species_Latin (Species model)   
- Sex   
- Age   
- Source of Animals
- AffectManipCat   
- AffectManipTiming   
- ComparisonCategory   
- CueTypeCat   
- FoodDeprived   
- TaskType   
- Randomized_WithinBetween   
- Automated   
- Blind   
- MeasureType 
- ReinforcementCat
- AmbigReinforced
- ScalePoint


########################################################
#### All data points (full data set)

#Univariate models:

- Species_Latin (Species model) 
```{r MR all data - Species model}
MR_all_species <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_species) # no species with clear effect
save(MR_all_species, file = "Rdata/MR_all_species.Rdata")

MR_all_species_nophylo <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MR_all_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_all_species_nophylo, file = "Rdata/MR_all_species_nophylo.Rdata")
```


- Sex
```{r MR all data - Sex}
MR_all_sex1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex1) # signif intc for males only
save(MR_all_sex1, file = "Rdata/MR_all_sex1.Rdata")

MR_all_sex <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex) # ns intc for females, signif diff female-male
save(MR_all_sex, file = "Rdata/MR_all_sex.Rdata")

MR_all_sex2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex2) # signif intc for males, signif diff female-male
save(MR_all_sex2, file = "Rdata/MR_all_sex2.Rdata")
```


- Age
```{r MR all data - Age}
MR_all_age1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_age1) # no signif intc adult/juvenile
save(MR_all_age1, file = "Rdata/MR_all_age1.Rdata")

MR_all_age <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_age) # no signif diff adult-juvenile
save(MR_all_age, file = "Rdata/MR_all_age.Rdata")
```

- Source (Captive_Wild.caught)
```{r MR all data - Captive_Wild.caught}
MR_all_source1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_source1) # no signif intc captive/wild-caught
save(MR_all_source1, file = "Rdata/MR_all_source1.Rdata")

MR_all_source <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_source) # no signif diff captive/wild-caught
save(MR_all_source, file = "Rdata/MR_all_source.Rdata")
```


- AffectManipCat
```{r MR all data - AffectManipCat}
MR_all_AffectManipCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipCat1) # no signif intc enrichment/stress
save(MR_all_AffectManipCat1, file = "Rdata/MR_all_AffectManipCat1.Rdata")

MR_all_AffectManipCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipCat) # no signif diff enrichment/stress
save(MR_all_AffectManipCat, file = "Rdata/MR_all_AffectManipCat.Rdata")
```


- AffectManipTiming
```{r MR all data - AffectManipTiming}
MR_all_AffectManipTiming1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipTiming1) # no signif intc before/during / long-term
save(MR_all_AffectManipTiming1, file = "Rdata/MR_all_AffectManipTiming1.Rdata")

MR_all_AffectManipTiming <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_all_AffectManipTiming, file = "Rdata/MR_all_AffectManipTiming.Rdata")
```


- ComparisonCategory
```{r MR all data - ComparisonCategory}
MR_all_ComparisonCategory1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory1) # signif intc Benign-Worse only!   (ns intc Better-Benign / Better-Benign)
save(MR_all_ComparisonCategory1, file = "Rdata/MR_all_ComparisonCategory1.Rdata")

MR_all_ComparisonCategory <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_ComparisonCategory, file = "Rdata/MR_all_ComparisonCategory.Rdata")

MR_all_ComparisonCategory2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory2) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_ComparisonCategory2, file = "Rdata/MR_all_ComparisonCategory2.Rdata")
```


- CueTypeCat
```{r MR all data - CueTypeCat}
MR_all_CueTypeCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat1) # signif intc for auditory only
save(MR_all_CueTypeCat1, file = "Rdata/MR_all_CueTypeCat1.Rdata")

MR_all_CueTypeCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat) # spatial and visual signif diff to auditory
save(MR_all_CueTypeCat, file = "Rdata/MR_all_CueTypeCat.Rdata")

MR_all_CueTypeCat2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat2) # no signif diff to olfactory
save(MR_all_CueTypeCat2, file = "Rdata/MR_all_CueTypeCat2.Rdata")

MR_all_CueTypeCat3 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat3) # auditory signif diff to spatial
save(MR_all_CueTypeCat3, file = "Rdata/MR_all_CueTypeCat3.Rdata")

MR_all_CueTypeCat4 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat4) # no signif diff to tactile
save(MR_all_CueTypeCat4, file = "Rdata/MR_all_CueTypeCat4.Rdata")

MR_all_CueTypeCat5 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat5) # auditory signif diff to visual
save(MR_all_CueTypeCat5, file = "Rdata/MR_all_CueTypeCat5.Rdata")
```


- FoodDeprived
```{r MR all data - FoodDeprived}
MR_all_FoodDeprived1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_FoodDeprived1) # no signif intc yes / no
save(MR_all_FoodDeprived1, file = "Rdata/MR_all_FoodDeprived1.Rdata")

MR_all_FoodDeprived <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_FoodDeprived) # no signif diff yes / no
save(MR_all_FoodDeprived, file = "Rdata/MR_all_FoodDeprived.Rdata")
```


- TaskType
```{r MR all data - TaskType}
MR_all_TaskType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_TaskType1) # signif intc active choice, but not go/no-go
save(MR_all_TaskType1, file = "Rdata/MR_all_TaskType1.Rdata")

MR_all_TaskType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_TaskType) # no signif diff active choice vs. go/no-go
save(MR_all_TaskType, file = "Rdata/MR_all_TaskType.Rdata")
```


- WithinBetween
```{r MR all data - WithinBetween}
MR_all_WithinBetween1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_WithinBetween1) # signif intc within, not between
save(MR_all_WithinBetween1, file = "Rdata/MR_all_WithinBetween1.Rdata")

MR_all_WithinBetween <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_WithinBetween) # no signif diff within / between
save(MR_all_WithinBetween, file = "Rdata/MR_all_WithinBetween.Rdata")
```


- Automated
```{r MR all data - Automated}
MR_all_Automated1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Automated1) # no signif intc yes / no
save(MR_all_Automated1, file = "Rdata/MR_all_Automated1.Rdata")

MR_all_Automated <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Automated) # no signif diff yes / no
save(MR_all_Automated, file = "Rdata/MR_all_Automated.Rdata")
```


- Blind
```{r MR all data - Blind}
MR_all_Blind1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Blind1) # no signif intc yes / no
save(MR_all_Blind1, file = "Rdata/MR_all_Blind1.Rdata")

MR_all_Blind <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Blind) # no signif diff yes / no
save(MR_all_Blind, file = "Rdata/MR_all_Blind.Rdata")
```


- MeasureType
```{r MR all data - MeasureType}
MR_all_MeasureType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType1) # signif intc proportion, not latency
save(MR_all_MeasureType1, file = "Rdata/MR_all_MeasureType1.Rdata")

MR_all_MeasureType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType) # ns diff proportion / latency
save(MR_all_MeasureType, file = "Rdata/MR_all_MeasureType.Rdata")
```


- ReinforcementCat
```{r MR all data - ReinforcementCat}
MR_all_ReinforcementCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat1) # signif intc R-P and R-R 
save(MR_all_ReinforcementCat1, file = "Rdata/MR_all_ReinforcementCat1.Rdata")

MR_all_ReinforcementCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat) # signif diff R-Null vs  R-R
save(MR_all_ReinforcementCat, file = "Rdata/MR_all_ReinforcementCat.Rdata")

MR_all_ReinforcementCat2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat2) # no signif diff R-Null /  R-R / R-P
save(MR_all_ReinforcementCat2, file = "Rdata/MR_all_ReinforcementCat2.Rdata")
```


- AmbigReinforced
```{r MR all data - AmbigReinforced}
MR_all_AmbigReinforced1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AmbigReinforced1) # no signif intc yes / no
save(MR_all_AmbigReinforced1, file = "Rdata/MR_all_AmbigReinforced1.Rdata")

MR_all_AmbigReinforced <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AmbigReinforced) # no signif diff yes / no
save(MR_all_AmbigReinforced, file = "Rdata/MR_all_AmbigReinforced.Rdata")
```


- ScalePoint
```{r MR all data - ScalePoint}
MR_all_ScalePoint1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint1) # no signif intc A / B / C
save(MR_all_ScalePoint1, file = "Rdata/MR_all_ScalePoint1.Rdata")

MR_all_ScalePoint <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="A"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint) # no signif diff A / B / C
save(MR_all_ScalePoint, file = "Rdata/MR_all_ScalePoint.Rdata")

MR_all_ScalePoint2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="B"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint2) # no signif diff A / B / C
save(MR_all_ScalePoint2, file = "Rdata/MR_all_ScalePoint2.Rdata")
```


########################################################
#### dat_max_ES

#Univariate models:

- Species_Latin (Species model) 
```{r MR dat_max_ES data - Species model}
MR_maxES_species <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_species) # no species with clear effect
save(MR_maxES_species, file = "Rdata/MR_maxES_species.Rdata")

MR_maxES_species_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_maxES_species_nophylo, file = "Rdata/MR_maxES_species_nophylo.Rdata")
```


########################################################
#### dat_max_absES

#Univariate models:

- Species_Latin (Species model) 
```{r MR dat_max_absES data - Species model}
MR_maxabsES_species <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_species) # no species with clear effect
save(MR_maxabsES_species, file = "Rdata/MR_maxabsES_species.Rdata")

MR_maxabsES_species_nophylo <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_maxabsES_species_nophylo, file = "Rdata/MR_maxabsES_species_nophylo.Rdata")
```


########################################################
#### dat_max_meanES

#Univariate models:

- Species_Latin (Species model) 
```{r MR dat_max_meanES data - Species model}
MR_maxmeanES_species <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_species) # no species with clear effect
save(MR_maxmeanES_species, file = "Rdata/MR_maxmeanES_species.Rdata")

MR_maxmeanES_species_nophylo <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_maxmeanES_species_nophylo, file = "Rdata/MR_maxmeanES_species_nophylo.Rdata")
```






###########################################################
INTERACTIONS

## MeasureType * TaskType


```{r MR all data - MeasureType*TaskType}

table(dat$MeasureType, dat$TaskType)

MR_all_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_all_MeasureType_TaskType1, file = "Rdata/MR_all_MeasureType_TaskType1.Rdata")

MR_all_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType * relevel(dat$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_all_MeasureType_TaskType2, file = "Rdata/MR_all_MeasureType_TaskType2.Rdata")

MR_all_MeasureType_TaskType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$MeasureType, ref="proportion") * relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType_TaskType) # ns diff proportion / latency
save(MR_all_MeasureType_TaskType, file = "Rdata/MR_all_MeasureType_TaskType.Rdata")
```


```{r MR dat_max_ES data - MeasureType*TaskType}
table(dat_max_ES$MeasureType, dat_max_ES$TaskType)

MR_maxES_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_maxES_MeasureType_TaskType1, file = "Rdata/MR_maxES_MeasureType_TaskType1.Rdata")

MR_maxES_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~MeasureType * relevel(dat_max_ES$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_maxES_MeasureType_TaskType2, file = "Rdata/MR_maxES_MeasureType_TaskType2.Rdata")

MR_maxES_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$MeasureType, ref="proportion") * relevel(dat_max_ES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType_TaskType) # ns diff proportion / latency
save(MR_maxES_MeasureType_TaskType, file = "Rdata/MR_maxES_MeasureType_TaskType.Rdata")
```



```{r MR dat_max_absES data - MeasureType*TaskType}
table(dat_max_absES$MeasureType, dat_max_absES$TaskType)

MR_maxabsES_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_maxabsES_MeasureType_TaskType1, file = "Rdata/MR_maxabsES_MeasureType_TaskType1.Rdata")

MR_maxabsES_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType * relevel(dat_max_absES$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_maxabsES_MeasureType_TaskType2, file = "Rdata/MR_maxabsES_MeasureType_TaskType2.Rdata")

MR_maxabsES_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$MeasureType, ref="proportion") * relevel(dat_max_absES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType_TaskType) # ns diff proportion / latency
save(MR_maxabsES_MeasureType_TaskType, file = "Rdata/MR_maxabsES_MeasureType_TaskType.Rdata")
```


```{r MR dat_max_meanES data - MeasureType*TaskType}
table(dat_max_meanES$MeasureType, dat_max_meanES$TaskType)

MR_maxmeanES_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_maxmeanES_MeasureType_TaskType1, file = "Rdata/MR_maxmeanES_MeasureType_TaskType1.Rdata")

MR_maxmeanES_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~MeasureType * relevel(dat_max_meanES$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_maxmeanES_MeasureType_TaskType2, file = "Rdata/MR_maxmeanES_MeasureType_TaskType2.Rdata")

MR_maxmeanES_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$MeasureType, ref="proportion") * relevel(dat_max_meanES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType_TaskType) # ns diff proportion / latency
save(MR_maxmeanES_MeasureType_TaskType, file = "Rdata/MR_maxmeanES_MeasureType_TaskType.Rdata")
```




- MeasureType * TaskType plots

https://quantdev.ssri.psu.edu/tutorials/five-ish-steps-create-pretty-interaction-plots-multi-level-model-r

```{r MR all data - MeasureType*TaskType - plots}
library(nlme)
library(effects)
library(ggplot2)
library(psych)

lme_all_MT_TT <- lme(fixed = d ~ MeasureType * TaskType, data=dat, random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),  na.action= na.exclude)
summary(lme_all_MT_TT)
intervals(lme_all_MT_TT)
ef1 <- effect(term="MeasureType*TaskType", mod=lme_all_MT_TT)
ef1
efdata1 <- as.data.frame(ef1) #convert the effects list to a data frame
efdata1 #print effects data frame
efdata1$TaskTypel <- as.factor(efdata1$TaskType)

ggplot(efdata1, aes(x=MeasureType, y=fit, color=TaskType,group=TaskType)) + 
    geom_point() + 
    geom_line(size=1.2) +
    geom_ribbon(aes(ymin=fit-se, ymax=fit+se, fill=TaskType),alpha=0.3) + 
    labs(title = "TaskType", x= "Measurement type", y="ES", color="MeasureType", fill="MeasureType") + theme_classic() + theme(text=element_text(size=10))





########
MR_all_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_all_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_all_MeasureType_TaskType1, file = "Rdata/MR_all_MeasureType_TaskType1.Rdata")

MR_all_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat$MeasureType, ref="proportion") * relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_all_MeasureType_TaskType) # ns diff proportion / latency
save(MR_all_MeasureType_TaskType, file = "Rdata/MR_all_MeasureType_TaskType.Rdata")
```







###########################################################
#### VIF

https://stats.stackexchange.com/questions/201205/variance-inflation-factors-vif-mer-verus-group-factor-level-vif

https://stackoverflow.com/questions/26633483/collinearity-after-accounting-for-random-mixed-effects

## A VIF of 1 indicates there is no detectable linear relationship among the regressors, while a large VIF indicates a tight linear relationship
# A commonly used rule of thumb is that a VIF of 10 or more is evidence of severe multicollinearity (Cohen et

```{r vif}
vif.mer <- function (fit) {
## adapted from rms::vif
v <- vcov(fit)
nam <- names(fixef(fit))
## exclude intercepts
ns <- sum(1 * (nam == "Intercept" | nam == "(Intercept)"))
if (ns > 0) {
v <- v[-(1:ns), -(1:ns), drop = FALSE]
nam <- nam[-(1:ns)] }
d <- diag(v)^0.5
v <- diag(solve(v/(d %o% d)))
names(v) <- nam 
v }

library(lme4)
model <- lmer(d ~ MeasureType + TaskType + (1|ArticleID), data = dat)
vif.mer(model)

model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat)
vif.mer(model)


model <- lmer(d ~ Sex + Age + (1|ExperimentID), data = dat)
vif.mer(model)

```


###########################################################







- Full Models
```{r MR all data - Full models}

#using all moderators 
MR_all_Full_0 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_0) # sex males signif for latency, tenedency for latency-proportion diff
save(MR_all_Full_0, file = "Rdata/MR_all_Full_0.Rdata")

MR_all_Full_0p <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + relevel(dat$MeasureType, ref="proportion") + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_0p) # sex males signif for proportion, tenedency for latency-proportion diff
save(MR_all_Full_0p, file = "Rdata/MR_all_Full_0p.Rdata")

#only using significant (diff levels) from univariate models
#without interaction (models using different reference levels):
MR_all_Full_1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_1) # signif itc for male at latency and tendency diff from proportion
save(MR_all_Full_1, file = "Rdata/MR_all_Full_1.Rdata")

MR_all_Full_2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_2) # sex female and latency diff from male and tendency from proportion
save(MR_all_Full_2, file = "Rdata/MR_all_Full_2.Rdata")

MR_all_Full_3 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="male") + relevel(dat$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_3) # male signif intc and diff from female
save(MR_all_Full_3, file = "Rdata/MR_all_Full_3.Rdata")

MR_all_Full_4 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + relevel(dat$MeasureType, ref="proportion") - 1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_4) # sex female and latency diff from male and tendency from proportion
save(MR_all_Full_4, file = "Rdata/MR_all_Full_4.Rdata")

#with interaction
MR_all_Full_2i <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex * MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_2i) # ns interaction, signif male-female diff, proportion-latency for female
save(MR_all_Full_2i, file = "Rdata/MR_all_Full_2i.Rdata")
     

#only using significant (diff levels) from univariate models no phylo
MR_all_Full_1x <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MR_all_Full_1x) # signif itc for male at latency and tendency diff from proportion
```



- Full Model robust meatafor
```{r MR all data - Full model robust metafor}
#only using significant (diff levels) from univariate models

#without interaction (models using different reference levels):
MR_all_Full_1_robust <- robust(MR_all_Full_1, cluster  =  dat$ExperimentID)
summary(MR_all_Full_1_robust) #same pattern as in the original model
save(MR_all_Full_1_robust,file = "Rdata/MR_all_Full_1_robust.Rdata")

MR_all_Full_2_robust <- robust(MR_all_Full_2, cluster  =  dat$ExperimentID)
summary(MR_all_Full_2_robust) #same pattern as in the original model
save(MR_all_Full_2_robust,file = "Rdata/MR_all_Full_2_robust.Rdata")

MR_all_Full_3_robust <- robust(MR_all_Full_3, cluster  =  dat$ExperimentID)
summary(MR_all_Full_3_robust) #same pattern as in the original model
save(MR_all_Full_3_robust,file = "Rdata/MR_all_Full_3_robust.Rdata")

MR_all_Full_4_robust <- robust(MR_all_Full_4, cluster  =  dat$ExperimentID)
summary(MR_all_Full_4_robust) #same pattern as in the original model
save(MR_all_Full_4_robust,file = "Rdata/MR_all_Full_4_robust.Rdata")

#with interaction
MR_all_Full_2i_robust <- robust(MR_all_Full_2i, cluster  =  dat$ExperimentID)
summary(MR_all_Full_2i_robust) #same pattern as in the original model
save(MR_all_Full_2i_robust,file = "Rdata/MR_all_Full_2i_robust.Rdata")

#only using significant (diff levels) from univariate models no phylo
MR_all_Full_1x_robust <- robust(MR_all_Full_1x, cluster  =  dat$ExperimentID)
summary(MR_all_Full_1x_robust) #same pattern as in the original model
save(MR_all_Full_1x_robust,file = "Rdata/MR_all_Full_1x_robust.Rdata")
```




###############################################################################################################
###########################################         PROPORTION DATA        ########################################### 
###############################################################################################################

## Meta-analytical models

```{r MA proportion data} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_prop_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_prop, method="REML") 
summary(MA_prop_random) 
calc.I2(dat_prop$Vd, MA_prop_random) #84.6% total
save(MA_prop_random, file = "Rdata/MA_prop_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_prop_random_VCV <- rma.mv(yi = d, V = VCV_prop, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                         data = dat_prop, method = "REML")
summary(MA_prop_random_VCV)
calc.I2(dat_prop$Vd, MA_prop_random_VCV) #84.8% Htotal
save(MA_prop_random_VCV, file = "Rdata/MA_prop_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_prop_random_VCV_phylo <- rma.mv(yi=d, V=VCV_prop, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_prop),
                             data = dat_prop, method = "REML") 
summary(MA_prop_random_VCV_phylo) ### estimate  ns 0.2187  CI  -0.0623  0.4997   
calc.I2(dat_prop$Vd, MA_prop_random_VCV_phylo) #85.0% Htotal, 3.2% phylogeny, 0% species ID
save(MA_prop_random_VCV_phylo, file = "Rdata/MA_prop_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random
MA_prop <- rma.mv(yi=d, V=VCV_prop, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_prop),
                             data = dat_prop, method = "REML") 
summary(MA_prop) ### much lower ns estimate     
calc.I2(dat_prop$Vd, MA_prop) #85.0% Htotal
save(MA_prop, file = "Rdata/MA_prop.Rdata")
```

## Meta-regression models    

- Species_Latin (Species model) 
```{r MR prop data - Species model}
MR_prop_species <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_species) # no species with clear effect
save(MR_prop_species, file = "Rdata/MR_prop_species.Rdata")
```


- Sex
```{r MR prop data - Sex}
MR_prop_sex1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_sex1) # signif intc for males only
save(MR_prop_sex1, file = "Rdata/MR_prop_sex1.Rdata")

MR_prop_sex <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_sex) # ns diff 
save(MR_prop_sex, file = "Rdata/MR_prop_sex.Rdata")
```


- Age
```{r MR prop data - Age}
MR_prop_age1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_age1) # no signif intc adult/juvenile
save(MR_prop_age1, file = "Rdata/MR_prop_age1.Rdata")

MR_prop_age <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_age) # no signif diff adult-juvenile
save(MR_prop_age, file = "Rdata/MR_prop_age.Rdata")
```

- Source (Captive_Wild.caught)
```{r MR prop data - Captive_Wild.caught}
MR_prop_source1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_source1) # no signif intc captive/wild-caught
save(MR_prop_source1, file = "Rdata/MR_prop_source1.Rdata")

MR_prop_source <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_source) # no signif diff captive/wild-caught
save(MR_prop_source, file = "Rdata/MR_prop_source.Rdata")
```


- AffectManipCat
```{r MR prop data - AffectManipCat}
MR_prop_AffectManipCat1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipCat1) # no signif intc enrichment/stress
save(MR_prop_AffectManipCat1, file = "Rdata/MR_prop_AffectManipCat1.Rdata")

MR_prop_AffectManipCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipCat) # no signif diff enrichment/stress
save(MR_prop_AffectManipCat, file = "Rdata/MR_prop_AffectManipCat.Rdata")
```


- AffectManipTiming
```{r MR prop data - AffectManipTiming}
MR_prop_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipTiming1) # no signif intc before/during / long-term
save(MR_prop_AffectManipTiming1, file = "Rdata/MR_prop_AffectManipTiming1.Rdata")

MR_prop_AffectManipTiming <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_prop_AffectManipTiming, file = "Rdata/MR_prop_AffectManipTiming.Rdata")
```


- ComparisonCategory
```{r MR prop data - ComparisonCategory}
MR_prop_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ComparisonCategory1) # no signif intc Benign-Worse / Better-Benign / Better-Benign
save(MR_prop_ComparisonCategory1, file = "Rdata/MR_prop_ComparisonCategory1.Rdata")

MR_prop_ComparisonCategory <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_prop_ComparisonCategory, file = "Rdata/MR_prop_ComparisonCategory.Rdata")
```


- CueTypeCat
```{r MR prop data - CueTypeCat}
MR_prop_CueTypeCat1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_CueTypeCat1) # signif ittc for auditory
save(MR_prop_CueTypeCat1, file = "Rdata/MR_prop_CueTypeCat1.Rdata")

MR_prop_CueTypeCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_CueTypeCat) # no signif diff to auditory
save(MR_prop_CueTypeCat, file = "Rdata/MR_prop_CueTypeCat.Rdata")
```


- FoodDeprived
```{r MR prop data - FoodDeprived}
MR_prop_FoodDeprived1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_FoodDeprived1) # no signif intc yes / no
save(MR_prop_FoodDeprived1, file = "Rdata/MR_prop_FoodDeprived1.Rdata")

MR_prop_FoodDeprived <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_FoodDeprived) # no signif diff yes / no
save(MR_prop_FoodDeprived, file = "Rdata/MR_prop_FoodDeprived.Rdata")
```


- TaskType
```{r MR prop data - TaskType}
MR_prop_TaskType1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_TaskType1) # signif intc active choice, but not go/no-go
save(MR_prop_TaskType1, file = "Rdata/MR_prop_TaskType1.Rdata")

MR_prop_TaskType <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_TaskType) # no signif diff active choice vs. go/no-go
save(MR_prop_TaskType, file = "Rdata/MR_prop_TaskType.Rdata")
```


- Randomized_WithinBetween
```{r MR prop data - WithinBetween}
MR_prop_WithinBetween1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_WithinBetween1) # ns intc
save(MR_prop_WithinBetween1, file = "Rdata/MR_prop_MR_prop_WithinBetween1.Rdata")

MR_prop_WithinBetween <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_WithinBetween) # no signif diff within / between
save(MR_prop_WithinBetween, file = "Rdata/MR_prop_WithinBetween.Rdata")
```


- Automated
```{r MR prop data - Automated}
MR_prop_Automated1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Automated1) # no signif intc yes / no
save(MR_prop_Automated1, file = "Rdata/MR_prop_Automated1.Rdata")

MR_prop_Automated <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Automated) # no signif diff yes / no
save(MR_prop_Automated, file = "Rdata/MR_prop_Automated.Rdata")
```


- Blind
```{r MR prop data - Blind}
MR_prop_Blind1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Blind1) # no signif intc yes / no
save(MR_prop_Blind1, file = "Rdata/MR_prop_Blind1.Rdata")

MR_prop_Blind <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Blind) # no signif diff yes / no
save(MR_prop_Blind, file = "Rdata/MR_prop_Blind.Rdata")
```


- ReinforcementCat
```{r MR prop data - ReinforcementCat}
MR_prop_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ReinforcementCat1) # no signif intc 
save(MR_prop_ReinforcementCat1, file = "Rdata/MR_prop_ReinforcementCat1.Rdata")

MR_prop_ReinforcementCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ReinforcementCat) # no signif diff R-Null /  R-R / R-P
save(MR_prop_ReinforcementCat, file = "Rdata/MR_prop_ReinforcementCat.Rdata")
```


- AmbigReinforced
```{r MR prop data - AmbigReinforced}
MR_prop_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AmbigReinforced1) # no signif intc yes / no
save(MR_prop_AmbigReinforced1, file = "Rdata/MR_prop_AmbigReinforced1.Rdata")

MR_prop_AmbigReinforced <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AmbigReinforced) # no signif diff yes / no
save(MR_prop_AmbigReinforced, file = "Rdata/MR_prop_AmbigReinforced.Rdata")
```


- ScalePoint
```{r MR prop data - ScalePoint}
MR_prop_ScalePoint1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ScalePoint1) # no signif intc A / B / C
save(MR_prop_ScalePoint1, file = "Rdata/MR_prop_ScalePoint1.Rdata")

MR_prop_ScalePoint <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$ScalePoint, ref="B"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ScalePoint) # no signif diff A / B / C
save(MR_prop_ScalePoint, file = "Rdata/MR_prop_ScalePoint.Rdata")
```


- Full Model (all moderators, no interactions)
```{r MR prop data - Full, all moderators }
MR_prop_Full_0 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Full_0) # all ns
save(MR_prop_Full_0, file = "RdataMR_prop_Full_0.Rdata")
```






###############################################################################################################
###########################################         LATENCY DATA        ########################################### 
###############################################################################################################

## Meta-analytical models

```{r MA latency data} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_lat_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_lat, method="REML") 
summary(MA_lat_random) 
calc.I2(dat_lat$Vd, MA_lat_random) 
save(MA_lat_random, file = "Rdata/MA_lat_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_lat_random_VCV <- rma.mv(yi = d, V = VCV_lat, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                         data = dat_lat, method = "REML") 
summary(MA_lat_random_VCV)
calc.I2(dat_lat$Vd, MA_lat_random_VCV) 
save(MA_lat_random_VCV, file = "Rdata/MA_lat_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_lat_random_VCV_phylo <- rma.mv(yi=d, V=VCV_lat, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_lat),
                             data = dat_lat, method = "REML") 
summary(MA_lat_random_VCV_phylo) ### estimate  ns 0.1306  CI  -0.0047  0.2658   
calc.I2(dat_lat$Vd, MA_lat_random_VCV_phylo) #78.1% Htotal, 0% phylogeny, 0% species ID
save(MA_lat_random_VCV_phylo, file = "Rdata/MA_lat_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random
MA_lat <- rma.mv(yi=d, V=VCV_lat, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_lat),
                             data = dat_lat, method = "REML")  
summary(MA_lat) ###     
calc.I2(dat_lat$Vd, MA_lat) #67.5% Htotal
save(MA_lat, file = "Rdata/MA_lat.Rdata")
```



## Meta-regression models:    

- Species_Latin (Species model) 
```{r MR lat data - Species model}
MR_lat_species <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_species) # no species with clear effect
save(MR_lat_species, file = "Rdata/MR_lat_species.Rdata")
```


- Sex
```{r MR lat data - Sex}
MR_lat_sex1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_sex1) # males signif intc 
save(MR_lat_sex1, file = "Rdata/MR_lat_sex1.Rdata")

MR_lat_sex <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_sex) # ns diff
save(MR_lat_sex, file = "Rdata/MR_lat_sex.Rdata")
```


- Age
```{r MR lat data - Age}
MR_lat_age1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_age1) # no signif intc adult/juvenile
save(MR_lat_age1, file = "Rdata/MR_lat_age1.Rdata")

MR_lat_age <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_age) # no signif diff adult-juvenile
save(MR_lat_age, file = "Rdata/MR_lat_age.Rdata")
```

- Source (Captive_Wild.caught)
```{r MR lat data - Captive_Wild.caught}
MR_lat_source1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_source1) # no signif intc captive/wild-caught
save(MR_lat_source1, file = "Rdata/MR_lat_source1.Rdata")

MR_lat_source <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_source) # no signif diff captive/wild-caught
save(MR_lat_source, file = "Rdata/MR_lat_source.Rdata")
```


- AffectManipCat
```{r MR lat data - AffectManipCat}
MR_lat_AffectManipCat1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") #NO CONVERGENCE
summary(MR_lat_AffectManipCat1) # no signif intc enrichment/stress
save(MR_lat_AffectManipCat1, file = "Rdata/MR_lat_AffectManipCat1.Rdata")

MR_lat_AffectManipCat1 <- rma.mv(yi=d, V=Vd, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") #WITHOUT VCV
summary(MR_lat_AffectManipCat1) # no signif intc enrichment/stress
save(MR_lat_AffectManipCat1, file = "Rdata/MR_lat_AffectManipCat1.Rdata")

MR_lat_AffectManipCat <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AffectManipCat) # no signif diff enrichment/stress
save(MR_lat_AffectManipCat, file = "Rdata/MR_lat_AffectManipCat.Rdata")
```


- AffectManipTiming
```{r MR lat data - AffectManipTiming}
MR_lat_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AffectManipTiming1) # no signif intc before/during / long-term
save(MR_lat_AffectManipTiming1, file = "Rdata/MR_lat_AffectManipTiming1.Rdata")

MR_lat_AffectManipTiming <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_lat_AffectManipTiming, file = "Rdata/MR_lat_AffectManipTiming.Rdata")
```


- ComparisonCategory
```{r MR lat data - ComparisonCategory}
MR_lat_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ComparisonCategory1) # no signif intc Benign-Worse / Better-Benign / Better-Benign
save(MR_lat_ComparisonCategory1, file = "Rdata/MR_lat_ComparisonCategory1.Rdata")

MR_lat_ComparisonCategory <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_lat_ComparisonCategory, file = "Rdata/MR_lat_ComparisonCategory.Rdata")
```


- CueTypeCat
```{r MR lat data - CueTypeCat}
MR_lat_CueTypeCat1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_CueTypeCat1) # signif intc for auditory
save(MR_lat_CueTypeCat1, file = "Rdata/MR_lat_CueTypeCat1.Rdata")

MR_lat_CueTypeCat <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_CueTypeCat) # no signif diff auditory - tactile
save(MR_lat_CueTypeCat, file = "Rdata/MR_lat_CueTypeCat.Rdata")
```


- FoodDeprived
```{r MR lat data - FoodDeprived}
MR_lat_FoodDeprived1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_FoodDeprived1) # no signif intc yes / no
save(MR_lat_FoodDeprived1, file = "Rdata/MR_lat_FoodDeprived1.Rdata")

MR_lat_FoodDeprived <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_FoodDeprived) # no signif diff yes / no
save(MR_lat_FoodDeprived, file = "Rdata/MR_lat_FoodDeprived.Rdata")
```


- TaskType
```{r MR lat data - TaskType}
MR_lat_TaskType1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_TaskType1) # signif intc active choice, but not go/no-go
save(MR_lat_TaskType1, file = "Rdata/MR_lat_TaskType1.Rdata")

MR_lat_TaskType <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_TaskType) # no signif diff active choice vs. go/no-go
save(MR_lat_TaskType, file = "Rdata/MR_lat_TaskType.Rdata")
```


- Randomized_WithinBetween
```{r MR lat data - WithinBetween}
MR_lat_WithinBetween1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_WithinBetween1) # signif intc within, not between
save(MR_lat_WithinBetween1, file = "Rdata/MR_lat_MR_lat_WithinBetween1.Rdata")

MR_lat_WithinBetween <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_WithinBetween) # no signif diff within / between
save(MR_lat_WithinBetween, file = "Rdata/MR_lat_WithinBetween.Rdata")
```


- Automated
```{r MR lat data - Automated}
MR_lat_Automated1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Automated1) # no signif intc yes / no
save(MR_lat_Automated1, file = "Rdata/MR_lat_Automated1.Rdata")

MR_lat_Automated <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Automated) # no signif diff yes / no
save(MR_lat_Automated, file = "Rdata/MR_lat_Automated.Rdata")
```


- Blind
```{r MR lat data - Blind}
MR_lat_Blind1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Blind1) # no signif intc yes / no
save(MR_lat_Blind1, file = "Rdata/MR_lat_Blind1.Rdata")

MR_lat_Blind <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Blind) # no signif diff yes / no
save(MR_lat_Blind, file = "Rdata/MR_lat_Blind.Rdata")
```


- ReinforcementCat
```{r MR lat data - ReinforcementCat}
MR_lat_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ReinforcementCat1) # no signif intc 
save(MR_lat_ReinforcementCat1, file = "Rdata/MR_lat_ReinforcementCat1.Rdata")

MR_lat_ReinforcementCat <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ReinforcementCat) # no signif diff R-Null /  R-R / R-P
save(MR_lat_ReinforcementCat, file = "Rdata/MR_lat_ReinforcementCat.Rdata")
```


- AmbigReinforced
```{r MR lat data - AmbigReinforced}
MR_lat_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AmbigReinforced1) # no signif intc yes / no
save(MR_lat_AmbigReinforced1, file = "Rdata/MR_lat_AmbigReinforced1.Rdata")

MR_lat_AmbigReinforced <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AmbigReinforced) # no signif diff yes / no
save(MR_lat_AmbigReinforced, file = "Rdata/MR_lat_AmbigReinforced.Rdata")
```


- ScalePoint
```{r MR lat data - ScalePoint}
MR_lat_ScalePoint1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ScalePoint1) # no signif intc A / B / C
save(MR_lat_ScalePoint1, file = "Rdata/MR_lat_ScalePoint1.Rdata")

MR_lat_ScalePoint <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ScalePoint, ref="B"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ScalePoint) # no signif diff A / B / C
save(MR_lat_ScalePoint, file = "Rdata/MR_lat_ScalePoint.Rdata")
```


- Full Model (all moderators, no interactions)
```{r MR lat data - Full, all moderators }
MR_lat_Full_0 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Full_0) # short-term diff from long-term in femalesa at A?
save(MR_lat_Full_0, file = "RdataMR_lat_Full_0.Rdata")

MR_lat_Full_1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Sex + AffectManipTiming, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Full_1) # all ns
save(MR_lat_Full_1, file = "RdataMR_lat_Full_1.Rdata")
```







###############################################################################################################
#############################         ALL DATA - PUBLICATION BIAS       ####################################### 
##############################################################################################################

```{r preliminary funnel plot}
### PLOT - funnel plot
#pdf(file="Fig_funnel_alldata.pdf",width=6,height=4,pointsize=10)
par(mfcol=c(1,1)) 
par(mar=c(4,4,2,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-8,8), xlab = "Effect size [Hd]", ylab="Precision [1/SE]", main="")
abline(v=0,lty=3)
#dev.off()
```

## TODO - change to MCMC model
```{r publ bias tests}
######## random-effect model with ArticleID as random effect:
res_MA <- rma.mv(yi=d, V=Vd, random=list(~1|ArticleID), data=dat, method="REML") 
summary(res_MA) ### estimate  0.1679 CI  0.0550  0.2808  **

Residuals <- residuals(res_MA)
Precision <- sqrt(1/res_MA$vi)
PB_model <- rma(yi=Residuals, sei=1/Precision) 
summary(PB_model)
funnel(PB_model, yaxi="seinv")
# Trim and fill
TF <- trimfill(PB_model)
TF #Estimated number of missing studies on the left side: 32 (SE = 9.8892)
funnel(TF)
# Egger's regression test
regtest(PB_model, model="lm") #test for funnel plot asymmetry: t = 2.9146, df = 230, p = 0.0039
ranktest(PB_model) #does not work - value out of range
```


```{r funnel plot}
##################### PLOT - funnel plots ##################### 
#pdf(file="plots/Fig_funnels_prelim.pdf",width=7,height=3,pointsize=14)
par(mfrow=c(1,3))
par(mar=c(4,4,4,1))
plot(dat$Hd, sqrt(1/dat$HdVar), xlim=c(-3,3), ylim=c(0,3), xlab = "effect size [Hd]", ylab="Precision [1/SE]", frame.plot=FALSE, main="A")
abline(v=0,lty=3)
abline(v=0.168,lty=1)
funnel(TF, xlim=c(-3,3), xlab = "effect size [Hd]", ylab="Standard Error [SE]",
       back="white", shade="lightgray", bg="red", main="B")
abline(v=0,lty=3)
plot(Residuals, Precision, xlim=c(-3,3), ylim=c(0,3), xlab = "Residuals", ylab="Precision [1/SE]", frame.plot=FALSE, main="C")
abline(v=0,lty=3)
dev.off()
```



#### SENSITIVITY ANALYSIS

```{r robust model}
#MA model - using a marix or vector to W which is equivalent to 'weights' in rma
#should bemore robust to publication bias (Henmi and Copas 2010)
robustml_m <- rma.mv(yi = Hd, V = HdVar, W = 1/dat$HdVar, random = list(~1|ArticleID, ~1|EffectID), method = "REML", data = dat)
summary(robustml_m) #M 0.1622 SE 0.0600  CI  0.0446  0.2798  **

```




#### OTHER
```{r test contrasts}
library(multcomp)
res_lat_prop <- rma.mv(yi=Hd, V=HdVar, mod = ~Sex-1, random=list(~1|ArticleID), data = dat, method="REML") 
summary(res_lat_prop) #latency - prop diff

glht(res_lat_prop, linfct = mcp(Sex = "Tukey")) #does not work
test1 <- glht(res_lat_prop, linfct=rbind(c(1,-1,0), c(1,0,-1), c(0,01,-1)), test=adjusted("none"))
summary(test1)
str(test1)
confint(test1)
plot(test1)

#The cld function = compact letter display (CLD) 
cld(test1) #does not work (because test1 is not Tukey?)
cld(summary(test1))
```






```{r MR OLD}
#res_species_df <- data.frame(Model = substr(attr(ssp$b,"dimnames")[[1]], 14, 50), M = ssp$b, CI.lb = ssp$ci.lb, CI.ub = ssp$ci.ub, I2=NA, pch=20)
#res_species_df <- res_species_df[match(tree_lat_prop$tip.label, res_species_df$Model),] #reorder dataframe to match order of the tip labels on the tree
# # tidy up extracted results table
# res_species_df$M <- round(res_species_df$M,3)
# res_species_df$CI.lb <- round(res_species_df$CI.lb,3)
# res_species_df$CI.ub <- round(res_species_df$CI.ub,3)
# res_species_df$Signif <- ifelse(res_species_df$CI.lb>0 | res_species_df$CI.ub<0, "*", "") #add column with stars for estimates that significantly differ from zero
# count_animals <- data.frame(Model=names(table(dat$Species_Latin)), k=table(dat$Species_Latin)) #count how many ES per species
# merged_res_species_df <- merge(res_species_df, count_animals, all=FALSE, sort=FALSE)
# tab <- read.csv("tables/papers_table_v2.csv")
# table(tab$Species)
# count_papers <- data.frame(Model=names(table(tab$Species)), K=table(tab$Species)) #count how many papers per species
# merged_res_species_df2 <- merge(merged_res_species_df, count_papers, all=FALSE, sort=FALSE)
# merged_res_species_df2 <- rbind(merged_res_species_df2, data.frame(Model=c("Meta-analytic mean "), M=res$M[1], CI.lb=res$CI.lb[1], CI.ub=res$CI.ub[1], I2=NA, pch=18, Signif="*", k.Var1 = NA, k.Freq=sum(merged_res_species_df2$k.Freq), K.Var1=NA, K.Freq=sum(merged_res_species_df2$K.Freq)))
# write.csv(merged_res_species_df2,"tables/MR_species_res.csv")

### PLOT - species phylogeny and forest plot 1

# pdf(file="plots/Fig_species_v1.pdf",width=8,height=6,pointsize=10)
# layout(matrix(c(1,2),1), c(1.5,3), c(1.2,3))
# par(mar=c(5.2,2,3.1,0))
# plot(tree_lat_prop, font=1, cex=0.8, x.lim=1, show.tip.label = FALSE)
# par(mar=c(4,7,1,0))
# plot(merged_res_species_df2$M, 1:length(merged_res_species_df2$M), ylab=NA, yaxt="n", bty="n", xlim=c(-5,5), ylim=c(0.25, length(merged_res_species_df2$M)+.5), xlab="effect size [Hd]", pch=merged_res_species_df2$pch, cex=1.5, cex.axis=.9)
# abline(v=0,lty=3)
# mtext(merged_res_species_df2$Model[1:length(merged_res_species_df2$Model)], 2, -1, at=1:length(merged_res_species_df2$Model), las=2, cex=.8, font=3)
# #mtext(merged_res_species_df2$Model[1:2], 2, -1, at=1:2, las=2, cex=.8, font=1)
# segments(merged_res_species_df2$CI.lb, 1:length(merged_res_species_df2$M), merged_res_species_df2$CI.ub, 1:length(merged_res_species_df2$M), lwd=1.25)
# for (i in 1:length(rownames(merged_res_species_df2))) mtext(merged_res_species_df2$Signif[i], 2, -1.5, at=i, las=2, cex=.7) #add stars
# mtext(merged_res_species_df2$k.Freq, 4, -2.8, at=1:(length(merged_res_species_df2$k.Freq)), las=2, cex=.8, font=1, adj=1) #add k values
# mtext(merged_res_species_df2$K.Freq, 4, -1.4, at=1:(length(merged_res_species_df2$K.Freq)), las=2, cex=.8, font=1, adj=1) #add K values
# mtext("k", 4, -2.8, at=length(merged_res_species_df2$k.Freq)+1, las=2, cex=.8, font=1, adj=1)
# mtext("K", 4, -1.4, at=length(merged_res_species_df2$K.Freq)+1, las=2, cex=.8, font=1, adj=1)
# dev.off()
# 
# ### PLOT - species phylogeny and forest plot v2 (narrower)
# 
# pdf(file="plots/Fig_species_v2.pdf",width=6.5,height=6.5,pointsize=11)
# layout(matrix(c(1,2),1), c(1,3), c(1,3))
# par(mar=c(5.2,1,3.1,0))
# plot(tree_lat_prop, font=1, cex=0.8, x.lim=1, show.tip.label = FALSE)
# par(mar=c(4,7,1,0))
# plot(merged_res_species_df2$M, 1:length(merged_res_species_df2$M), ylab=NA, yaxt="n", bty="n", xlim=c(-2,2), ylim=c(0.25, length(merged_res_species_df2$M)+.5), xlab="effect size [Hd]", pch=merged_res_species_df2$pch, cex=1.5, cex.axis=.9, xaxp=c(-1, 1, 4) )
# abline(v=0,lty=3)
# mtext(merged_res_species_df2$Model[1:length(merged_res_species_df2$Model)], 2, -1, at=1:length(merged_res_species_df2$Model), las=2, cex=.8, font=3)
# #mtext(merged_res_species_df2$Model[1:2], 2, -1, at=1:2, las=2, cex=.8, font=1)
# segments(merged_res_species_df2$CI.lb, 1:length(merged_res_species_df2$M), merged_res_species_df2$CI.ub, 1:length(merged_res_species_df2$M), lwd=1.25)
# for (i in 1:length(rownames(merged_res_species_df2))) mtext(merged_res_species_df2$Signif[i], 2, -1.5, at=i, las=2, cex=.7) #add stars
# mtext(merged_res_species_df2$k.Freq, 4, -2.8, at=1:(length(merged_res_species_df2$k.Freq)), las=2, cex=.8, font=1, adj=1) #add k values
# mtext(merged_res_species_df2$K.Freq, 4, -1.4, at=1:(length(merged_res_species_df2$K.Freq)), las=2, cex=.8, font=1, adj=1) #add K values
# mtext("k", 4, -2.8, at=length(merged_res_species_df2$k.Freq)+1, las=2, cex=.8, font=1, adj=1)
# mtext("K", 4, -1.4, at=length(merged_res_species_df2$K.Freq)+1, las=2, cex=.8, font=1, adj=1)
# dev.off()

#NOTE: fine edit plot formatting in AdobeIllustrator
```


<!-- - Sex    -->
<!-- ```{r MR all data univariate: Sex}  -->
<!-- ######## random-effect model with Sex as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$Sex, ref="male"), random=list(~1|ArticleID), data = dat, method="REML") #male-female Signif -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$Sex, ref="female"), random=list(~1|ArticleID), data = dat, method="REML") #male-female Signif -->
<!-- ######## random-effect model with Sex as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Sex -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #only males Signif -->
<!-- res <- rbind(res, data.frame(Model=c("Univariate Meta-Regression models:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Sex:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Females","  Males","  Mixed-sex"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20), cld=c("a","b","ab")), data.frame(k=table(dat$Sex)))) -->
<!-- ``` -->

<!-- - Age    -->
<!-- ```{r MR all data univariate: Age}  -->
<!-- ######## random-effect model with Age as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$Age, ref="adult"), random=list(~1|ArticleID), data = dat, method="REML") #no diff -->
<!-- ######## random-effect model with Age as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Age -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #adult only Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Age:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Adults","  Juveniles"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","a")), data.frame(k=table(dat$Age)))) -->
<!-- ``` -->

<!-- - Animal source -->
<!-- ```{r MR all data univariate: Captive_Wild.caught}  -->
<!-- table(dat$Captive_Wild.caught) -->
<!-- ######## random-effect model with Captive_Wild.caught as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~Captive_Wild.caught, random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with Captive_Wild.caught as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Captive_Wild.caught -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #captive Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Source of animals:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Captive", "  Wild-caugh"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","a")), data.frame(k=table(dat$Captive_Wild.caught)))) -->
<!-- ``` -->

<!-- - AffectManipCat    -->
<!-- ```{r MR all data univariate: AffectManipCat}  -->
<!-- ######## random-effect model with AffectManipCat as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$AffectManipCat, ref="stress"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$AffectManipCat, ref="enrichment"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with AffectManipCat as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~AffectManipCat -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #stress only Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Affect manipulation:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Enrichment","  Other","  Stress"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20), cld=c("a","a","a")), data.frame(k=table(dat$AffectManipCat)))) -->
<!-- ``` -->

<!-- - ComparisonCategory    -->
<!-- ```{r MR all data univariate: ComparisonCategory}  -->
<!-- ######## random-effect model with ComparisonCategory as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$ComparisonCategory, ref="Benign-Worse"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$ComparisonCategory, ref="Better-Benign"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with ComparisonCategory as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~ComparisonCategory, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #Benign-Worse - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Comparison type:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Benign-Worse","  Better-Benign","  Better-Worse"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20), cld=c("a","a","a")), data.frame(k=table(dat$ComparisonCategory)))) -->
<!-- ``` -->

<!-- - AffectManipTiming  -->
<!-- ```{r MR all data univariate: AffectManipTiming}  -->
<!-- ######## random-effect model with AffectManipTiming as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$AffectManipTiming, ref="before"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$AffectManipTiming, ref="during"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$AffectManipTiming, ref="long-term"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with AffectManipTiming as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~AffectManipTiming -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #before - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Affect manipulation timing:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Before","  Before/during","  During","  Long-term"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20,20), cld=c("a","a","a","a")), data.frame(k=table(dat$AffectManipTiming)))) -->
<!-- ``` -->

<!-- - CueTypeCat    -->
<!-- ```{r MR all data univariate: CueTypeCat}  -->
<!-- ######## random-effect model with CueTypeCat as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$CueTypeCat, ref="auditory"), random=list(~1|ArticleID), data = dat, method="REML")  #auditory diff from spatial, visual -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$CueTypeCat, ref="olfactory"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$CueTypeCat, ref="spatial"), random=list(~1|ArticleID), data = dat, method="REML")  #spatial-auditory diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$CueTypeCat, ref="tactile"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with CueTypeCat as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~CueTypeCat -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #Auditory - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Cue type:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Auditory","  Olfactory","  Spatial","  Tactile","  Visual"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20,20,20), cld=c("a","ab","b","ba","b")), data.frame(k=table(dat$CueTypeCat)))) -->
<!-- ``` -->

<!-- - FoodDeprived    -->
<!-- ```{r MR all data univariate: FoodDeprived}  -->
<!-- ######## random-effect model with FoodDeprived as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$FoodDeprived, ref="yes"), random=list(~1|ArticleID), data = dat, method="REML") #no diff -->
<!-- ######## random-effect model with FoodDeprived as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~FoodDeprived -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #both Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Food deprived:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  No","  Yes"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","a")), data.frame(k=table(dat$FoodDeprived)))) -->
<!-- ``` -->

<!-- - TaskType    -->
<!-- ```{r MR all data univariate: TaskType}  -->
<!-- ######## random-effect model with TaskType as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$TaskType, ref="active choice"), random=list(~1|ArticleID), data = dat, method="REML")  # diff -->
<!-- ######## random-effect model with TaskType as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~TaskType -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #active choice Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Task type:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Active choice","  Go/No-go"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","b")), data.frame(k=table(dat$TaskType)))) -->
<!-- ``` -->

<!-- - StudyDesign    -->
<!-- ```{r MR all data univariate: StudyDesign}  -->
<!-- ######## random-effect model with StudyDesign as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$StudyDesign, ref="within (before-after)"), random=list(~1|ArticleID), data = dat, method="REML") #all diff from within (before-after) -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$StudyDesign, ref="within (crossover)"), random=list(~1|ArticleID), data = dat, method="REML") #crossover diff from before-after -->
<!-- ######## random-effect model with Randomized_WithinBetween as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~StudyDesign -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #within-subject before-and-after - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Study design:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Between-subject", "  Within-subject before-and-after", "  Within-subject crossover "), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20), cld=c("a","b","a")), data.frame(k=table(dat$StudyDesign)))) -->
<!-- ``` -->

<!-- - Automated    -->
<!-- ```{r MR all data univariate: Automated}  -->
<!-- ######## random-effect model with Automated as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$Automated, ref="no"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with Automated as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Automated -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #no - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Automated testing:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  No", "  Yes"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","a")), data.frame(k=table(dat$Automated)))) -->
<!-- ``` -->

<!-- - Blind    -->
<!-- ```{r MR all data univariate: Blind}  -->
<!-- ######## random-effect model with Blind as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$Blind, ref="no"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with Blind as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Blind -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #no - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Blind testing:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  No", "  Yes"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","a")), data.frame(k=table(dat$Blind)))) -->
<!-- ``` -->

<!-- - MeasureType  -->
<!-- ```{r MR all data univariate: MeasureType}  -->
<!-- ######## random-effect model with MeasureType as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$MeasureType, ref="latency"), random=list(~1|ArticleID), data = dat, method="REML")  #latency - prop diff -->
<!-- ######## random-effect model with MeasureType as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~MeasureType -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #proportion - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Outcome measure type reported:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Latency", "  Proportion "), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","b")), data.frame(k=table(dat$MeasureType)))) -->

<!-- res_lat_prop_phylo_MT <- rma.mv(yi=d, V=VCV, mod = ~MeasureType-1, random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), R=list(Species_Latin=CorMatrix_all), data = dat, method="REML")  -->
<!-- summary(res_lat_prop_phylo_MT) #   -->
<!-- #calc.I2(dat$Vd, res_lat_prop_phylo_MT) #89%; CALUCALTE R^2 INSTEAD!!! -->
<!-- # -->
<!-- ``` -->

<!-- - ReinforcementCat -->
<!-- ```{r MR all data univariate: ReinforcementCat}  -->
<!-- ######## random-effect model with ReinforcementCat as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$ReinforcementCat, ref="R-Null"), random=list(~1|ArticleID), data = dat, method="REML") #R-Null diff from R-P and R-R -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$ReinforcementCat, ref="R-P"), random=list(~1|ArticleID), data = dat, method="REML") #R-P diff from R-Null  -->
<!-- ######## random-effect model with ReinforcementCat as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~ReinforcementCat -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #R-P and R-R - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Reinformcement for training cues:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Reward-Null", "  Reward-Punishement", "  Reward-Reward"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20), cld=c("a","b","b")), data.frame(k=table(dat$ReinforcementCat)))) -->
<!-- ``` -->

<!-- - AmbigReinforced -->
<!-- ```{r MR all data univariate: AmbigReinforced}  -->
<!-- ######## random-effect model with AmbigReinforced as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$AmbigReinforced, ref="yes"), random=list(~1|ArticleID), data = dat, method="REML")  #no diff -->
<!-- ######## random-effect model with AmbigReinforced as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~AmbigReinforced -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #no = Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Ambiguous cues reinforced:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  No", "  Yes"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20), cld=c("a","a")), data.frame(k=table(dat$AmbigReinforced)))) -->
<!-- ``` -->

<!-- - ScalePoint -->
<!-- ```{r MR all data univariate: ScalePoint}  -->
<!-- ######## random-effect model with ScalePoint as a moderator, differences: -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$ScalePoint, ref="A"), random=list(~1|ArticleID), data = dat, method="REML") #no diff -->
<!-- rma.mv(yi=d, V=Vd, mod = ~relevel(dat$ScalePoint, ref="B"), random=list(~1|ArticleID), data = dat, method="REML") #no diff -->
<!-- ######## random-effect model with ScalePoint as a moderator, intercepts: -->
<!-- res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~ScalePoint -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_lat_prop) #A, B - Signif -->
<!-- res <- rbind(res, data.frame(Model=NA, M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add empty line to results table -->
<!-- res <- rbind(res, data.frame(Model=c("Data point position for ambiguous cues:"), M=NA, CI.lb=NA, CI.ub=NA, pch=NA, k.Var1=NA, k.Freq=NA, cld=NA)) #add caption line to results table -->
<!-- res <- rbind(res, cbind(data.frame(Model=c("  Near positive", "  Midpoint", "  Near negative"), M=res_lat_prop$b, CI.lb=res_lat_prop$ci.lb, CI.ub=res_lat_prop$ci.ub, pch=c(20,20,20), cld=c("a","a","a")), data.frame(k=table(dat$ScalePoint)))) -->
<!-- ``` -->


<!-- ```{r tidy results}  -->
<!-- #names(dat) -->
<!-- #res[,1] -->
<!-- # tidy up extracted results table -->
<!-- res$M <- round(res$M,3) -->
<!-- res$CI.lb <- round(res$CI.lb,3) -->
<!-- res$CI.ub <- round(res$CI.ub,3) -->
<!-- res$Signif <- ifelse(res$CI.lb>0 | res$CI.ub<0, "*", "") #add column with stars for estimates that significantly differ from zero -->
<!-- write.csv(res,"tables/MR_univariate_res.csv") -->
<!-- ``` -->

<!-- ### PLOT - univariate forest plot -->

<!-- ```{r MR all data univariate plot}  -->
<!-- res$Model -->
<!-- revres <- res[rev(rownames(res)),] #reverse for plotting (from bottom to top) -->
<!-- #res[c(1,10,2),] -->
<!-- pdf(file="plots/Fig_univariate_v0.pdf",width=6,height=12,pointsize=10) -->
<!-- layout(matrix(1,1), c(1,1), c(1,1)) -->
<!-- par(mar=c(4,12,1,1)) -->
<!-- plot(revres$M, 1:length(revres$M), ylab=NA, yaxt="n", bty="n", xlim=c(-1.4, 1.4), ylim=c(0.25, length(revres$M)+.5), xlab="effect size [Hd]", pch=revres$pch, cex=1.5, cex.axis=.9) -->
<!-- abline(v=0,lty=3) -->
<!-- mtext(revres$Model[1:length(revres$Model)], 2, 10, at=1:length(revres$Model), las=2, cex=.8, font=3, adj=0) -->
<!-- #mtext(revres$Model[1:2], 2, -1, at=1:2, las=2, cex=.8, font=1) -->
<!-- segments(revres$CI.lb, 1:length(revres$M), revres$CI.ub, 1:length(revres$M), lwd=1.25) #add whiskers -->
<!-- mtext("k", 4, -1.7, at=nrow(revres)+3, las=2, cex=.8, font=1) #add k-letter -->
<!-- mtext(revres$k.Freq, 4, -1, at=1:(length(revres$k.Freq)), las=2, cex=.8, font=1, adj=0.5) #add k-values -->
<!-- mtext(revres$cld, 4, -2.5, at=1:(length(revres$cld)), las=2, cex=.8, font=1, adj=0.5) #add letters -->
<!-- for (i in 1:length(rownames(revres))) mtext(revres$Signif[i], 4, -3.2, at=i, las=2, cex=1.2) #add stars -->
<!-- dev.off() -->
<!-- ``` -->


<!-- #### MULTIVARIATE MR MODELS -->

<!-- ```{r multivariate MR models} -->
<!-- ########### Multivariate models: -->

<!-- ######## full random-effect model with selected moderator (only ones where levels diff): -->
<!-- res_MV <- rma.mv(yi=d, V=Vd, mod = ~ Sex + Captive_Wild.caught + CueTypeCat + StudyDesign + Automated + MeasureType + ReinforcementCat, random=list(~1|ArticleID), data = dat, method="REML") -->
<!-- summary(res_MV) -->

<!-- #res_MV <- rma.mv(yi=d, V=Vd, mod = ~ relevel(dat$Sex, ref="male") + Captive_Wild.caught + CueTypeCat + relevel(dat$StudyDesign, ref="within (before-after)") + Automated + relevel(dat$MeasureType, ref="proportion") + ReinforcementCat, random=list(~1|ArticleID), data = dat, method="REML") -->
<!-- #summary(res_MV) -->

<!-- s2m <- sum(1/res_MV$vi) * (res_MV$k-1) / (sum(1/res_MV$vi)^2 - sum((1/res_MV$vi)^2)); s2m #s^2_m: variation within study = random error -->
<!-- s2t <- sum(res_MV$sigma2) + s2m; s2t #s^2_t -->
<!-- total_I2_res_MV <- sum(res_MV$sigma2)/s2t; total_I2_res_MV*100 # the "total" variation 6.65% -->
<!-- ssp <- summary(res_MV) -->
<!-- res_MV_df <- data.frame(Model = "Multivariate Meta-Regression", M = ssp$b, CI.lb = ssp$ci.lb, CI.ub = ssp$ci.ub, I2=total_I2_res_MV*100, pch=20) -->

<!-- # tidy up extracted results table -->
<!-- res_MV_df$M <- round(res_MV_df$M,3) -->
<!-- res_MV_df$CI.lb <- round(res_MV_df$CI.lb,3) -->
<!-- res_MV_df$CI.ub <- round(res_MV_df$CI.ub,3) -->
<!-- res_MV_df$Signif <- ifelse(res_MV_df$CI.lb>0 | res_MV_df$CI.ub<0, "*", "") #add column with stars for estimates that significantly differ from zero -->
<!-- write.csv(res_MV_df,"tables/MR_MV_res.csv") -->

<!-- #res_full_1 <- rma.mv(yi=d, V=Vd, mod = ~ Sex + relevel(dat$CueTypeCat, ref="spatial") + #relevel(dat$Randomized_WithinBetween, ref="between-subject randomized? (no info)") + Automated +relevel(dat$MeasureType, ref="proportion"), random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- #summary(res_full_1) -->


<!-- ######## random-effect model with 2 moderators: -->
<!-- res_MR_int <- rma.mv(yi=d, V=Vd, mod = ~ TaskType + MeasureType, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_MR_int) -->

<!-- ######## random-effect model with 2 moderators and interaction: -->
<!-- res_MR_int <- rma.mv(yi=d, V=Vd, mod = ~ TaskType * MeasureType -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_MR_int) -->

<!-- res_MR_int <- rma.mv(yi=d, V=Vd, mod = ~ TaskType * relevel(dat$MeasureType, ref="latency") -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_MR_int) -->

<!-- res_MR_int <- rma.mv(yi=d, V=Vd, mod = ~ TaskType * relevel(dat$MeasureType, ref="proportion") -1, random=list(~1|ArticleID), data = dat, method="REML")  -->
<!-- summary(res_MR_int) -->

<!-- boxplot(Hd ~ TaskType * MeasureType, data = dat, varwidth=TRUE) -->
<!-- boxplot(Hd ~ TaskType, data = dat) -->
<!-- boxplot(Hd ~ MeasureType, data = dat) -->
<!-- ``` -->



#### PUBLICATION BIAS

```{r preliminary funnel plot}
### PLOT - funnel plot
pdf(file="Fig_funnel_alldata.pdf",width=6,height=4,pointsize=10)
par(mfcol=c(1,1)) 
par(mar=c(4,4,2,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-6.5,6.5), xlab = "Effect size [Hg]", ylab="Precision [1/SE]", main="")
abline(v=0,lty=3)
dev.off()
```

```{r publ bias tests}
######## random-effect model with ArticleID as random effect:
res_MA <- rma.mv(yi=d, V=Vd, random=list(~1|ArticleID), data = dat, method="REML") 
summary(res_MA) ### estimate  0.1679 CI  0.0550  0.2808  **

Residuals <- residuals(res_MA)
Precision <- sqrt(1/res_MA$vi)
PB_model <- rma(yi=Residuals, sei=1/Precision) 
summary(PB_model)
funnel(PB_model, yaxi="seinv")
# Trim and fill
TF <- trimfill(PB_model)
TF #Estimated number of missing studies on the left side: 32 (SE = 9.8892)
funnel(TF)
# Egger's regression test
regtest(PB_model, model="lm") #test for funnel plot asymmetry: t = 2.9146, df = 230, p = 0.0039
ranktest(PB_model) #does not work - value out of range

##################### PLOT - funnel plots ##################### 
pdf(file="plots/Fig_funnels_prelim2.pdf",width=7,height=3,pointsize=14)
par(mfrow=c(1,3))
par(mar=c(4,4,4,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-8,8), ylim=c(0,10), xlab = "effect size [Hg]", ylab="Precision [1/SE]", frame.plot=FALSE, main="A")
abline(v=0,lty=3)
abline(v=0.168,lty=1)
funnel(TF, xlim=c(-3,3), xlab = "effect size [Hg]", ylab="Standard Error [SE]",
       back="white", shade="lightgray", bg="red", main="B")
abline(v=0,lty=3)
plot(Residuals, Precision, xlim=c(-3,3), ylim=c(0,3), xlab = "Residuals", ylab="Precision [1/SE]", frame.plot=FALSE, main="C")
abline(v=0,lty=3)
dev.off()
```



#### SENSITIVITY ANALYSIS

```{r robust model}
#MA model - using a marix or vector to W which is equivalent to 'weights' in rma
#should bemore robust to publication bias (Henmi and Copas 2010)
robustml_m <- rma.mv(yi = Hd, V = Vd, W = 1/dat$Vd, random = list(~1|ArticleID, ~1|EffectID), method = "REML", data = dat)
summary(robustml_m) #M 0.1622 SE 0.0600  CI  0.0446  0.2798  **

```

#### OTHER
```{r test contrasts}
library(multcomp)
res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Sex-1, random=list(~1|ArticleID), data = dat, method="REML") 
summary(res_lat_prop) #latency - prop diff

glht(res_lat_prop, linfct = mcp(Sex = "Tukey")) #does not work
test1 <- glht(res_lat_prop, linfct=rbind(c(1,-1,0), c(1,0,-1), c(0,01,-1)), test=adjusted("none"))
summary(test1)
str(test1)
confint(test1)
plot(test1)

#The cld function = compact letter display (CLD) 
cld(test1) #does not work (because test1 is not Tukey?)
cld(summary(test1))
```




####################################### EXTRA

Is there correlation between  measurements from the same experiment reported as latency and proportion?

```{r prop lat within study} 
#### look for studies that have both prop and lat
names(dat)
#table(dat$MeasureType, dat$ArticleID) # Looks correct
#table(dat$MeasureType, dat$ExperimentID) 
dat_horiz <- merge(dat_lat, dplyr::select(dat_prop, ExperimentID, ScalePoint, d, Vd), by = c("ExperimentID", "ScalePoint"))
dat_horiz <- droplevels(dat_horiz)
str(dat_horiz)

length(unique(dat_horiz$ExperimentID)) #11 experimentswhere both latency and proportion reported
length(unique(dat_horiz$ArticleID)) #9 studies where both latency and proportion reported
#table(dat_horiz$ExperimentID, dat_horiz$ScalePoint)
#table(dat_horiz$ExperimentID, dat_horiz$ArticleID)
plot(dat_horiz$d.x, dat_horiz$d.y) 
plot(dat_horiz$d.x, dat_horiz$d.y, col=dat_horiz$ExperimentID) #make it prettier
cor.test(dat_horiz$d.x, dat_horiz$d.y) # Pearson's product-moment correlation = 0.3292155 t = 1.8449, df = 28, p-value = 0.07566, 95 percent confidence interval: -0.03523248  0.61637844
#we did not need more complex model to account for non-independence and to weight by variance, after adding these cor could be even weaker
library(nlme)
res_cor <- lme(d.y ~ d.x, random=list(~1|ArticleID), correlation=corGaus(form=~1|ArticleID), data=dat_horiz)
res_cor

#using metafor multivariate model
dat_horiz.y <- subset(dat_horiz, select=-c(d.x,Vd.x))
dat_horiz.y$MeasureType <- "y"
dat_horiz.x <- subset(dat_horiz, select=-c(d.y,Vd.y))
dat_horiz.x$MeasureType <- "x"
library(data.table)
setnames(dat_horiz.y, old = c('d.y','Vd.y'), new = c('d','Vd'))
setnames(dat_horiz.x, old = c('d.x','Vd.x'), new = c('d','Vd'))
dat_horiz.xy <- rbind(dat_horiz.x, dat_horiz.y)
str(dat_horiz.xy)

#dat_horiz.xy$MeasureType <- factor(datallfm$sex, levels=c("female","male"))
VCV.xy <- make_VCV_matrix(data = dat_horiz.xy, V = "Vd", cluster = "ExperimentID", obs = "EffectID")
dim(VCV.xy)
res.xy <- rma.mv(d, VCV.xy, mods = ~ MeasureType - 1, data = dat_horiz.xy, random = ~ MeasureType | ExperimentID, struct = "UN")
res.xy
### contrast for differences by MeasureType
anova(res.xy, L=c(1,-1))
```


********************************************************************************************

# Publication bias analysis

PUBLICATION BIAS TESTS (Egger's test) and calculating RESIDUALS for the final funnel plot
--------------------------------------------------------------------------------
Checking the intercepts of Egger’s regressions performed on the model residuals and measurement errors.
Evidence for publication bias if the intercept is significantly different from 0.
Following Moreno et al. 2009 (BMC Medical Research Methodology) - Eggar regression can be reconfigured into a meta-regression model. However, following Nakagawa & Santos (2012), this meta-regression still assumes non-independence, so in our model we put SE into other model together with other significant moderators

```{r Egger's publication bias tests, eval=FALSE, echo=FALSE, message=FALSE}

#load("./Rdata/MR_all_Full_1.Rdata") #with sex and measure type only as moderators
#summary(MR_all_Full_1)

prior1 <- list(R=list(V=1,nu=.002), G=list(G1=list(V=1,nu=1, alpha.mu=0, alpha.V=1000), G2=list(V=1,nu=1, alpha.mu=0, alpha.V=1000), G3=list(V=1,fix=1))) #expanded parameter prior
ES <- dat$d
VES <- dat$Vd
invVC <- as(solve(VCV), "dgCMatrix")

#bayesian models
set.seed(111)
bayesian_full1.1 <- MCMCglmm(ES ~ Sex + MeasureType -1, random=~ArticleID+ExperimentID+EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior1)
set.seed(112)
bayesian_full1.2 <- MCMCglmm(ES ~ Sex + MeasureType -1, random=~ArticleID+ExperimentID+EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior1)
set.seed(113)
bayesian_full1.3 <- MCMCglmm(ES ~ Sex + MeasureType -1, random=~ArticleID+ExperimentID+EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior1)
save(bayesian_full1.1,bayesian_full1.2, bayesian_full1.3,file="Rdata/bayesian_runs_full1.RData") 

summary(bayesian_full1.1)
model <- bayesian_full1.1
Pred <- predict(model, marginal=~EffectID)
ES <- dat$d
VES <- dat$Vd
Prec <- 1/sqrt(VES) # Precision = 1/sqrt(V)
es <- ES-Pred
zes <- es*Prec
save(es,Prec,file="Rdata/residuals_Prec.RData")
set.seed(112)
Egger <- MCMCglmm(zes~Prec,family="gaussian", data=data.frame(ES=es,Prec=Prec), verbose=TRUE, nitt=50000, thin=25, burnin=25000)
summary(Egger) #no PB
plot(es, Prec, xlab="Egger regressed effect sizes", ylab=expression("Precision  "(1/sqrt(Variance))))
mean(zes)
mean(es)

round(summary(Egger)$solutions[1,],3)

save(Egger,file="Rdata/Egger_regr.RData")
#load("Rdata/Egger_regr.RData")
```




###############################################################################################################
###########################################        SUBSET - using max ES per experiment         ###########################################
# (if there were more than 1 ambiguous cues used in traials)        ########################################### 
###############################################################################################################

```{r subset data max ES} 
dim(dat) #265 70
names(dat)

# View(tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(n())) ) #how many rows within each group 105, 121 129

dat_max <- tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(max(., na.rm = TRUE))) #which d value is max within each group
dat_max$d
#hist(dat_max$d)
dim(dat_max) #107
unique(dat_max$d) #all 107 - can use to merge back

dat_max_merged <- dplyr::inner_join(dat, dat_max, by = c("ExperimentID","MeasureType","GroupID","ComparisonCategory", "Sex","d"))

dim(dat_max_merged)
names(dat_max_merged)
#View(dat_max_merged)

dat_max <- dat_max_merged
str(dat_max)

## prepare VCV matrix - all data
VCV_max <- make_VCV_matrix(data = dat_max, V = "Vd", cluster = "GroupID", obs = "EffectID")
```

```{r subset data max2 ES} 
dim(dat) #265 70
names(dat)

# View(tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(n())) ) #how many rows within each group 105, 121 129

dat_max2 <- tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(max(abs(.), na.rm = TRUE))) #which d value is max within each group
dat_max2$d
#hist(dat_max$d)
dim(dat_max2) #107
unique(dat_max2$d) #all 107 - can use to merge back

dat_max2_merged <- dplyr::inner_join(dat, dat_max2, by = c("ExperimentID","MeasureType","GroupID","ComparisonCategory", "Sex","d"))

dim(dat_max2_merged)
names(dat_max2_merged)
#View(dat_max_merged)

dat_max2 <- dat_max2_merged
str(dat_max2)

## prepare VCV matrix - all data
VCV_max <- make_VCV_matrix(data = dat_max2, V = "Vd", cluster = "GroupID", obs = "EffectID")
```

## Meta-analytical models

```{r MA all data max} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_all_random_max <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     dat=dat_max, method="REML") 
summary(MA_all_random_max) 
calc.I2(dat_max$Vd, MA_all_random_max) 
save(MA_all_random_max, file = "Rdata/MA_all_random_max.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_all_random_VCV_max <- rma.mv(yi = d, V = VCV_max, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max, method = "REML")
summary(MA_all_random_VCV_max)
calc.I2(dat_max$Vd, MA_all_random_VCV_max)
save(MA_all_random_VCV_max, file = "Rdata/MA_all_random_VCV_max.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
# MA_all_random_VCV_phylo_max <- rma.mv(yi=d, V=VCV_max, 
#                              random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
#                              R = list(Species_Latin = CorMatrix_all),
#                              data = dat_max, method = "REML")  #no convergence
# summary(MA_all_random_VCV_phylo_max)   
#calc.I2(dat$Vd, MA_all_random_VCV_phylo_max) 
#save(MA_all_random_VCV_phylo_max, file = "Rdata/MA_all_random_VCV_phylo_max.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_all_max <- rma.mv(yi=d, V=VCV_max, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max, method = "REML") 
summary(MA_all_max)    #0.5345  0.3857  0.6833  ***
calc.I2(dat_max$Vd, MA_all_max) #78.7% Htotal, 0% phylogeny, 9.1% article
save(MA_all_max, file = "Rdata/MA_all_max.Rdata")
```


## Sensitivity analysis for meta-analytic models

```{r MA all data max - sensitivity tests}
#robumeta (without phylogeny and VCV)
MA_all_max_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat_max)
print(MA_all_max_robu) #0.53   0.4393   0.676 ***
#save(MA_all_max_robu,file="Rdata/MA_all_max_robu.Rdata")

#robust metafor
MA_all_max_robust <- robust(MA_all_max, cluster  =  dat_max$ExperimentID)
summary(MA_all_max_robust) #0.5345  0.3931  0.6760  ***
save(MA_all_max_robust,file = "Rdata/MA_all_max_robust.Rdata")
```

## Meta-regression models    

Univariate models for:    
- Species_Latin (Species model)   
- Sex   
- Age   
- Source of Animals
- AffectManipCat   
- AffectManipTiming   
- ComparisonCategory   
- CueTypeCat   
- FoodDeprived   
- TaskType   
- Randomized_WithinBetween   
- Automated   
- Blind   
- MeasureType 
- ReinforcementCat
- AmbigReinforced
- ScalePoint


#Univariate models:

- Species_Latin (Species model) 
```{r MR all data max - Species model}
MR_all_max_species <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_species) # no species with clear effect
save(MR_all_max_species, file = "Rdata/MR_all_max_species.Rdata")

MR_all_max_species_nophylo <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max, method="REML") 
summary(MR_all_max_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_all_max_species_nophylo, file = "Rdata/MR_all_max_species_nophylo.Rdata")
```


- Sex
```{r MR all data max - Sex}
MR_all_max_sex1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_sex1) # signif intc for all
save(MR_all_max_sex1, file = "Rdata/MR_all_max_sex1.Rdata")

MR_all_max_sex <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_sex) # signif intc for females, ns diff female-male
save(MR_all_max_sex, file = "Rdata/MR_all_max_sex.Rdata")

MR_all_max_sex2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_sex2) # signif intc for males, ns diff female-male
save(MR_all_max_sex2, file = "Rdata/MR_all_max_sex2.Rdata")
```

- Age
```{r MR all data max - Age}
MR_all_max_age1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_age1) # signif intc adult and juvenile
save(MR_all_max_age1, file = "Rdata/MR_all_max_age1.Rdata")

MR_all_max_age <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_age) # ns diff adult-juvenile
save(MR_all_max_age, file = "Rdata/MR_all_max_age.Rdata")
```

- Source (Captive_Wild.caught)
```{r MR all data max - Captive_Wild.caught}
MR_all_max_source1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_source1) # signif intc captive/wild-caught
save(MR_all_max_source1, file = "Rdata/MR_all_max_source1.Rdata")

MR_all_max_source <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_source) # ns diff captive/wild-caught
save(MR_all_max_source, file = "Rdata/MR_all_max_source.Rdata")
```


- AffectManipCat
```{r MR all data max - AffectManipCat}
MR_all_max_AffectManipCat1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipCat1) # signif intc enrichment/stress
save(MR_all_max_AffectManipCat1, file = "Rdata/MR_all_max_AffectManipCat1.Rdata")

MR_all_max_AffectManipCat <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipCat) # ns diff enrichment/stress
save(MR_all_max_AffectManipCat, file = "Rdata/MR_all_max_AffectManipCat.Rdata")
```


- AffectManipTiming
```{r MR all data max - AffectManipTiming}
MR_all_max_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipTiming1) # signif intc before/during / long-term
save(MR_all_max_AffectManipTiming1, file = "Rdata/MR_all_max_AffectManipTiming1.Rdata")

MR_all_max_AffectManipTiming <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipTiming) # ns diff  before/during / long-term
save(MR_all_max_AffectManipTiming, file = "Rdata/MR_all_max_AffectManipTiming.Rdata")
```


- ComparisonCategory
```{r MR all data max - ComparisonCategory}
MR_all_max_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ComparisonCategory1) # signif intc Benign-Worse / Better-Benign / Better-Benign
save(MR_all_max_ComparisonCategory1, file = "Rdata/MR_all_max_ComparisonCategory1.Rdata")

MR_all_max_ComparisonCategory <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ComparisonCategory) # ns diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_max_ComparisonCategory, file = "Rdata/MR_all_max_ComparisonCategory.Rdata")

MR_all_max_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ComparisonCategory2) # ns diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_max_ComparisonCategory2, file = "Rdata/MR_all_max_ComparisonCategory2.Rdata")
```


- CueTypeCat
```{r MR all data max - CueTypeCat}
MR_all_max_CueTypeCat1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat1) # signif intc for all
save(MR_all_max_CueTypeCat1, file = "Rdata/MR_all_max_CueTypeCat1.Rdata")

MR_all_max_CueTypeCat <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat) # ns diff to auditory
save(MR_all_max_CueTypeCat, file = "Rdata/MR_all_max_CueTypeCat.Rdata")

MR_all_max_CueTypeCat2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat2) # ns diff to visual
save(MR_all_max_CueTypeCat2, file = "Rdata/MR_all_max_CueTypeCat2.Rdata")

MR_all_max_CueTypeCat3 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat3) # ns diff to visual
save(MR_all_max_CueTypeCat3, file = "Rdata/MR_all_max_CueTypeCat3.Rdata")

MR_all_max_CueTypeCat4 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat4) # ns diff to visual
save(MR_all_max_CueTypeCat4, file = "Rdata/MR_all_max_CueTypeCat4.Rdata")
```


- FoodDeprived
```{r MR all data max - FoodDeprived}
MR_all_max_FoodDeprived1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_FoodDeprived1) # signif intc yes / no
save(MR_all_max_FoodDeprived1, file = "Rdata/MR_all_max_FoodDeprived1.Rdata")

MR_all_max_FoodDeprived <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_FoodDeprived) # ns diff yes / no
save(MR_all_max_FoodDeprived, file = "Rdata/MR_all_max_FoodDeprived.Rdata")
```


- TaskType
```{r MR all data max - TaskType}
MR_all_max_TaskType1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_TaskType1) # signif intc active choice and go/no-go
save(MR_all_max_TaskType1, file = "Rdata/MR_all_max_TaskType1.Rdata")

MR_all_max_TaskType <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_TaskType) # ns diff active choice vs. go/no-go
save(MR_all_max_TaskType, file = "Rdata/MR_all_max_TaskType.Rdata")
```


- WithinBetween
```{r MR all data max - WithinBetween}
MR_all_max_WithinBetween1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_WithinBetween1) # signif intc within and between
save(MR_all_max_WithinBetween1, file = "Rdata/MR_all_max_WithinBetween1.Rdata")

MR_all_max_WithinBetween <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_WithinBetween) # ns diff within / between
save(MR_all_max_WithinBetween, file = "Rdata/MR_all_max_WithinBetween.Rdata")
```


- Automated
```{r MR all data max - Automated}
MR_all_max_Automated1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Automated1) # signif intc yes / no
save(MR_all_max_Automated1, file = "Rdata/MR_all_max_Automated1.Rdata")

MR_all_max_Automated <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Automated) # ns diff yes / no
save(MR_all_max_Automated, file = "Rdata/MR_all_max_Automated.Rdata")
```


- Blind
```{r MR all data max - Blind}
MR_all_max_Blind1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Blind1) # signif intc yes / no
save(MR_all_max_Blind1, file = "Rdata/MR_all_max_Blind1.Rdata")

MR_all_max_Blind <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Blind) # ns diff yes / no
save(MR_all_max_Blind, file = "Rdata/MR_all_max_Blind.Rdata")
```


- MeasureType
```{r MR all data max - MeasureType}
MR_all_max_MeasureType1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_MeasureType1) # signif intc proportion and latency
save(MR_all_max_MeasureType1, file = "Rdata/MR_all_max_MeasureType1.Rdata")

MR_all_max_MeasureType <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_MeasureType) # signif diff proportion / latency
save(MR_all_max_MeasureType, file = "Rdata/MR_all_max_MeasureType.Rdata")
```


- ReinforcementCat
```{r MR all data max - ReinforcementCat}
MR_all_max_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ReinforcementCat1) # ns signif intcfor R-Null, signif for R-P and R-R
save(MR_all_max_ReinforcementCat1, file = "Rdata/MR_all_max_ReinforcementCat1.Rdata")

MR_all_max_ReinforcementCat <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ReinforcementCat) # no signif diff R-Null /  R-R / R-P
save(MR_all_max_ReinforcementCat, file = "Rdata/MR_all_max_ReinforcementCat.Rdata")

MR_all_max_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ReinforcementCat2) # no signif diff R-Null /  R-R / R-P
save(MR_all_max_ReinforcementCat2, file = "Rdata/MR_all_max_ReinforcementCat2.Rdata")
```


- AmbigReinforced
```{r MR all data max - AmbigReinforced}
MR_all_max_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AmbigReinforced1) # signif intc no, ns intc yes
save(MR_all_max_AmbigReinforced1, file = "Rdata/MR_all_max_AmbigReinforced1.Rdata")

MR_all_max_AmbigReinforced <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AmbigReinforced) # no signif diff yes / no
save(MR_all_max_AmbigReinforced, file = "Rdata/MR_all_max_AmbigReinforced.Rdata")
```


- ScalePoint
```{r MR all data max - ScalePoint}
MR_all_max_ScalePoint1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ScalePoint1) #  signif intc A / B / C
save(MR_all_max_ScalePoint1, file = "Rdata/MR_all_max_ScalePoint1.Rdata")

MR_all_max_ScalePoint <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ScalePoint, ref="A"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ScalePoint) # no signif diff A / B / C
save(MR_all_max_ScalePoint, file = "Rdata/MR_all_max_ScalePoint.Rdata")

MR_all_max_ScalePoint2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ScalePoint, ref="B"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ScalePoint2) # no signif diff A / B / C
save(MR_all_max_ScalePoint2, file = "Rdata/MR_all_max_ScalePoint2.Rdata")
```


- Full Models
```{r MR all data max - Full models}

#using all moderators 
MR_all_max_Full_0 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_0) # latency-proportion diff
save(MR_all_max_Full_0, file = "Rdata/MR_all_max_Full_0.Rdata")

MR_all_max_Full_0p <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + relevel(dat_max$MeasureType, ref="proportion") + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_0p) # latency-proportion diff
save(MR_all_max_Full_0p, file = "Rdata/MR_all_max_Full_0p.Rdata")

#only using significant (diff levels) from univariate models
#without interaction (models using different reference levels):
MR_all_max_Full_1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_1) # signif intc for female, male, mixed-sex at latency,latency diff from proportion
save(MR_all_max_Full_1, file = "Rdata/MR_all_max_Full_1.Rdata")

MR_all_max_Full_2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_2) # sex female at latency ns diff from male, latency diff from proportion
save(MR_all_max_Full_2, file = "Rdata/MR_all_max_Full_2.Rdata")

MR_all_max_Full_3 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Sex, ref="male") + relevel(dat_max$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_3) # male signif intc and ns diff from female, prop diff from latency
save(MR_all_max_Full_3, file = "Rdata/MR_all_max_Full_3.Rdata")

MR_all_max_Full_4 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + relevel(dat_max$MeasureType, ref="proportion") - 1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_4) # all signif
save(MR_all_max_Full_4, file = "Rdata/MR_all_max_Full_4.Rdata")

#with interaction
MR_all_max_Full_2i <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex * MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_2i) # ns interaction, ns diff male-female, signif diff proportion-latency for female
save(MR_all_max_Full_2i, file = "Rdata/MR_all_max_Full_2i.Rdata")
     

#only using significant (diff levels) from univariate models on full data set, no phylo
MR_all_max_Full_1x <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_1x) # signif intc for female at latency, ns diff between sexes, latency diff from proportion
```



- Full Model robust meatafor
```{r MR all data max - Full model robust metafor}
#only using significant (diff levels) from univariate models in full data set

#without interaction (models using different reference levels):
MR_all_max_Full_1_robust <- robust(MR_all_max_Full_1, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_1_robust) #same pattern as in the original model
save(MR_all_max_Full_1_robust,file = "Rdata/MR_all_max_Full_1_robust.Rdata")

MR_all_max_Full_2_robust <- robust(MR_all_max_Full_2, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_2_robust) #same pattern as in the original model
save(MR_all_max_Full_2_robust,file = "Rdata/MR_all_max_Full_2_robust.Rdata")

MR_all_max_Full_3_robust <- robust(MR_all_max_Full_3, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_3_robust) #same pattern as in the original model
save(MR_all_max_Full_3_robust,file = "Rdata/MR_all_max_Full_3_robust.Rdata")

MR_all_max_Full_4_robust <- robust(MR_all_max_Full_4, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_4_robust) #same pattern as in the original model
save(MR_all_max_Full_4_robust,file = "Rdata/MR_all_max_Full_4_robust.Rdata")

#with interaction
MR_all_max_Full_2i_robust <- robust(MR_all_max_Full_2i, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_2i_robust) #same pattern as in the original model
save(MR_all_max_Full_2i_robust,file = "Rdata/MR_all_max_Full_2i_robust.Rdata")

#only using significant (diff levels) from univariate models no phylo
MR_all_max_Full_1x_robust <- robust(MR_all_max_Full_1x, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_1x_robust) #same pattern as in the original model
save(MR_all_max_Full_1x_robust,file = "Rdata/MR_all_max_Full_1x_robust.Rdata")
```

