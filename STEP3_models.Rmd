---
title: "meta-analysis"
author: "ML"
date: "6/12/2017"
output: html_document
---

# MA of cognitive bias (optimism) in animal studies.

## STEP3 - MA modelling

(originally script: "Meta-Analaysis_merged_ML2.R")


```{r setup}
sessionInfo()
options(scipen=100)
pacman::p_load(tidyverse, magrittr, fulltext, rotl, ape, dplyr, tidyr, rotl, fulltext, metafor, car, robumeta, MuMIn, lme4)
source("functions.R")
```

```{r load data} 
dat <- read.csv("data_with_ES_subsets.csv")
dim(dat) #264
str(dat) 
names(dat)

### SUBSETS from all data (proportion and latency) by picking only one ES from the curves/tests with 3 ScalePoints (A,B,C) [we use the columns that code already code these choices):
dat_max_ES <- dplyr::filter(dat, max_ES == 1) #subset by picking maximum ES from each triplet (i.e. get the most positive=optimistic response available)
dim(dat_max_ES) 

dat_max_absES <- dplyr::filter(dat, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)
dim(dat_max_absES) 

dat_max_meanES <- dplyr::filter(dat, biggest_meandir == 1) #subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the response)
dim(dat_max_meanES) 

dat_B_ES <- dplyr::filter(dat, ScalePoint == "B") #subset by picking only middle (B) ES from each triplet
dim(dat_B_ES) 


#### SUBSETS by MeasureType:
table(dat$MeasureType) # 138 "latency", 126 "proportion"

## proportion data (with triplicates)
dat_prop <- dplyr::filter(dat, MeasureType == "proportion") #subset proportion data
dim(dat_prop)
dat_prop <- droplevels(dat_prop) 
str(dat_prop) #only 15 species

##latency data (with triplicates)
dat_lat <- dplyr::filter(dat, MeasureType == "latency") #subset latency data
dim(dat_lat) 
dat_lat <- droplevels(dat_lat) 
str(dat_lat) #only 13 species


### SUBSETS from proportion data by picking only one ES from the curves/tests with 3 ScalePoints (A,B,C) [we use the columns that code already code these choices):
dat_prop_max_ES <- dplyr::filter(dat_prop, max_ES == 1) #subset by picking maximum ES from each triplet (i.e. get the most positive=optimistic response available)
dim(dat_prop_max_ES) 

dat_prop_max_absES <- dplyr::filter(dat_prop, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)
dim(dat_prop_max_absES) 

dat_prop_max_meanES <- dplyr::filter(dat_prop, biggest_meandir == 1) #subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the response)
dim(dat_prop_max_meanES) 

dat_prop_B_ES <- dplyr::filter(dat_prop, ScalePoint == "B") #subset by picking only middle (B) ES from each triplet
dim(dat_prop_B_ES) 



### SUBSETS from latency data by picking only one ES from the curves/tests with 3 ScalePoints (A,B,C) [we use the columns that code already code these choices):
dat_lat_max_ES <- dplyr::filter(dat_lat, max_ES == 1) #subset by picking maximum ES from each triplet (i.e. get the most positive=optimistic response available)
dim(dat_lat_max_ES) 

dat_lat_max_absES <- dplyr::filter(dat_lat, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)
dim(dat_lat_max_absES) 

dat_lat_max_meanES <- dplyr::filter(dat_lat, biggest_meandir == 1) #subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the response)
dim(dat_lat_max_meanES) 

dat_lat_B_ES <- dplyr::filter(dat_lat, ScalePoint == "B") #subset by picking only middle (B) ES from each triplet
dim(dat_lat_B_ES) 
```


```{r VCV matrices} 
#### all data (proportion and latency)
## prepare VCV matrix - all data (proportion and latency)
VCV <- make_VCV_matrix(data = dat, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV)

## all data (proportion and latency) subsets without data triplicates:
## prepare VCV matrix - dat_max_absES all data (proportion and latency)
VCV_max_absES <- make_VCV_matrix(data = dat_max_absES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_max_absES)

## prepare VCV matrix - dat_max_ES all data (proportion and latency)
VCV_max_ES <- make_VCV_matrix(data = dat_max_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_max_ES)

## prepare VCV matrix - dat_max_meanES all data (proportion and latency)
VCV_max_meanES <- make_VCV_matrix(data = dat_max_meanES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_max_meanES)

## prepare VCV matrix - dat_B_ES all data (proportion and latency)
VCV_B_ES <- make_VCV_matrix(data = dat_B_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_B_ES)



#### proportion data 
## prepare VCV matrix - proportion data
VCV_prop <- make_VCV_matrix(data = dat_prop, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_prop)

## proportion data subsets without data triplicates:
## prepare VCV matrix - dat_max_absES proportion data
VCV_prop_max_absES <- make_VCV_matrix(data = dat_prop_max_absES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_prop_max_absES)

## prepare VCV matrix - dat_max_ES proportion data
VCV_prop_max_ES <- make_VCV_matrix(data = dat_prop_max_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_prop_max_ES)

## prepare VCV matrix - dat_max_meanES proportion data
VCV_prop_max_meanES <- make_VCV_matrix(data = dat_prop_max_meanES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_prop_max_meanES)

## prepare VCV matrix - dat_B_ES proportion data
VCV_prop_B_ES <- make_VCV_matrix(data = dat_prop_B_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_prop_B_ES)



#### latency data 
## prepare VCV matrix - latency data
VCV_lat <- make_VCV_matrix(data = dat_lat, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_lat)

## latency data subsets without data triplicates:
## prepare VCV matrix - dat_max_absES latency data
VCV_lat_max_absES <- make_VCV_matrix(data = dat_lat_max_absES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_lat_max_absES)

## prepare VCV matrix - dat_max_ES latency data
VCV_lat_max_ES <- make_VCV_matrix(data = dat_lat_max_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_lat_max_ES)

## prepare VCV matrix - dat_max_meanES latency data
VCV_lat_max_meanES <- make_VCV_matrix(data = dat_lat_max_meanES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_lat_max_meanES)

## prepare VCV matrix - dat_B_ES latency data
VCV_lat_B_ES <- make_VCV_matrix(data = dat_lat_B_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_lat_B_ES)
```


```{r phylo matrices} 
## prepare species correlation matrix - all data (proportion and latency)
# Note: this matrix is also usable for  ES subsets from ScalePoint triplet-based subsets
tree <- read.tree(file="tree_all.tre")
is.binary.tree(tree) #TRUE
is.ultrametric(tree) #TRUE
# plot(tree, cex=0.8) #plot with branch lengths
CorMatrix_all <- vcv(tree, corr=TRUE)
#setdiff(colnames(CorMatrix_all), unique(dat$Species_Latin)) #all ok

## prepare species correlation matrix - proportion data
# Note: this matrix is also usable for  ES subsets from ScalePoint triplet-based subsets
setdiff(unique(dat$Species_Latin), unique(dat_prop$Species_Latin) ) #missing species
tree_prop <- drop.tip(tree, setdiff(unique(dat$Species_Latin), unique(dat_prop$Species_Latin) )) # remove missing species from the tree
is.binary.tree(tree_prop) #TRUE
is.ultrametric(tree_prop) #TRUE
#plot(tree_prop)
CorMatrix_prop <- vcv(tree_prop, corr=TRUE)
#setdiff(colnames(CorMatrix_prop), unique(dat_prop$Species_Latin)) #all ok

## prepare species correlation matrix - latency data
# Note: this matrix is also usable for  ES subsets from ScalePoint triplet-based subsets
setdiff(unique(dat$Species_Latin), unique(dat_lat$Species_Latin) ) #missing species
tree_lat <- drop.tip(tree, setdiff(unique(dat$Species_Latin), unique(dat_lat$Species_Latin) )) # remove missing species from the tree
is.binary.tree(tree_lat) #TRUE
is.ultrametric(tree_lat) #TRUE
#plot(tree_lat)
CorMatrix_lat <- vcv(tree_lat, corr=TRUE)
#setdiff(colnames(CorMatrix_lat), unique(dat_lat$Species_Latin)) #all ok
```



###############################################################################################################
#########################################       META-ANALYSIS       ########################################### 
###############################################################################################################

########################################################
#### All data points (full data set) - preliminary


## **What random effect structure to use ?**
#Choose random effect structure by conducting LRTs, and for that we need ML estimates
#Possible random effects: Article, Experiment, Species and phylogeny

```{r all data - chose random effects}
meta1null <- rma.mv(yi = d, V = Vd, data=dat, method = 'ML') 
meta1study <- rma.mv(yi = d, V = Vd, random =~1|ArticleID, data=dat, method = 'ML') 
#adding ArticleID as random effects to correct for effect sizes from same paper
anova(meta1study, meta1null) #ArticleID is important

meta1exp <- rma.mv(yi = d, V = Vd, random =list(~1|ArticleID, ~1|ExperimentID), data=dat, method = 'ML') 
#adding ExperimentID as random effects to correct for effect sizes from same experiment
anova(meta1exp, meta1study) #ExperimentID is important

meta1sp = rma.mv(yi = d, V = Vd, random = ~1|Species_Latin, data=dat, method = 'ML')
anova(meta1sp, meta1null)
#Species is important by itself

meta1expsp <- rma.mv(yi = d, V = Vd, random =list(~1|ArticleID, ~1|ExperimentID, ~1|Species_Latin), data=dat, method = 'ML') 
anova(meta1expsp, meta1exp) #Species is not important with Article and Experiment IDs


meta1phy = rma.mv(yi = d, V = Vd, random = list(~1|ArticleID, ~1|ExperimentID, ~1|Species_Latin),
                             R = list(Species_Latin = CorMatrix_all), data=dat, method = 'ML')
anova(meta1phy, meta1null) #Phylogeny important relatively to null
anova(meta1phy, meta1exp) #Phylogeny not important relatively to model with Article and Experiment IDs

meta1expVCV = rma.mv(yi = d, V = VCV, random = list(~1|ArticleID, ~1|ExperimentID), data=dat, method = 'ML')
anova(meta1expVCV, meta1exp) #cant compare!

meta1phyVCV = rma.mv(yi = d, V = VCV, random = list(~1|ArticleID, ~1|ExperimentID, ~1|Species_Latin),
                             R = list(Species_Latin = CorMatrix_all), data=dat, method = 'ML')
anova(meta1expVCV, meta1phyVCV) #cant compare!

AIC.rma(meta1null, meta1phy, meta1sp, meta1exp, meta1expsp, meta1expVCV, meta1phyVCV, correct = TRUE) %>% arrange(AICc)
#meta1exp model has lowest AIC (Article and Experiment ID only), followed closely by meta1phy and meta1expsp (the smaller the AIC the better the fit)
```






######################################################## MA (REML)
#### All data points (full data set)

```{r MA all data} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_all_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MA_all_random) 
calc.I2(dat$Vd, MA_all_random) 
save(MA_all_random, file = "Rdata/MA_all_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_all_random_VCV <- rma.mv(yi = d, V = VCV, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat, method = "REML")
summary(MA_all_random_VCV)
calc.I2(dat$Vd, MA_all_random_VCV)
save(MA_all_random_VCV, file = "Rdata/MA_all_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_all_random_VCV_phylo <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat, method = "REML") 
summary(MA_all_random_VCV_phylo)   
calc.I2(dat$Vd, MA_all_random_VCV_phylo) #77% Htotal, 4.5% phylogeny, 0% speciesID
save(MA_all_random_VCV_phylo, file = "Rdata/MA_all_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_all <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat, method = "REML") 
summary(MA_all)    
calc.I2(dat$Vd, MA_all) #77% Htotal, 4.5% phylogeny
save(MA_all, file = "Rdata/MA_all.Rdata")

######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_all_nophylo <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat, method = "REML") 
summary(MA_all_nophylo)    
calc.I2(dat$Vd, MA_all_nophylo) #76.5% Htotal, 
save(MA_all_nophylo, file = "Rdata/MA_all_nophylo.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_all_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat)
print(MA_all_robu) #0.191  0.0732    0.31
#save(MA_all_robu,file="Rdata/MA_all_robu.Rdata")

#robust metafor
MA_all_robust <- robust(MA_all, cluster = dat$ExperimentID)
summary(MA_all_robust) #0.19  0.07  0.31
save(MA_all_robust,file = "Rdata/MA_all_robust.Rdata")
```



########################################################
##### Max absolute ES data subset (dat_max_absES, k=106) - USE FOR THE MAIN TEXT
#subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)


```{r MA dat_max_absES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxabsES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_max_absES, method="REML") 
summary(MA_maxabsES_random) 
calc.I2(dat_max_absES$Vd, MA_maxabsES_random) 
save(MA_maxabsES_random, file = "Rdata/MA_maxabsES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxabsES_random_VCV <- rma.mv(yi = d, V = VCV_max_absES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_absES, method = "REML")
summary(MA_maxabsES_random_VCV)
calc.I2(dat_max_absES$Vd, MA_maxabsES_random_VCV)
save(MA_maxabsES_random_VCV, file = "Rdata/MA_maxabsES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxabsES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_absES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES_random_VCV_phylo)   
calc.I2(dat_max_absES$Vd, MA_maxabsES_random_VCV_phylo) #89% Htotal, 0.6% phylogeny, 0% speciesID
save(MA_maxabsES_random_VCV_phylo, file = "Rdata/MA_maxabsES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxabsES <- rma.mv(yi=d, V=VCV_max_absES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES)    
calc.I2(dat_max_absES$Vd, MA_maxabsES) #89% Htotal, 1.7% phylogeny
save(MA_maxabsES, file = "Rdata/MA_maxabsES.Rdata")

######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_maxabsES_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES_nophylo)    
calc.I2(dat_max_absES$Vd, MA_maxabsES_nophylo) #78.0% Htotal, 
save(MA_maxabsES_nophylo, file = "Rdata/MA_maxabsES_nophylo.Rdata")

## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxabsES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxabsES = TRUE, data = dat_max_absES)
print(MA_maxabsES_robu) #0.38  0.17    0.59
#save(MA_maxabsES_robu,file="Rdata/MA_maxabsES_robu.Rdata")

#robust metafor
MA_maxabsES_robust <- robust(MA_maxabsES, cluster = dat_max_absES$ExperimentID)
summary(MA_maxabsES_robust) #0.37  0.16  0.60
save(MA_maxabsES_robust,file = "Rdata/MA_maxabsES_robust.Rdata")
```



########################################################
##### Max mean ES data subset (dat_max_meanES, k=106) - DO NOT USE (MENTION)
#subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the overall response) 

```{r MA dat_max_meanES subset} 
#NOTE: this data subset differs only by 3 data points from dat_max_absES data subset! (MA results are almost identical)

table(dat_max_meanES$d==dat_max_absES$d)

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxmeanES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_max_meanES, method="REML") 
summary(MA_maxmeanES_random) 
calc.I2(dat_max_meanES$Vd, MA_maxmeanES_random) 
save(MA_maxmeanES_random, file = "Rdata/MA_maxmeanES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxmeanES_random_VCV <- rma.mv(yi = d, V = VCV_max_meanES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_meanES, method = "REML")
summary(MA_maxmeanES_random_VCV)
calc.I2(dat_max_meanES$Vd, MA_maxmeanES_random_VCV)
save(MA_maxmeanES_random_VCV, file = "Rdata/MA_maxmeanES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxmeanES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_meanES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_meanES, method = "REML") 
summary(MA_maxmeanES_random_VCV_phylo)   
calc.I2(dat_max_meanES$Vd, MA_maxmeanES_random_VCV_phylo) #89% Htotal, 0.7% phylogeny, 0% speciesID
save(MA_maxmeanES_random_VCV_phylo, file = "Rdata/MA_maxmeanES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxmeanES <- rma.mv(yi=d, V=VCV_max_meanES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_meanES, method = "REML") 
summary(MA_maxmeanES)    
calc.I2(dat_max_meanES$Vd, MA_maxmeanES) #89% Htotal, 1.5% phylogeny
save(MA_maxmeanES, file = "Rdata/MA_maxmeanES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxmeanES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxmeanES = TRUE, data = dat_max_meanES)
print(MA_maxmeanES_robu) #0.38  0.17    0.58
#save(MA_maxmeanES_robu,file="Rdata/MA_maxmeanES_robu.Rdata")

#robust metafor
MA_maxmeanES_robust <- robust(MA_maxmeanES, cluster = dat_max_meanES$ExperimentID)
summary(MA_maxmeanES_robust) #0.37  0.15  0.59
save(MA_maxmeanES_robust,file = "Rdata/MA_maxmeanES_robust.Rdata")
```



########################################################
##### Max B ES data subset (dat_B_ES, k=106) - DO NOT USE (MENTION)
#subset by picking ES from each triplet which isin the midpoint (i.e. B) 

```{r MA dat_B_ES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_B_ES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_B_ES, method="REML") 
summary(MA_B_ES_random) 
calc.I2(dat_B_ES$Vd, MA_B_ES_random) 
save(MA_B_ES_random, file = "Rdata/MA_B_ES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_B_ES_random_VCV <- rma.mv(yi = d, V = VCV_B_ES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_B_ES, method = "REML")
summary(MA_B_ES_random_VCV)
calc.I2(dat_B_ES$Vd, MA_B_ES_random_VCV)
save(MA_B_ES_random_VCV, file = "Rdata/MA_B_ES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_B_ES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_B_ES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_B_ES, method = "REML") 
summary(MA_B_ES_random_VCV_phylo)   
calc.I2(dat_B_ES$Vd, MA_B_ES_random_VCV_phylo) #82% Htotal, 3.6% phylogeny, 0% speciesID
save(MA_B_ES_random_VCV_phylo, file = "Rdata/MA_B_ES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_B_ES <- rma.mv(yi=d, V=VCV_B_ES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_B_ES, method = "REML") 
summary(MA_B_ES )    
calc.I2(dat_B_ES$Vd, MA_B_ES ) #82% Htotal, 3.6% phylogeny
save(MA_B_ES, file = "Rdata/MA_B_ES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_B_ES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smB_ES  = TRUE, data = dat_B_ES)
print(MA_B_ES_robu) #0.21  0.07    0.36
#save(MA_B_ES_robu,file="Rdata/MA_B_ES_robu.Rdata")

#robust metafor
MA_B_ES_robust <- robust(MA_B_ES , cluster = dat_B_ES$ExperimentID)
summary(MA_B_ES_robust) #0.2  0.04  0.37
save(MA_B_ES_robust,file = "Rdata/MA_B_ES_robust.Rdata")
```



########################################################
##### Max ES data subset (dat_max_ES, k=106) - DO NOT USE
##subset by picking maximum ES from each triplet (i.e. get the most positive=optimistic response available)

#subset by picking ES with the biggest absolute value from each triplet (i.e. get the most positive or negatve response available)
dim(dat_max_absES) 
#subset by picking ES from each triplet which has the biggest absolute value in the direction of the mean value of all 3 ES from the triplet (i.e. biggest in the overall direction of the response)
dim(dat_max_meanES) 

```{r MA dat_max_ES subset} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_max_ES, method="REML") 
summary(MA_maxES_random) 
calc.I2(dat_max_ES$Vd, MA_maxES_random) 
save(MA_maxES_random, file = "Rdata/MA_maxES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxES_random_VCV <- rma.mv(yi = d, V = VCV_max_ES, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_ES, method = "REML")
summary(MA_maxES_random_VCV)
calc.I2(dat_max_ES$Vd, MA_maxES_random_VCV)
save(MA_maxES_random_VCV, file = "Rdata/MA_maxES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES_random_VCV_phylo)   
calc.I2(dat_max_ES$Vd, MA_maxES_random_VCV_phylo) #78% Htotal, 0% phylogeny, 0% speciesID
save(MA_maxES_random_VCV_phylo, file = "Rdata/MA_maxES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxES <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES)    
calc.I2(dat_max_ES$Vd, MA_maxES) #78% Htotal, 0% phylogeny
save(MA_maxES, file = "Rdata/MA_maxES.Rdata")

######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_maxES_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES_nophylo)    
calc.I2(dat_max_ES$Vd, MA_maxES_nophylo) #78.0% Htotal, 
save(MA_maxES_nophylo, file = "Rdata/MA_maxES_nophylo.Rdata")

## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxES = TRUE, data = dat_max_ES)
print(MA_maxES_robu) #0.54  0.4    0.7
#save(MA_maxES_robu,file="Rdata/MA_maxES_robu.Rdata")

#robust metafor
MA_maxES_robust <- robust(MA_maxES, cluster = dat_max_ES$ExperimentID)
summary(MA_maxES_robust) #0.54  0.4  0.7
save(MA_maxES_robust,file = "Rdata/MA_maxES_robust.Rdata")
```




###############################################################################################################
###########################################         LATENCY DATA        ########################################### 
###############################################################################################################

## Meta-analytical models

```{r MA latency data} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_lat_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_lat, method="REML") 
summary(MA_lat_random) 
calc.I2(dat_lat$Vd, MA_lat_random) 
save(MA_lat_random, file = "Rdata/MA_lat_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_lat_random_VCV <- rma.mv(yi = d, V = VCV_lat, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                         data = dat_lat, method = "REML")
summary(MA_lat_random_VCV)
calc.I2(dat_lat$Vd, MA_lat_random_VCV) 
save(MA_lat_random_VCV, file = "Rdata/MA_lat_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_lat_random_VCV_phylo <- rma.mv(yi=d, V=VCV_lat, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_lat),
                             data = dat_lat, method = "REML") 
summary(MA_lat_random_VCV_phylo) 
calc.I2(dat_lat$Vd, MA_lat_random_VCV_phylo) 
save(MA_lat_random_VCV_phylo, file = "Rdata/MA_lat_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random
MA_lat <- rma.mv(yi=d, V=VCV_lat, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_lat),
                             data = dat_lat, method = "REML") 
summary(MA_lat)  
calc.I2(dat_lat$Vd, MA_lat) 
save(MA_lat, file = "Rdata/MA_lat.Rdata")


######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_lat_nophylo <- rma.mv(yi=d, V=VCV_lat, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_lat, method = "REML") 
summary(MA_lat_nophylo)   
calc.I2(dat_lat$Vd, MA_lat_nophylo) 
save(MA_lat_nophylo, file = "Rdata/MA_lat_nophylo.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_lat_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat_lat)
print(MA_lat_robu) 
#save(MA_lat_robu,file="Rdata/MA_lat_robu.Rdata")

#robust metafor
MA_lat_robust <- robust(MA_lat, cluster = dat_lat$ExperimentID)
summary(MA_lat_robust) 
save(MA_lat_robust,file = "Rdata/MA_lat_robust.Rdata")

```


```{r MA latency data - maxabsES subset} 
######## random-effect model with VCV and phylogeny (Species_Latin)
MA_lat_maxabsES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_lat),
                             data = dat_lat_max_absES, method = "REML") 
summary(MA_lat_maxabsES)    
calc.I2(dat_lat_max_absES$Vd, MA_lat_maxabsES)
save(MA_lat_maxabsES, file = "Rdata/MA_lat_maxabsES.Rdata")

######## random-effect model with VCV and no phylogeny and no species
MA_lat_maxabsES_nophylo <- rma.mv(yi=d, V=VCV_lat_max_ES, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_lat_max_absES, method = "REML") 
summary(MA_lat_maxabsES_nophylo)    
calc.I2(dat_lat_max_absES$Vd, MA_lat_maxabsES_nophylo)
save(MA_lat_maxabsES_nophylo, file = "Rdata/MA_lat_maxabsES_nophylo.Rdata")
```




###############################################################################################################
###########################################         PROPORTION DATA        ########################################### 
###############################################################################################################

## Meta-analytical models

```{r MA proportion data} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_prop_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_prop, method="REML") 
summary(MA_prop_random) 
calc.I2(dat_prop$Vd, MA_prop_random) 
save(MA_prop_random, file = "Rdata/MA_prop_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_prop_random_VCV <- rma.mv(yi = d, V = VCV_prop, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                         data = dat_prop, method = "REML")
summary(MA_prop_random_VCV)
calc.I2(dat_prop$Vd, MA_prop_random_VCV) 
save(MA_prop_random_VCV, file = "Rdata/MA_prop_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_prop_random_VCV_phylo <- rma.mv(yi=d, V=VCV_prop, 
                             random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_prop),
                             data = dat_prop, method = "REML") 
summary(MA_prop_random_VCV_phylo)  
calc.I2(dat_prop$Vd, MA_prop_random_VCV_phylo) 
save(MA_prop_random_VCV_phylo, file = "Rdata/MA_prop_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random
MA_prop <- rma.mv(yi=d, V=VCV_prop, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_prop),
                             data = dat_prop, method = "REML") 
summary(MA_prop)     
calc.I2(dat_prop$Vd, MA_prop) 
save(MA_prop, file = "Rdata/MA_prop.Rdata")


######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_prop_nophylo <- rma.mv(yi=d, V=VCV_prop, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_prop, method = "REML") 
summary(MA_prop_nophylo)
calc.I2(dat_prop$Vd, MA_prop_nophylo) 
save(MA_prop_nophylo, file = "Rdata/MA_prop_nophylo.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_prop_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat_prop)
print(MA_prop_robu) 
#save(MA_prop_robu,file="Rdata/MA_prop_robu.Rdata")

#robust metafor
MA_prop_robust <- robust(MA_prop, cluster = dat_prop$ExperimentID)
summary(MA_prop_robust) 
save(MA_prop_robust,file = "Rdata/MA_prop_robust.Rdata")
```


```{r MA proportion data - maxabsES subset} 
######## random-effect model with VCV and phylogeny (Species_Latin)
MA_prop_maxabsES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_prop),
                             data = dat_prop_max_absES, method = "REML") 
summary(MA_prop_maxabsES)    
calc.I2(dat_prop_max_absES$Vd, MA_prop_maxabsES)
save(MA_prop_maxabsES, file = "Rdata/MA_prop_maxabsES.Rdata")

######## random-effect model with VCV and no phylogeny and no species
MA_prop_maxabsES_nophylo <- rma.mv(yi=d, V=VCV_prop_max_ES, 
                             random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_prop_max_absES, method = "REML") 
summary(MA_prop_maxabsES_nophylo)    
calc.I2(dat_prop_max_absES$Vd, MA_prop_maxabsES_nophylo)
save(MA_prop_maxabsES_nophylo, file = "Rdata/MA_prop_maxabsES_nophylo.Rdata")
```




###############################################################################################################
#########################################     UNIVARIATE  META-REGRESSIONS       ##############################
###############################################################################################################

#### SPECIES ####

#### Species_Latin (Species model) on all data points:
```{r MR all data - Species model}
#with phylogeny
MR_all_species <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_species) # no species with clear effect
save(MR_all_species, file = "Rdata/MR_all_species.Rdata")

#without phylogeny
MR_all_species_nophylo <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MR_all_species_nophylo) # only rat with clear effect, when phylogeny not taken into account
save(MR_all_species_nophylo, file = "Rdata/MR_all_species_nophylo.Rdata")
```



########################################################
#### dat_max_absES - Species_Latin (Species model) - USE IN MAIN TEXT

```{r MR dat_max_absES data - Species model}
#with phylogeny
MR_maxabsES_species <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_species) # rat signif positive
save(MR_maxabsES_species, file = "Rdata/MR_maxabsES_species.Rdata")

#without phylogeny
MR_maxabsES_species_nophylo <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_absES, method="REML")
summary(MR_maxabsES_species_nophylo) # rat and cow
save(MR_maxabsES_species_nophylo, file = "Rdata/MR_maxabsES_species_nophylo.Rdata")
```


########################################################
#### dat_max_meanES - Species_Latin (Species model) - DONT USE

```{r MR dat_max_meanES data - Species model}
#with phylogeny
MR_maxmeanES_species <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_species) 
save(MR_maxmeanES_species, file = "Rdata/MR_maxmeanES_species.Rdata")

#without phylogeny
MR_maxmeanES_species_nophylo <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_species_nophylo)
save(MR_maxmeanES_species_nophylo, file = "Rdata/MR_maxmeanES_species_nophylo.Rdata")
```

#### dat_max_ES - Species_Latin (Species model) - DONT USE

```{r MR dat_max_ES data - Species model}
#with phylogeny
MR_maxES_species <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_species) # no species with clear effect
save(MR_maxES_species, file = "Rdata/MR_maxES_species.Rdata")

#without phylogeny
MR_maxES_species_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_maxES_species_nophylo, file = "Rdata/MR_maxES_species_nophylo.Rdata")
```





############################################################
##### MR - MeasureType #####

##### MeasureType on all data points:

```{r MR all data - MeasureType}
#with phylogeny
MR_all_MeasureType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType) # ns diff proportion / latency
save(MR_all_MeasureType, file = "Rdata/MR_all_MeasureType.Rdata")

#without phylogeny
MR_all_MeasureType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat, method="REML") 
summary(MR_all_MeasureType) # ns diff proportion - latency
save(MR_all_MeasureType, file = "Rdata/MR_all_MeasureType.Rdata")

#intercepts model
MR_all_MeasureType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType1) # signif intc proportion, not latency
save(MR_all_MeasureType1, file = "Rdata/MR_all_MeasureType1.Rdata")

#intercepts model without phylogeny
MR_all_MeasureType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat, method="REML") 
summary(MR_all_MeasureType1) # signif intc proportion, not latency
save(MR_all_MeasureType1, file = "Rdata/MR_all_MeasureType1.Rdata")
```


########################################################
#### dat_max_absES - Species_Latin (Species model) - USE IN MAIN TEXT

```{r MR dat_max_absES data - MeasureType model}
#with phylogeny
MR_maxabsES_MeasureType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType) # ns diff proportion / latency
save(MR_maxabsES_MeasureType, file = "Rdata/MR_maxabsES_MeasureType.Rdata")

#without phylogeny
MR_maxabsES_MeasureType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType) # ns diff proportion - latency
save(MR_maxabsES_MeasureType, file = "Rdata/MR_maxabsES_MeasureType.Rdata")

#intercepts model
MR_maxabsES_MeasureType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType1) # signif intc proportion, not latency
save(MR_maxabsES_MeasureType1, file = "Rdata/MR_maxabsES_MeasureType1.Rdata")

#intercepts model without phylogeny
MR_maxabsES_MeasureType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType1) # signif intc proportion, not latency
save(MR_maxabsES_MeasureType1, file = "Rdata/MR_maxabsES_MeasureType1.Rdata")
```





################### OTHER UNIVARIATE
Consider univariate MR models for:    
- Sex   
- Age   
- Source of Animals
- AffectManipCat   
- AffectManipTiming   
- ComparisonCategory   
- CueTypeCat   
- FoodDeprived   
- TaskType   
- Randomized_WithinBetween   
- Automated   
- Blind   
- ReinforcementCat
- AmbigReinforced
- ScalePoint


########################################################
###########################################################

#### Testing for multicollinearity among potential moderators VIF

https://stats.stackexchange.com/questions/201205/variance-inflation-factors-vif-mer-verus-group-factor-level-vif

https://stackoverflow.com/questions/26633483/collinearity-after-accounting-for-random-mixed-effects

## A VIF of 1 indicates there is no detectable linear relationship among the regressors, while a large VIF indicates a tight linear relationship
# A commonly used rule of thumb is that a VIF of 10 or more is evidence of severe multicollinearity (Cohen et

```{r vif custom function}
vif.mer <- function (fit) {
## adapted from rms::vif
v <- vcov(fit)
nam <- names(fixef(fit))
## exclude intercepts
ns <- sum(1 * (nam == "Intercept" | nam == "(Intercept)"))
if (ns > 0) {
v <- v[-(1:ns), -(1:ns), drop = FALSE]
nam <- nam[-(1:ns)] }
d <- diag(v)^0.5
v <- diag(solve(v/(d %o% d)))
names(v) <- nam 
v }
```

```{r vif - all data}
model <- lmer(d ~ MeasureType + TaskType + (1|ArticleID), data = dat)
vif.mer(model)

model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat)
vif.mer(model) # TaskType has 8.77


model <- lmer(d ~ Sex + Age + (1|ExperimentID), data = dat)
vif.mer(model)
```


```{r vif - latency data}
model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat_lat)
vif.mer(model) # TaskType has 24.1, ReinforcementCatR-R has 10.7

model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind   + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat_lat)
vif.mer(model) # TaskType has 4.2 without ReinforcementCat
```


```{r vif - proportion data}
model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat_prop)
vif.mer(model) # TaskType has 11.6, ReinforcementCatR-P has 10.6, Captive_Wild.caughtwild-caught has 12.3, CueTypeCatolfactory has 12.5

model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat_prop)
vif.mer(model) # TaskType has 5.16, Captive_Wild.caughtwild-caught has 11.6, CueTypeCatolfactory has 12.4 without ReinforcementCat
```



###############################################################################################################
###########################################        MR - LATENCY DATA        ########################################### 
###############################################################################################################


## Meta-regression models:    

- Species_Latin (Species model) 
```{r MR lat data - Species model}
MR_lat_species <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_species) # only Bombus with clear effect
save(MR_lat_species, file = "Rdata/MR_lat_species.Rdata")


#max_absES

MR_lat_species_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_species_max_absES) # no species with clear effect
save(MR_lat_species_max_absES, file = "Rdata/MR_lat_species_max_absES.Rdata")

```


- TaskType
```{r MR lat data - TaskType}
MR_lat_TaskType1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~TaskType -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_TaskType1) # signif intc go/no-go
save(MR_lat_TaskType1, file = "Rdata/MR_lat_TaskType1.Rdata")

MR_lat_TaskType <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$TaskType, ref="active choice"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_TaskType) # no signif diff active choice vs. go/no-go
save(MR_lat_TaskType, file = "Rdata/MR_lat_TaskType.Rdata")


#max_absES

MR_lat_TaskType1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~TaskType -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_TaskType1_max_absES) # ns intc
save(MR_lat_TaskType1_max_absES, file = "Rdata/MR_lat_TaskType1_max_absES.Rdata")

MR_lat_TaskType_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$TaskType, ref="active choice"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_TaskType_max_absES) # no signif diff active choice vs. go/no-go
save(MR_lat_TaskType_max_absES, file = "Rdata/MR_lat_TaskType_max_absES.Rdata")

```


- Sex
```{r MR lat data - Sex}
MR_lat_sex1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Sex -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_sex1) # males signif intc 
save(MR_lat_sex1, file = "Rdata/MR_lat_sex1.Rdata")

MR_lat_sex <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Sex, ref="male"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_sex) # ns diff
save(MR_lat_sex, file = "Rdata/MR_lat_sex.Rdata")


#max_absES

MR_lat_sex1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~Sex -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_sex1_max_absES) # males ns intc 
save(MR_lat_sex1_max_absES, file = "Rdata/MR_lat_sex1_max_absES.Rdata")

MR_lat_sex_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$Sex, ref="male"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_sex_max_absES) # ns diff
save(MR_lat_sex_max_absES, file = "Rdata/MR_lat_sex_max_absES.Rdata")

```


- Age
```{r MR lat data - Age}
MR_lat_age1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Age -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_age1) # no signif intc adult/juvenile
save(MR_lat_age1, file = "Rdata/MR_lat_age1.Rdata")

MR_lat_age <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Age, ref="adult"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_age) # no signif diff adult-juvenile
save(MR_lat_age, file = "Rdata/MR_lat_age.Rdata")


#max_absES 

MR_lat_age1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~Age -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_age1_max_absES) # no signif intc adult/juvenile
save(MR_lat_age1_max_absES, file = "Rdata/MR_lat_age1_max_absES.Rdata")

MR_lat_age_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$Age, ref="adult"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_age_max_absES) # no signif diff adult-juvenile
save(MR_lat_age_max_absES, file = "Rdata/MR_lat_age_max_absES.Rdata")

```

- Source (Captive_Wild.caught)
```{r MR lat data - Captive_Wild.caught}
MR_lat_source1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_source1) #  signif intc captive
save(MR_lat_source1, file = "Rdata/MR_lat_source1.Rdata")

MR_lat_source <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_source) # no signif diff captive/wild-caught
save(MR_lat_source, file = "Rdata/MR_lat_source.Rdata")

#max_absES 

MR_lat_source1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_source1_max_absES) #  signif intc captive
save(MR_lat_source1_max_absES, file = "Rdata/MR_lat_source1_max_absES.Rdata")

MR_lat_source_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_source_max_absES) # no signif diff captive/wild-caught
save(MR_lat_source_max_absES, file = "Rdata/MR_lat_source_max_absES.Rdata")

```


- AffectManipCat
```{r MR lat data - AffectManipCat}
MR_lat_AffectManipCat1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML")
summary(MR_lat_AffectManipCat1) # no signif intc enrichment/stress
save(MR_lat_AffectManipCat1, file = "Rdata/MR_lat_AffectManipCat1.Rdata")

MR_lat_AffectManipCat <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$AffectManipCat, ref="enrichment"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AffectManipCat) # no signif diff enrichment/stress
save(MR_lat_AffectManipCat, file = "Rdata/MR_lat_AffectManipCat.Rdata")

#max_absES

MR_lat_AffectManipCat1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML")
summary(MR_lat_AffectManipCat1_max_absES) # no signif intc enrichment/stress
save(MR_lat_AffectManipCat1_max_absES, file = "Rdata/MR_lat_AffectManipCat1_max_absES.Rdata")

MR_lat_AffectManipCat_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$AffectManipCat, ref="enrichment"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_AffectManipCat_max_absES) # no signif diff enrichment/stress
save(MR_lat_AffectManipCat_max_absES, file = "Rdata/MR_lat_AffectManipCat_max_absES.Rdata")

```


- AffectManipTiming
```{r MR lat data - AffectManipTiming}
MR_lat_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AffectManipTiming1) #  signif intc long-term
save(MR_lat_AffectManipTiming1, file = "Rdata/MR_lat_AffectManipTiming1.Rdata")

MR_lat_AffectManipTiming <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$AffectManipTiming, ref="before/during"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_lat_AffectManipTiming, file = "Rdata/MR_lat_AffectManipTiming.Rdata")

#max_absES

MR_lat_AffectManipTiming1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_AffectManipTiming1_max_absES) #  ns intc
save(MR_lat_AffectManipTiming1_max_absES, file = "Rdata/MR_lat_AffectManipTiming1_max_absES.Rdata")

MR_lat_AffectManipTiming_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$AffectManipTiming, ref="before/during"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_AffectManipTiming_max_absES) # no signif diff  before/during / long-term
save(MR_lat_AffectManipTiming_max_absES, file = "Rdata/MR_lat_AffectManipTiming_max_absES.Rdata")

```


- ComparisonCategory
```{r MR lat data - ComparisonCategory}
MR_lat_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ComparisonCategory1) # signif intc Benign-Worse
save(MR_lat_ComparisonCategory1, file = "Rdata/MR_lat_ComparisonCategory1.Rdata")

MR_lat_ComparisonCategory <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_lat_ComparisonCategory, file = "Rdata/MR_lat_ComparisonCategory.Rdata")

#max_absES

MR_lat_ComparisonCategory1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ComparisonCategory1_max_absES) # signif intc Benign-Worse
save(MR_lat_ComparisonCategory1_max_absES, file = "Rdata/MR_lat_ComparisonCategory1_max_absES.Rdata")

MR_lat_ComparisonCategory_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ComparisonCategory_max_absES) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_lat_ComparisonCategory_max_absES, file = "Rdata/MR_lat_ComparisonCategory_max_absES.Rdata")

```


- CueTypeCat
```{r MR lat data - CueTypeCat}
MR_lat_CueTypeCat1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_CueTypeCat1) # signif intc for auditory
save(MR_lat_CueTypeCat1, file = "Rdata/MR_lat_CueTypeCat1.Rdata")

MR_lat_CueTypeCat <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$CueTypeCat, ref="auditory"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_CueTypeCat) #signif diff auditory - tactile
save(MR_lat_CueTypeCat, file = "Rdata/MR_lat_CueTypeCat.Rdata")

#max_absES

MR_lat_CueTypeCat1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_CueTypeCat1_max_absES) # ns intc
save(MR_lat_CueTypeCat1_max_absES, file = "Rdata/MR_lat_CueTypeCat1_max_absES.Rdata")

MR_lat_CueTypeCat_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$CueTypeCat, ref="auditory"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_CueTypeCat_max_absES) #ns diff 
save(MR_lat_CueTypeCat_max_absES, file = "Rdata/MR_lat_CueTypeCat_max_absES.Rdata")

```


- FoodDeprived
```{r MR lat data - FoodDeprived}
MR_lat_FoodDeprived1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_FoodDeprived1) # no signif intc yes / no
save(MR_lat_FoodDeprived1, file = "Rdata/MR_lat_FoodDeprived1.Rdata")

MR_lat_FoodDeprived <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$FoodDeprived, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_FoodDeprived) # no signif diff yes / no
save(MR_lat_FoodDeprived, file = "Rdata/MR_lat_FoodDeprived.Rdata")

#max_absES

MR_lat_FoodDeprived1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_FoodDeprived1_max_absES) # no signif intc yes / no
save(MR_lat_FoodDeprived1_max_absES, file = "Rdata/MR_lat_FoodDeprived1_max_absES.Rdata")

MR_lat_FoodDeprived_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$FoodDeprived, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_FoodDeprived_max_absES) # no signif diff yes / no
save(MR_lat_FoodDeprived_max_absES, file = "Rdata/MR_lat_FoodDeprived_max_absES.Rdata")

```



- Randomized_WithinBetween
```{r MR lat data - WithinBetween}
MR_lat_WithinBetween1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_WithinBetween1) # signif intc within, not between
save(MR_lat_WithinBetween1, file = "Rdata/MR_lat_MR_lat_WithinBetween1.Rdata")

MR_lat_WithinBetween <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$WithinBetween, ref="within"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_WithinBetween) # no signif diff within / between
save(MR_lat_WithinBetween, file = "Rdata/MR_lat_WithinBetween.Rdata")

#max_absES

MR_lat_WithinBetween1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_WithinBetween1_max_absES) # ns intc within / between
save(MR_lat_WithinBetween1_max_absES, file = "Rdata/MR_lat_MR_lat_WithinBetween1_max_absES.Rdata")

MR_lat_WithinBetween_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$WithinBetween, ref="within"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_WithinBetween_max_absES) # no signif diff within / between
save(MR_lat_WithinBetween_max_absES, file = "Rdata/MR_lat_WithinBetween_max_absES.Rdata")

```


- Automated
```{r MR lat data - Automated}
MR_lat_Automated1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Automated -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Automated1) # no signif intc yes / no
save(MR_lat_Automated1, file = "Rdata/MR_lat_Automated1.Rdata")

MR_lat_Automated <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Automated, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Automated) # no signif diff yes / no
save(MR_lat_Automated, file = "Rdata/MR_lat_Automated.Rdata")

#max_absES

MR_lat_Automated1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~Automated -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_Automated1_max_absES) # no signif intc yes / no
save(MR_lat_Automated1_max_absES, file = "Rdata/MR_lat_Automated1_max_absES.Rdata")

MR_lat_Automated_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$Automated, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_Automated_max_absES) # no signif diff yes / no
save(MR_lat_Automated_max_absES, file = "Rdata/MR_lat_Automated_max_absES.Rdata")

```


- Blind
```{r MR lat data - Blind}
MR_lat_Blind1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Blind -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Blind1) # no signif intc yes / no
save(MR_lat_Blind1, file = "Rdata/MR_lat_Blind1.Rdata")

MR_lat_Blind <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$Blind, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Blind) # no signif diff yes / no
save(MR_lat_Blind, file = "Rdata/MR_lat_Blind.Rdata")

#max_absES

MR_lat_Blind1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~Blind -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_Blind1_max_absES) #  signif intc no
save(MR_lat_Blind1_max_absES, file = "Rdata/MR_lat_Blind1_max_absES.Rdata")

MR_lat_Blind_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$Blind, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_Blind_max_absES) # no signif diff yes / no
save(MR_lat_Blind_max_absES, file = "Rdata/MR_lat_Blind_max_absES.Rdata")

```


- ReinforcementCat
```{r MR lat data - ReinforcementCat}
MR_lat_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ReinforcementCat1) # no signif intc 
save(MR_lat_ReinforcementCat1, file = "Rdata/MR_lat_ReinforcementCat1.Rdata")

MR_lat_ReinforcementCat <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ReinforcementCat, ref="R-Null"), 
                      random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                    random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ReinforcementCat) # no signif diff R-Null /  R-R / R-P
save(MR_lat_ReinforcementCat, file = "Rdata/MR_lat_ReinforcementCat.Rdata")

#max_absES

MR_lat_ReinforcementCat1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ReinforcementCat1_max_absES) #  signif intc R-P
save(MR_lat_ReinforcementCat1_max_absES, file = "Rdata/MR_lat_ReinforcementCat1_max_absES.Rdata")

MR_lat_ReinforcementCat_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$ReinforcementCat, ref="R-Null"), 
                      random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ReinforcementCat_max_absES) # no signif diff R-Null /  R-R / R-P
save(MR_lat_ReinforcementCat_max_absES, file = "Rdata/MR_lat_ReinforcementCat_max_absES.Rdata")

```


- AmbigReinforced
```{r MR lat data - AmbigReinforced}
MR_lat_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AmbigReinforced1) # no signif intc yes / no
save(MR_lat_AmbigReinforced1, file = "Rdata/MR_lat_AmbigReinforced1.Rdata")

MR_lat_AmbigReinforced <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$AmbigReinforced, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_AmbigReinforced) # no signif diff yes / no
save(MR_lat_AmbigReinforced, file = "Rdata/MR_lat_AmbigReinforced.Rdata")

#max_absES

MR_lat_AmbigReinforced1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_AmbigReinforced1_max_absES) # no signif intc yes / no
save(MR_lat_AmbigReinforced1_max_absES, file = "Rdata/MR_lat_AmbigReinforced1_max_absES.Rdata")

MR_lat_AmbigReinforced_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$AmbigReinforced, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_AmbigReinforced_max_absES) # no signif diff yes / no
save(MR_lat_AmbigReinforced_max_absES, file = "Rdata/MR_lat_AmbigReinforced_max_absES.Rdata")

```


- ScalePoint
```{r MR lat data - ScalePoint}
MR_lat_ScalePoint1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ScalePoint1) # no signif intc A / B / C
save(MR_lat_ScalePoint1, file = "Rdata/MR_lat_ScalePoint1.Rdata")

MR_lat_ScalePointA <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ScalePoint, ref="A"), 
                      random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ScalePointA) # no signif diff A  to B / C
save(MR_lat_ScalePointA, file = "Rdata/MR_lat_ScalePointA.Rdata")

MR_lat_ScalePointB <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~relevel(dat_lat$ScalePoint, ref="B"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_ScalePointB) # no signif diff  B to A / C
save(MR_lat_ScalePointB, file = "Rdata/MR_lat_ScalePointB.Rdata")

#max_absES

MR_lat_ScalePoint1_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ScalePoint1_max_absES) # no signif intc A / B / C
save(MR_lat_ScalePoint1_max_absES, file = "Rdata/MR_lat_ScalePoint1_max_absES.Rdata")

MR_lat_ScalePointA_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$ScalePoint, ref="A"), 
                      random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ScalePointA_max_absES) # no signif diff A  to B / C
save(MR_lat_ScalePointA_max_absES, file = "Rdata/MR_lat_ScalePointA_max_absES.Rdata")

MR_lat_ScalePointB_max_absES <- rma.mv(yi=d, V=VCV_lat_max_absES, 
                     mod = ~relevel(dat_lat_max_absES$ScalePoint, ref="B"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_lat_max_absES, method="REML") 
summary(MR_lat_ScalePointB_max_absES) # no signif diff  B to A / C
save(MR_lat_ScalePointB_max_absES, file = "Rdata/MR_lat_ScalePointB_max_absES.Rdata")

```


- Full Model (all moderators, no interactions)
```{r MR lat data - Full, all moderators }
#with phylo
MR_lat_Full_0 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Full_0) # ComparisonCategoryBetter-Worse  diff from ComparisonCategoryBenign-Worse in femalesa at A?
save(MR_lat_Full_0, file = "Rdata/MR_lat_Full_0.Rdata")


#how to simplify the model?
MR_lat_Full_1 <- rma.mv(yi=d, V=VCV_lat, 
                     mod = ~Sex + AffectManipTiming, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_lat), 
                     data = dat_lat, method="REML") 
summary(MR_lat_Full_1) # all ns
save(MR_lat_Full_1, file = "Rdata/MR_lat_Full_1.Rdata")


#dredge!
```




###############################################################################################################
###########################################         MR - PROPORTION DATA        ########################################### 
###############################################################################################################

## Meta-regression models    

- Species_Latin (Species model) 
```{r MR prop data - Species model}
MR_prop_species <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_species) # no species with clear effect
save(MR_prop_species, file = "Rdata/MR_prop_species.Rdata")

#max_absES

MR_prop_species_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_species_max_absES) # only cow with clear effect
save(MR_prop_species_max_absES, file = "Rdata/MR_prop_species_max_absES.Rdata")

```


- TaskType
```{r MR prop data - TaskType}
MR_prop_TaskType1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~TaskType -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_TaskType1) # signif intc active choice, but not go/no-go
save(MR_prop_TaskType1, file = "Rdata/MR_prop_TaskType1.Rdata")

MR_prop_TaskType <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$TaskType, ref="active choice"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_TaskType) # no signif diff active choice vs. go/no-go
save(MR_prop_TaskType, file = "Rdata/MR_prop_TaskType.Rdata")


#max_absES

MR_prop_TaskType1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~TaskType -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_TaskType1_max_absES) # signif intc active choice, but not go/no-go
save(MR_prop_TaskType1_max_absES, file = "Rdata/MR_prop_TaskType1_max_absES.Rdata")

MR_prop_TaskType_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$TaskType, ref="active choice"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_TaskType_max_absES) # no signif diff active choice vs. go/no-go
save(MR_prop_TaskType_max_absES, file = "Rdata/MR_prop_TaskType_max_absES.Rdata")

```


- Sex
```{r MR prop data - Sex}
MR_prop_sex1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Sex -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_sex1) # signif intc for males only
save(MR_prop_sex1, file = "Rdata/MR_prop_sex1.Rdata")

MR_prop_sex <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Sex, ref="male"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_sex) # ns diff 
save(MR_prop_sex, file = "Rdata/MR_prop_sex.Rdata")

#max_absES

MR_prop_sex1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~Sex -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_sex1_max_absES) # signif intc for males only
save(MR_prop_sex1_max_absES, file = "Rdata/MR_prop_sex1_max_absES.Rdata")

MR_prop_sex_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$Sex, ref="male"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_sex_max_absES) # ns diff 
save(MR_prop_sex_max_absES, file = "Rdata/MR_prop_sex_max_absES.Rdata")

```


- Age
```{r MR prop data - Age}
MR_prop_age1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Age -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_age1) # no signif intc adult/juvenile
save(MR_prop_age1, file = "Rdata/MR_prop_age1.Rdata")

MR_prop_age <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Age, ref="adult"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_age) # no signif diff adult-juvenile
save(MR_prop_age, file = "Rdata/MR_prop_age.Rdata")

#max_absES

MR_prop_age1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~Age -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_age1_max_absES) # signif intc adult/juvenile
save(MR_prop_age1_max_absES, file = "Rdata/MR_prop_age1_max_absES.Rdata")

MR_prop_age_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$Age, ref="adult"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_age_max_absES) # signif diff adult-juvenile
save(MR_prop_age_max_absES, file = "Rdata/MR_prop_age_max_absES.Rdata")

```

- Source (Captive_Wild.caught)
```{r MR prop data - Captive_Wild.caught}
MR_prop_source1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_source1) # no signif intc captive/wild-caught
save(MR_prop_source1, file = "Rdata/MR_prop_source1.Rdata")

MR_prop_source <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_source) # no signif diff captive/wild-caught
save(MR_prop_source, file = "Rdata/MR_prop_source.Rdata")

#max_absES

MR_prop_source1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_source1_max_absES) # signif intc captive
save(MR_prop_source1_max_absES, file = "Rdata/MR_prop_source1_max_absES.Rdata")

MR_prop_source_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_source_max_absES) # no signif diff captive/wild-caught
save(MR_prop_source_max_absES, file = "Rdata/MR_prop_source_max_absES.Rdata")

```


- AffectManipCat
```{r MR prop data - AffectManipCat}
MR_prop_AffectManipCat1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipCat1) # no signif intc enrichment/stress
save(MR_prop_AffectManipCat1, file = "Rdata/MR_prop_AffectManipCat1.Rdata")

MR_prop_AffectManipCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$AffectManipCat, ref="enrichment"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipCat) # no signif diff enrichment/stress
save(MR_prop_AffectManipCat, file = "Rdata/MR_prop_AffectManipCat.Rdata")

#max_absES

MR_prop_AffectManipCat1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_AffectManipCat1_max_absES) #  signif intc stress
save(MR_prop_AffectManipCat1_max_absES, file = "Rdata/MR_prop_AffectManipCat1_max_absES.Rdata")

MR_prop_AffectManipCat_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$AffectManipCat, ref="enrichment"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_AffectManipCat_max_absES) # no signif diff enrichment/stress
save(MR_prop_AffectManipCat_max_absES, file = "Rdata/MR_prop_AffectManipCat_max_absES.Rdata")

```


- AffectManipTiming
```{r MR prop data - AffectManipTiming}
MR_prop_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipTiming1) # no signif intc before/during / long-term
save(MR_prop_AffectManipTiming1, file = "Rdata/MR_prop_AffectManipTiming1.Rdata")

MR_prop_AffectManipTiming <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$AffectManipTiming, ref="before/during"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_prop_AffectManipTiming, file = "Rdata/MR_prop_AffectManipTiming.Rdata")

#max_absES

MR_prop_AffectManipTiming1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_AffectManipTiming1_max_absES) # signif intc before/during / long-term
save(MR_prop_AffectManipTiming1_max_absES, file = "Rdata/MR_prop_AffectManipTiming1_max_absES.Rdata")

MR_prop_AffectManipTiming_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$AffectManipTiming, ref="before/during"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_AffectManipTiming_max_absES) # no signif diff  before/during / long-term
save(MR_prop_AffectManipTiming_max_absES, file = "Rdata/MR_prop_AffectManipTiming_max_absES.Rdata")

```


- ComparisonCategory
```{r MR prop data - ComparisonCategory}
MR_prop_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ComparisonCategory1) # no signif intc Benign-Worse / Better-Benign / Better-Worse
save(MR_prop_ComparisonCategory1, file = "Rdata/MR_prop_ComparisonCategory1.Rdata")

MR_prop_ComparisonCategory <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Worse
save(MR_prop_ComparisonCategory, file = "Rdata/MR_prop_ComparisonCategory.Rdata")

#max_absES

MR_prop_ComparisonCategory1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_ComparisonCategory1_max_absES) #  signif intc Benign-Worse / Better-Benign
save(MR_prop_ComparisonCategory1_max_absES, file = "Rdata/MR_prop_ComparisonCategory1_max_absES.Rdata")

MR_prop_ComparisonCategory_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_ComparisonCategory_max_absES) # no signif diff Benign-Worse / Better-Benign / Better-Worse
save(MR_prop_ComparisonCategory_max_absES, file = "Rdata/MR_prop_ComparisonCategory_max_absES.Rdata")

```


- CueTypeCat
```{r MR prop data - CueTypeCat}
MR_prop_CueTypeCat1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_CueTypeCat1) # signif ittc for auditory
save(MR_prop_CueTypeCat1, file = "Rdata/MR_prop_CueTypeCat1.Rdata")

MR_prop_CueTypeCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$CueTypeCat, ref="auditory"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_CueTypeCat) # no signif diff to auditory

MR_prop_CueTypeCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$CueTypeCat, ref="tactile"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_CueTypeCat) # no signif diff to tactile
save(MR_prop_CueTypeCat, file = "Rdata/MR_prop_CueTypeCat.Rdata")

#max_absES
MR_prop_CueTypeCat1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_CueTypeCat1_max_absES) # signif intc for auditory and visual
save(MR_prop_CueTypeCat1_max_absES, file = "Rdata/MR_prop_CueTypeCat1_max_absES.Rdata")

MR_prop_CueTypeCat_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$CueTypeCat, ref="auditory"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_CueTypeCat_max_absES) # no signif diff to auditory

MR_prop_CueTypeCat_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$CueTypeCat, ref="tactile"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_CueTypeCat_max_absES) # no signif diff to tactile
save(MR_prop_CueTypeCat_max_absES, file = "Rdata/MR_prop_CueTypeCat_max_absES.Rdata")

```


- FoodDeprived
```{r MR prop data - FoodDeprived}
MR_prop_FoodDeprived1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_FoodDeprived1) # no signif intc yes / no
save(MR_prop_FoodDeprived1, file = "Rdata/MR_prop_FoodDeprived1.Rdata")

MR_prop_FoodDeprived <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$FoodDeprived, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_FoodDeprived) # no signif diff yes / no
save(MR_prop_FoodDeprived, file = "Rdata/MR_prop_FoodDeprived.Rdata")

#max_absES

MR_prop_FoodDeprived1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_FoodDeprived1_max_absES) # no signif intc yes / no
save(MR_prop_FoodDeprived1_max_absES, file = "Rdata/MR_prop_FoodDeprived1_max_absES.Rdata")

MR_prop_FoodDeprived_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$FoodDeprived, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_FoodDeprived_max_absES) # no signif diff yes / no
save(MR_prop_FoodDeprived_max_absES, file = "Rdata/MR_prop_FoodDeprived_max_absES.Rdata")

```


- Randomized_WithinBetween
```{r MR prop data - WithinBetween}
MR_prop_WithinBetween1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_WithinBetween1) # ns intc
save(MR_prop_WithinBetween1, file = "Rdata/MR_prop_MR_prop_WithinBetween1.Rdata")

MR_prop_WithinBetween <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$WithinBetween, ref="within"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_WithinBetween) # no signif diff within / between
save(MR_prop_WithinBetween, file = "Rdata/MR_prop_WithinBetween.Rdata")

#max_absES

MR_prop_WithinBetween1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_WithinBetween1_max_absES) # ns intc
save(MR_prop_WithinBetween1_max_absES, file = "Rdata/MR_prop_MR_prop_WithinBetween1_max_absES.Rdata")

MR_prop_WithinBetween_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$WithinBetween, ref="within"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_WithinBetween_max_absES) # no signif diff within / between
save(MR_prop_WithinBetween_max_absES, file = "Rdata/MR_prop_WithinBetween_max_absES.Rdata")

```


- Automated
```{r MR prop data - Automated}
MR_prop_Automated1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Automated -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Automated1) # no signif intc yes / no
save(MR_prop_Automated1, file = "Rdata/MR_prop_Automated1.Rdata")

MR_prop_Automated <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Automated, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Automated) # no signif diff yes / no
save(MR_prop_Automated, file = "Rdata/MR_prop_Automated.Rdata")

#max_absES
MR_prop_Automated1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~Automated -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_Automated1_max_absES) # no signif intc yes / no
save(MR_prop_Automated1_max_absES, file = "Rdata/MR_prop_Automated1_max_absES.Rdata")

MR_prop_Automated_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$Automated, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_Automated_max_absES) # no signif diff yes / no
save(MR_prop_Automated_max_absES, file = "Rdata/MR_prop_Automated_max_absES.Rdata")

```


- Blind
```{r MR prop data - Blind}
MR_prop_Blind1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Blind -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Blind1) # no signif intc yes / no
save(MR_prop_Blind1, file = "Rdata/MR_prop_Blind1.Rdata")

MR_prop_Blind <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$Blind, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Blind) # no signif diff yes / no
save(MR_prop_Blind, file = "Rdata/MR_prop_Blind.Rdata")

#max_absES

MR_prop_Blind1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~Blind -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_Blind1_max_absES) # no signif intc yes / no
save(MR_prop_Blind1_max_absES, file = "Rdata/MR_prop_Blind1_max_absES.Rdata")

MR_prop_Blind_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$Blind, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_Blind_max_absES) # no signif diff yes / no
save(MR_prop_Blind_max_absES, file = "Rdata/MR_prop_Blind_max_absES.Rdata")
```


- ReinforcementCat
```{r MR prop data - ReinforcementCat}
MR_prop_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ReinforcementCat1) # no signif intc 
save(MR_prop_ReinforcementCat1, file = "Rdata/MR_prop_ReinforcementCat1.Rdata")

MR_prop_ReinforcementCat <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ReinforcementCat) # no signif diff R-Null /  R-R / R-P
save(MR_prop_ReinforcementCat, file = "Rdata/MR_prop_ReinforcementCat.Rdata")

#max_absES

MR_prop_ReinforcementCat1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_ReinforcementCat1_max_absES) #  signif intc 
save(MR_prop_ReinforcementCat1_max_absES, file = "Rdata/MR_prop_ReinforcementCat1_max_absES.Rdata")

MR_prop_ReinforcementCat_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_ReinforcementCat_max_absES) #  signif diff R-Null /  R-R only
save(MR_prop_ReinforcementCat_max_absES, file = "Rdata/MR_prop_ReinforcementCat_max_absES.Rdata")
```


- AmbigReinforced
```{r MR prop data - AmbigReinforced}
MR_prop_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AmbigReinforced1) # no signif intc yes / no
save(MR_prop_AmbigReinforced1, file = "Rdata/MR_prop_AmbigReinforced1.Rdata")

MR_prop_AmbigReinforced <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$AmbigReinforced, ref="yes"), 
                      random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                    random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_AmbigReinforced) # no signif diff yes / no
save(MR_prop_AmbigReinforced, file = "Rdata/MR_prop_AmbigReinforced.Rdata")

#max_absES

MR_prop_AmbigReinforced1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_AmbigReinforced1_max_absES) # no signif intc yes / no
save(MR_prop_AmbigReinforced1_max_absES, file = "Rdata/MR_prop_AmbigReinforced1_max_absES.Rdata")

MR_prop_AmbigReinforced_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$AmbigReinforced, ref="yes"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_AmbigReinforced_max_absES) # no signif diff yes / no
save(MR_prop_AmbigReinforced_max_absES, file = "Rdata/MR_prop_AmbigReinforced_max_absES.Rdata")
```


- ScalePoint
```{r MR prop data - ScalePoint}
MR_prop_ScalePoint1 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ScalePoint1) # no signif intc A / B / C
save(MR_prop_ScalePoint1, file = "Rdata/MR_prop_ScalePoint1.Rdata")

MR_prop_ScalePointA <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~relevel(dat_prop$ScalePoint, ref="A"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_ScalePointA) # no signif diff A / B / C
save(MR_prop_ScalePointA, file = "Rdata/MR_prop_ScalePointA.Rdata")

#max_absES

MR_prop_ScalePoint1_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_ScalePoint1_max_absES) # no signif intc A / B / C
save(MR_prop_ScalePoint1_max_absES, file = "Rdata/MR_prop_ScalePoint1_max_absES.Rdata")

MR_prop_ScalePointA_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~relevel(dat_prop_max_absES$ScalePoint, ref="A"), 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_ScalePointA_max_absES) # no signif diff A / B / C
save(MR_prop_ScalePointA_max_absES, file = "Rdata/MR_prop_ScalePointA_max_absES.Rdata")
```


- Full Model (all moderators, no interactions)
```{r MR prop data - full, all moderators }
MR_prop_Full_0 <- rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                      random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                    random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
#                     R = list(Species_Latin = CorMatrix_prop), 
                     data = dat_prop, method="REML") 
summary(MR_prop_Full_0) # all ns
save(MR_prop_Full_0, file = "Rdata/RdataMR_prop_Full_0.Rdata")

#max_absES

MR_prop_Full_0_max_absES <- rma.mv(yi=d, V=VCV_prop_max_absES, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop_max_absES, method="REML") 
summary(MR_prop_Full_0_max_absES)
save(MR_prop_Full_0_max_absES, file = "Rdata/RdataMR_prop_Full_0_max_absES.Rdata")
```


```{r MR prop data - full model selection }

## based on TM code:

# create a new function to run in MuMIn
updated.rma.mv <- updateable(rma.mv)
updated.rma.mv

# quick test of the new function
full.model <- updated.rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop, method="REML")
#real full model
full.model <- updated.rma.mv(yi=d, V=VCV_prop, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop, method="REML")
summary(full.model) #all ns
# testing call of new function
getCall(full.model)
# update the new function to run in MuMIn
update(full.model)

# using dredge
meta_AICc <- dredge(full.model, rank = "AICc", m.lim = c(0,2))
meta_AICc
par(mar = c(3,5,6,4))
plot(meta_AICc, labAsExpr = TRUE)
sub_meta_AICc <- subset(meta_AICc, delta < 2)
sub_meta_AICc
plot(sub_meta_AICc, labAsExpr = TRUE)
write.table(sub_meta_AICc, "Rdata/AICc table meta-analysis T sex-ratio.csv", sep = ",", row.names = F)
summary(model.avg(meta_AICc))
# importance of each predictor
importance(meta_AICc)
#Relative variable importance: 
#                     CueTypeCat Sex  TaskType Age  AffectManipTiming FoodDeprived Captive_Wild.caught
#Importance:          0.55       0.29 0.27     0.23 0.13              0.12         0.12               
#N containing models:    9          9    9        9    9                 9            9               
#                     AffectManipCat ComparisonCategory
#Importance:          0.11           0.10              
#N containing models:    9              9  

#'Best' model
summary(get.models(meta_AICc, 1)[[1]])
#real full model with top 4:
full.model2 <- updated.rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ CueTypeCat + Sex + TaskType + Age, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop, method="REML")
summary(full.model2) #all ns


# ALTERNATIVE WAY - based on SN code
#=============================
### additional methods for "rma.mv" class (made by Kamil Barton)
### we need this to run model selection with rma.mv in MuMIn
#=============================
formula.rma.mv <- function (x, ...) return(eval(getCall(x)$mods))

makeArgs.rma.mv <-
  function (obj, termNames, comb, opt, ...) {
    ret <- MuMIn:::makeArgs.default(obj, termNames, comb, opt)
    names(ret)[1L] <- "mods"
    ret
  }

nobs.rma.mv <-
  function (object, ...)
    attr(logLik(object), "nall")

coefTable.rma.mv <- function (model, ...)
  MuMIn:::.makeCoefTable(model$b, model$se, coefNames = rownames(model$b))
#=============================

# using dredge
dredge(full.model, evaluate=F) # show all candidate models
candidate.models = dredge(full.model)
write.csv(candidate.models,'Rdata/candidate.models_prop.csv')

# display delta AICc <2
subset(candidate.models, delta < 2)

# run model averaging
summary(model.avg(candidate.models))

# importance of each predictor
importance(candidate.models)
write.csv(importance(candidate.models),'Rdata/importnce_candidate.models_prop.csv')

#try full model with the top 4:
full.model3 <- updated.rma.mv(yi=d, V=VCV_prop, 
                     mod = ~ CueTypeCat + Age + ReinforcementCat + TaskType, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     data = dat_prop, method="REML")
summary(full.model3) #all ns
```











############################################################################ OLD
############################################################################ OLD
############################################################################ OLD

#### All data points (full data set) - DO NOT USE

#Univariate models:

- Sex
```{r MR all data - Sex}
MR_all_sex1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex1) # signif intc for males only
save(MR_all_sex1, file = "Rdata/MR_all_sex1.Rdata")

MR_all_sex <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex) # ns intc for females, signif diff female-male
save(MR_all_sex, file = "Rdata/MR_all_sex.Rdata")

MR_all_sex2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex2) # signif intc for males, signif diff female-male
save(MR_all_sex2, file = "Rdata/MR_all_sex2.Rdata")
```


- Age
```{r MR all data - Age}
MR_all_age1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_age1) # no signif intc adult/juvenile
save(MR_all_age1, file = "Rdata/MR_all_age1.Rdata")

MR_all_age <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_age) # no signif diff adult-juvenile
save(MR_all_age, file = "Rdata/MR_all_age.Rdata")
```

- Source (Captive_Wild.caught)
```{r MR all data - Captive_Wild.caught}
MR_all_source1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_source1) # no signif intc captive/wild-caught
save(MR_all_source1, file = "Rdata/MR_all_source1.Rdata")

MR_all_source <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_source) # no signif diff captive/wild-caught
save(MR_all_source, file = "Rdata/MR_all_source.Rdata")
```


- AffectManipCat
```{r MR all data - AffectManipCat}
MR_all_AffectManipCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipCat1) # no signif intc enrichment/stress
save(MR_all_AffectManipCat1, file = "Rdata/MR_all_AffectManipCat1.Rdata")

MR_all_AffectManipCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipCat) # no signif diff enrichment/stress
save(MR_all_AffectManipCat, file = "Rdata/MR_all_AffectManipCat.Rdata")
```


- AffectManipTiming
```{r MR all data - AffectManipTiming}
MR_all_AffectManipTiming1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipTiming1) # no signif intc before/during / long-term
save(MR_all_AffectManipTiming1, file = "Rdata/MR_all_AffectManipTiming1.Rdata")

MR_all_AffectManipTiming <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_all_AffectManipTiming, file = "Rdata/MR_all_AffectManipTiming.Rdata")
```


- ComparisonCategory
```{r MR all data - ComparisonCategory}
MR_all_ComparisonCategory1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory1) # signif intc Benign-Worse only!   (ns intc Better-Benign / Better-Benign)
save(MR_all_ComparisonCategory1, file = "Rdata/MR_all_ComparisonCategory1.Rdata")

MR_all_ComparisonCategory <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_ComparisonCategory, file = "Rdata/MR_all_ComparisonCategory.Rdata")

MR_all_ComparisonCategory2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory2) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_ComparisonCategory2, file = "Rdata/MR_all_ComparisonCategory2.Rdata")
```


- CueTypeCat
```{r MR all data - CueTypeCat}
MR_all_CueTypeCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat1) # signif intc for auditory only
save(MR_all_CueTypeCat1, file = "Rdata/MR_all_CueTypeCat1.Rdata")

MR_all_CueTypeCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat) # spatial and visual signif diff to auditory
save(MR_all_CueTypeCat, file = "Rdata/MR_all_CueTypeCat.Rdata")

MR_all_CueTypeCat2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat2) # no signif diff to olfactory
save(MR_all_CueTypeCat2, file = "Rdata/MR_all_CueTypeCat2.Rdata")

MR_all_CueTypeCat3 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat3) # auditory signif diff to spatial
save(MR_all_CueTypeCat3, file = "Rdata/MR_all_CueTypeCat3.Rdata")

MR_all_CueTypeCat4 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat4) # no signif diff to tactile
save(MR_all_CueTypeCat4, file = "Rdata/MR_all_CueTypeCat4.Rdata")

MR_all_CueTypeCat5 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat5) # auditory signif diff to visual
save(MR_all_CueTypeCat5, file = "Rdata/MR_all_CueTypeCat5.Rdata")
```


- FoodDeprived
```{r MR all data - FoodDeprived}
MR_all_FoodDeprived1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_FoodDeprived1) # no signif intc yes / no
save(MR_all_FoodDeprived1, file = "Rdata/MR_all_FoodDeprived1.Rdata")

MR_all_FoodDeprived <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_FoodDeprived) # no signif diff yes / no
save(MR_all_FoodDeprived, file = "Rdata/MR_all_FoodDeprived.Rdata")
```


- TaskType
```{r MR all data - TaskType}
MR_all_TaskType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_TaskType1) # signif intc active choice, but not go/no-go
save(MR_all_TaskType1, file = "Rdata/MR_all_TaskType1.Rdata")

MR_all_TaskType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_TaskType) # no signif diff active choice vs. go/no-go
save(MR_all_TaskType, file = "Rdata/MR_all_TaskType.Rdata")
```


- WithinBetween
```{r MR all data - WithinBetween}
MR_all_WithinBetween1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_WithinBetween1) # signif intc within, not between
save(MR_all_WithinBetween1, file = "Rdata/MR_all_WithinBetween1.Rdata")

MR_all_WithinBetween <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_WithinBetween) # no signif diff within / between
save(MR_all_WithinBetween, file = "Rdata/MR_all_WithinBetween.Rdata")
```


- Automated
```{r MR all data - Automated}
MR_all_Automated1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Automated1) # no signif intc yes / no
save(MR_all_Automated1, file = "Rdata/MR_all_Automated1.Rdata")

MR_all_Automated <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Automated) # no signif diff yes / no
save(MR_all_Automated, file = "Rdata/MR_all_Automated.Rdata")
```


- Blind
```{r MR all data - Blind}
MR_all_Blind1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Blind1) # no signif intc yes / no
save(MR_all_Blind1, file = "Rdata/MR_all_Blind1.Rdata")

MR_all_Blind <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Blind) # no signif diff yes / no
save(MR_all_Blind, file = "Rdata/MR_all_Blind.Rdata")
```



- ReinforcementCat
```{r MR all data - ReinforcementCat}
MR_all_ReinforcementCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat1) # signif intc R-P and R-R 
save(MR_all_ReinforcementCat1, file = "Rdata/MR_all_ReinforcementCat1.Rdata")

MR_all_ReinforcementCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat) # signif diff R-Null vs  R-R
save(MR_all_ReinforcementCat, file = "Rdata/MR_all_ReinforcementCat.Rdata")

MR_all_ReinforcementCat2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat2) # no signif diff R-Null /  R-R / R-P
save(MR_all_ReinforcementCat2, file = "Rdata/MR_all_ReinforcementCat2.Rdata")
```


- AmbigReinforced
```{r MR all data - AmbigReinforced}
MR_all_AmbigReinforced1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AmbigReinforced1) # no signif intc yes / no
save(MR_all_AmbigReinforced1, file = "Rdata/MR_all_AmbigReinforced1.Rdata")

MR_all_AmbigReinforced <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AmbigReinforced) # no signif diff yes / no
save(MR_all_AmbigReinforced, file = "Rdata/MR_all_AmbigReinforced.Rdata")
```


- ScalePoint
```{r MR all data - ScalePoint}
MR_all_ScalePoint1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint1) # no signif intc A / B / C
save(MR_all_ScalePoint1, file = "Rdata/MR_all_ScalePoint1.Rdata")

MR_all_ScalePoint <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="A"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint) # no signif diff A / B / C
save(MR_all_ScalePoint, file = "Rdata/MR_all_ScalePoint.Rdata")

MR_all_ScalePoint2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="B"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint2) # no signif diff A / B / C
save(MR_all_ScalePoint2, file = "Rdata/MR_all_ScalePoint2.Rdata")
```



###########################################################
INTERACTIONS

## MeasureType * TaskType


```{r MR all data - MeasureType*TaskType}

table(dat$MeasureType, dat$TaskType)

MR_all_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_all_MeasureType_TaskType1, file = "Rdata/MR_all_MeasureType_TaskType1.Rdata")

MR_all_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~MeasureType * relevel(dat$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_all_MeasureType_TaskType2, file = "Rdata/MR_all_MeasureType_TaskType2.Rdata")

MR_all_MeasureType_TaskType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$MeasureType, ref="proportion") * relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType_TaskType) # ns diff proportion / latency
save(MR_all_MeasureType_TaskType, file = "Rdata/MR_all_MeasureType_TaskType.Rdata")
```


```{r MR dat_max_ES data - MeasureType*TaskType}
table(dat_max_ES$MeasureType, dat_max_ES$TaskType)

MR_maxES_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_maxES_MeasureType_TaskType1, file = "Rdata/MR_maxES_MeasureType_TaskType1.Rdata")

MR_maxES_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~MeasureType * relevel(dat_max_ES$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_maxES_MeasureType_TaskType2, file = "Rdata/MR_maxES_MeasureType_TaskType2.Rdata")

MR_maxES_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$MeasureType, ref="proportion") * relevel(dat_max_ES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType_TaskType) # ns diff proportion / latency
save(MR_maxES_MeasureType_TaskType, file = "Rdata/MR_maxES_MeasureType_TaskType.Rdata")
```



```{r MR dat_max_absES data - MeasureType*TaskType}
table(dat_max_absES$MeasureType, dat_max_absES$TaskType)

MR_maxabsES_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_maxabsES_MeasureType_TaskType1, file = "Rdata/MR_maxabsES_MeasureType_TaskType1.Rdata")

MR_maxabsES_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType * relevel(dat_max_absES$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_maxabsES_MeasureType_TaskType2, file = "Rdata/MR_maxabsES_MeasureType_TaskType2.Rdata")

MR_maxabsES_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$MeasureType, ref="proportion") * relevel(dat_max_absES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType_TaskType) # ns diff proportion / latency
save(MR_maxabsES_MeasureType_TaskType, file = "Rdata/MR_maxabsES_MeasureType_TaskType.Rdata")
```


```{r MR dat_max_meanES data - MeasureType*TaskType}
table(dat_max_meanES$MeasureType, dat_max_meanES$TaskType)

MR_maxmeanES_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_maxmeanES_MeasureType_TaskType1, file = "Rdata/MR_maxmeanES_MeasureType_TaskType1.Rdata")

MR_maxmeanES_MeasureType_TaskType2 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~MeasureType * relevel(dat_max_meanES$TaskType, ref="go/no-go") -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType_TaskType2) # signif intc proportion, not latency
save(MR_maxmeanES_MeasureType_TaskType2, file = "Rdata/MR_maxmeanES_MeasureType_TaskType2.Rdata")

MR_maxmeanES_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$MeasureType, ref="proportion") * relevel(dat_max_meanES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType_TaskType) # ns diff proportion / latency
save(MR_maxmeanES_MeasureType_TaskType, file = "Rdata/MR_maxmeanES_MeasureType_TaskType.Rdata")
```




- MeasureType * TaskType plots

https://quantdev.ssri.psu.edu/tutorials/five-ish-steps-create-pretty-interaction-plots-multi-level-model-r

```{r MR all data - MeasureType*TaskType - plots}
library(nlme)
library(effects)
library(ggplot2)
library(psych)

lme_all_MT_TT <- lme(fixed = d ~ MeasureType * TaskType, data=dat, random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),  na.action= na.exclude)
summary(lme_all_MT_TT)
intervals(lme_all_MT_TT)
ef1 <- effect(term="MeasureType*TaskType", mod=lme_all_MT_TT)
ef1
efdata1 <- as.data.frame(ef1) #convert the effects list to a data frame
efdata1 #print effects data frame
efdata1$TaskTypel <- as.factor(efdata1$TaskType)

ggplot(efdata1, aes(x=MeasureType, y=fit, color=TaskType,group=TaskType)) + 
    geom_point() + 
    geom_line(size=1.2) +
    geom_ribbon(aes(ymin=fit-se, ymax=fit+se, fill=TaskType),alpha=0.3) + 
    labs(title = "TaskType", x= "Measurement type", y="ES", color="MeasureType", fill="MeasureType") + theme_classic() + theme(text=element_text(size=10))





########
MR_all_MeasureType_TaskType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType * TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_all_MeasureType_TaskType1) # signif intc proportion, not latency
save(MR_all_MeasureType_TaskType1, file = "Rdata/MR_all_MeasureType_TaskType1.Rdata")

MR_all_MeasureType_TaskType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat$MeasureType, ref="proportion") * relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_all_MeasureType_TaskType) # ns diff proportion / latency
save(MR_all_MeasureType_TaskType, file = "Rdata/MR_all_MeasureType_TaskType.Rdata")
```







###########################################################
#### VIF - all data

https://stats.stackexchange.com/questions/201205/variance-inflation-factors-vif-mer-verus-group-factor-level-vif

https://stackoverflow.com/questions/26633483/collinearity-after-accounting-for-random-mixed-effects

## A VIF of 1 indicates there is no detectable linear relationship among the regressors, while a large VIF indicates a tight linear relationship
# A commonly used rule of thumb is that a VIF of 10 or more is evidence of severe multicollinearity (Cohen et

```{r vif}
vif.mer <- function (fit) {
## adapted from rms::vif
v <- vcov(fit)
nam <- names(fixef(fit))
## exclude intercepts
ns <- sum(1 * (nam == "Intercept" | nam == "(Intercept)"))
if (ns > 0) {
v <- v[-(1:ns), -(1:ns), drop = FALSE]
nam <- nam[-(1:ns)] }
d <- diag(v)^0.5
v <- diag(solve(v/(d %o% d)))
names(v) <- nam 
v }

library(lme4)
model <- lmer(d ~ MeasureType + TaskType + (1|ArticleID), data = dat)
vif.mer(model)

model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat)
vif.mer(model) #no VIF >10, but TaskType has 8.8
```


###########################################################







- Full Models
```{r MR all data - Full models}

#using all moderators 
MR_all_Full_0 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_0) # sex males signif for latency, tenedency for latency-proportion diff
save(MR_all_Full_0, file = "Rdata/MR_all_Full_0.Rdata")

MR_all_Full_0p <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + relevel(dat$MeasureType, ref="proportion") + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_0p) # sex males signif for proportion, tenedency for latency-proportion diff
save(MR_all_Full_0p, file = "Rdata/MR_all_Full_0p.Rdata")

#only using significant (diff levels) from univariate models
#without interaction (models using different reference levels):
MR_all_Full_1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_1) # signif itc for male at latency and tendency diff from proportion
save(MR_all_Full_1, file = "Rdata/MR_all_Full_1.Rdata")

MR_all_Full_2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_2) # sex female and latency diff from male and tendency from proportion
save(MR_all_Full_2, file = "Rdata/MR_all_Full_2.Rdata")

MR_all_Full_3 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="male") + relevel(dat$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_3) # male signif intc and diff from female
save(MR_all_Full_3, file = "Rdata/MR_all_Full_3.Rdata")

MR_all_Full_4 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + relevel(dat$MeasureType, ref="proportion") - 1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_4) # sex female and latency diff from male and tendency from proportion
save(MR_all_Full_4, file = "Rdata/MR_all_Full_4.Rdata")

#with interaction
MR_all_Full_2i <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex * MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Full_2i) # ns interaction, signif male-female diff, proportion-latency for female
save(MR_all_Full_2i, file = "Rdata/MR_all_Full_2i.Rdata")
     

#only using significant (diff levels) from univariate models no phylo
MR_all_Full_1x <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MR_all_Full_1x) # signif itc for male at latency and tendency diff from proportion
```



- Full Model robust meatafor
```{r MR all data - Full model robust metafor}
#only using significant (diff levels) from univariate models

#without interaction (models using different reference levels):
MR_all_Full_1_robust <- robust(MR_all_Full_1, cluster  =  dat$ExperimentID)
summary(MR_all_Full_1_robust) #same pattern as in the original model
save(MR_all_Full_1_robust,file = "Rdata/MR_all_Full_1_robust.Rdata")

MR_all_Full_2_robust <- robust(MR_all_Full_2, cluster  =  dat$ExperimentID)
summary(MR_all_Full_2_robust) #same pattern as in the original model
save(MR_all_Full_2_robust,file = "Rdata/MR_all_Full_2_robust.Rdata")

MR_all_Full_3_robust <- robust(MR_all_Full_3, cluster  =  dat$ExperimentID)
summary(MR_all_Full_3_robust) #same pattern as in the original model
save(MR_all_Full_3_robust,file = "Rdata/MR_all_Full_3_robust.Rdata")

MR_all_Full_4_robust <- robust(MR_all_Full_4, cluster  =  dat$ExperimentID)
summary(MR_all_Full_4_robust) #same pattern as in the original model
save(MR_all_Full_4_robust,file = "Rdata/MR_all_Full_4_robust.Rdata")

#with interaction
MR_all_Full_2i_robust <- robust(MR_all_Full_2i, cluster  =  dat$ExperimentID)
summary(MR_all_Full_2i_robust) #same pattern as in the original model
save(MR_all_Full_2i_robust,file = "Rdata/MR_all_Full_2i_robust.Rdata")

#only using significant (diff levels) from univariate models no phylo
MR_all_Full_1x_robust <- robust(MR_all_Full_1x, cluster  =  dat$ExperimentID)
summary(MR_all_Full_1x_robust) #same pattern as in the original model
save(MR_all_Full_1x_robust,file = "Rdata/MR_all_Full_1x_robust.Rdata")
```








###############################################################################################################
#############################         ALL DATA - PUBLICATION BIAS       ####################################### 
##############################################################################################################

```{r preliminary funnel plot}
### PLOT - funnel plot
#pdf(file="Fig_funnel_alldata.pdf",width=6,height=4,pointsize=10)
par(mfcol=c(1,1)) 
par(mar=c(4,4,2,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-8,8), xlab = "Effect size [Hd]", ylab="Precision [1/SE]", main="")
abline(v=0,lty=3)
#dev.off()
```

## TODO - change to MCMC model
```{r publ bias tests}
######## random-effect model with ArticleID as random effect:
res_MA <- rma.mv(yi=d, V=Vd, random=list(~1|ArticleID), data=dat, method="REML") 
summary(res_MA) ### estimate  0.1679 CI  0.0550  0.2808  **

Residuals <- residuals(res_MA)
Precision <- sqrt(1/res_MA$vi)
PB_model <- rma(yi=Residuals, sei=1/Precision) 
summary(PB_model)
funnel(PB_model, yaxi="seinv")
# Trim and fill
TF <- trimfill(PB_model)
TF #Estimated number of missing studies on the left side: 32 (SE = 9.8892)
funnel(TF)
# Egger's regression test
regtest(PB_model, model="lm") #test for funnel plot asymmetry: t = 2.9146, df = 230, p = 0.0039
ranktest(PB_model) #does not work - value out of range
```


```{r funnel plot}
##################### PLOT - funnel plots ##################### 
#pdf(file="plots/Fig_funnels_prelim.pdf",width=7,height=3,pointsize=14)
par(mfrow=c(1,3))
par(mar=c(4,4,4,1))
plot(dat$Hd, sqrt(1/dat$HdVar), xlim=c(-3,3), ylim=c(0,3), xlab = "effect size [Hd]", ylab="Precision [1/SE]", frame.plot=FALSE, main="A")
abline(v=0,lty=3)
abline(v=0.168,lty=1)
funnel(TF, xlim=c(-3,3), xlab = "effect size [Hd]", ylab="Standard Error [SE]",
       back="white", shade="lightgray", bg="red", main="B")
abline(v=0,lty=3)
plot(Residuals, Precision, xlim=c(-3,3), ylim=c(0,3), xlab = "Residuals", ylab="Precision [1/SE]", frame.plot=FALSE, main="C")
abline(v=0,lty=3)
dev.off()
```



#### SENSITIVITY ANALYSIS

```{r robust model}
#MA model - using a marix or vector to W which is equivalent to 'weights' in rma
#should bemore robust to publication bias (Henmi and Copas 2010)
robustml_m <- rma.mv(yi = Hd, V = HdVar, W = 1/dat$HdVar, random = list(~1|ArticleID, ~1|EffectID), method = "REML", data = dat)
summary(robustml_m) #M 0.1622 SE 0.0600  CI  0.0446  0.2798  **

```




#### OTHER
```{r test contrasts}
library(multcomp)
res_lat_prop <- rma.mv(yi=Hd, V=HdVar, mod = ~Sex-1, random=list(~1|ArticleID), data = dat, method="REML") 
summary(res_lat_prop) #latency - prop diff

glht(res_lat_prop, linfct = mcp(Sex = "Tukey")) #does not work
test1 <- glht(res_lat_prop, linfct=rbind(c(1,-1,0), c(1,0,-1), c(0,01,-1)), test=adjusted("none"))
summary(test1)
str(test1)
confint(test1)
plot(test1)

#The cld function = compact letter display (CLD) 
cld(test1) #does not work (because test1 is not Tukey?)
cld(summary(test1))
```









#### PUBLICATION BIAS

```{r preliminary funnel plot}
### PLOT - funnel plot
pdf(file="Fig_funnel_alldata.pdf",width=6,height=4,pointsize=10)
par(mfcol=c(1,1)) 
par(mar=c(4,4,2,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-6.5,6.5), xlab = "Effect size [Hg]", ylab="Precision [1/SE]", main="")
abline(v=0,lty=3)
dev.off()
```

```{r publ bias tests}
######## random-effect model with ArticleID as random effect:
res_MA <- rma.mv(yi=d, V=Vd, random=list(~1|ArticleID), data = dat, method="REML") 
summary(res_MA) ### estimate  0.1679 CI  0.0550  0.2808  **

Residuals <- residuals(res_MA)
Precision <- sqrt(1/res_MA$vi)
PB_model <- rma(yi=Residuals, sei=1/Precision) 
summary(PB_model)
funnel(PB_model, yaxi="seinv")
# Trim and fill
TF <- trimfill(PB_model)
TF #Estimated number of missing studies on the left side: 32 (SE = 9.8892)
funnel(TF)
# Egger's regression test
regtest(PB_model, model="lm") #test for funnel plot asymmetry: t = 2.9146, df = 230, p = 0.0039
ranktest(PB_model) #does not work - value out of range

##################### PLOT - funnel plots ##################### 
pdf(file="plots/Fig_funnels_prelim2.pdf",width=7,height=3,pointsize=14)
par(mfrow=c(1,3))
par(mar=c(4,4,4,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-8,8), ylim=c(0,10), xlab = "effect size [Hg]", ylab="Precision [1/SE]", frame.plot=FALSE, main="A")
abline(v=0,lty=3)
abline(v=0.168,lty=1)
funnel(TF, xlim=c(-3,3), xlab = "effect size [Hg]", ylab="Standard Error [SE]",
       back="white", shade="lightgray", bg="red", main="B")
abline(v=0,lty=3)
plot(Residuals, Precision, xlim=c(-3,3), ylim=c(0,3), xlab = "Residuals", ylab="Precision [1/SE]", frame.plot=FALSE, main="C")
abline(v=0,lty=3)
dev.off()
```



#### SENSITIVITY ANALYSIS

```{r robust model}
#MA model - using a marix or vector to W which is equivalent to 'weights' in rma
#should bemore robust to publication bias (Henmi and Copas 2010)
robustml_m <- rma.mv(yi = Hd, V = Vd, W = 1/dat$Vd, random = list(~1|ArticleID, ~1|EffectID), method = "REML", data = dat)
summary(robustml_m) #M 0.1622 SE 0.0600  CI  0.0446  0.2798  **

```

#### OTHER
```{r test contrasts}
library(multcomp)
res_lat_prop <- rma.mv(yi=d, V=Vd, mod = ~Sex-1, random=list(~1|ArticleID), data = dat, method="REML") 
summary(res_lat_prop) #latency - prop diff

glht(res_lat_prop, linfct = mcp(Sex = "Tukey")) #does not work
test1 <- glht(res_lat_prop, linfct=rbind(c(1,-1,0), c(1,0,-1), c(0,01,-1)), test=adjusted("none"))
summary(test1)
str(test1)
confint(test1)
plot(test1)

#The cld function = compact letter display (CLD) 
cld(test1) #does not work (because test1 is not Tukey?)
cld(summary(test1))
```





********************************************************************************************

# Publication bias analysis

PUBLICATION BIAS TESTS (Egger's test) and calculating RESIDUALS for the final funnel plot
--------------------------------------------------------------------------------
Checking the intercepts of Eggers regressions performed on the model residuals and measurement errors.
Evidence for publication bias if the intercept is significantly different from 0.
Following Moreno et al. 2009 (BMC Medical Research Methodology) - Eggar regression can be reconfigured into a meta-regression model. However, following Nakagawa & Santos (2012), this meta-regression still assumes non-independence, so in our model we put SE into other model together with other significant moderators

```{r Egger's publication bias tests, eval=FALSE, echo=FALSE, message=FALSE}

#load("./Rdata/MR_all_Full_1.Rdata") #with sex and measure type only as moderators
#summary(MR_all_Full_1)

prior1 <- list(R=list(V=1,nu=.002), G=list(G1=list(V=1,nu=1, alpha.mu=0, alpha.V=1000), G2=list(V=1,nu=1, alpha.mu=0, alpha.V=1000), G3=list(V=1,fix=1))) #expanded parameter prior
ES <- dat$d
VES <- dat$Vd
invVC <- as(solve(VCV), "dgCMatrix")

#bayesian models
set.seed(111)
bayesian_full1.1 <- MCMCglmm(ES ~ Sex + MeasureType -1, random=~ArticleID+ExperimentID+EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior1)
set.seed(112)
bayesian_full1.2 <- MCMCglmm(ES ~ Sex + MeasureType -1, random=~ArticleID+ExperimentID+EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior1)
set.seed(113)
bayesian_full1.3 <- MCMCglmm(ES ~ Sex + MeasureType -1, random=~ArticleID+ExperimentID+EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior1)
save(bayesian_full1.1,bayesian_full1.2, bayesian_full1.3,file="Rdata/bayesian_runs_full1.RData") 

summary(bayesian_full1.1)
model <- bayesian_full1.1
Pred <- predict(model, marginal=~EffectID)
ES <- dat$d
VES <- dat$Vd
Prec <- 1/sqrt(VES) # Precision = 1/sqrt(V)
es <- ES-Pred
zes <- es*Prec
save(es,Prec,file="Rdata/residuals_Prec.RData")
set.seed(112)
Egger <- MCMCglmm(zes~Prec,family="gaussian", data=data.frame(ES=es,Prec=Prec), verbose=TRUE, nitt=50000, thin=25, burnin=25000)
summary(Egger) #no PB
plot(es, Prec, xlab="Egger regressed effect sizes", ylab=expression("Precision  "(1/sqrt(Variance))))
mean(zes)
mean(es)

round(summary(Egger)$solutions[1,],3)

save(Egger,file="Rdata/Egger_regr.RData")
#load("Rdata/Egger_regr.RData")
```




###############################################################################################################
###########################################        SUBSET - using max ES per experiment         ###########################################
# (if there were more than 1 ambiguous cues used in traials)        ########################################### 
###############################################################################################################

```{r subset data max ES} 
dim(dat) #265 70
names(dat)

# View(tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(n())) ) #how many rows within each group 105, 121 129

dat_max <- tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(max(., na.rm = TRUE))) #which d value is max within each group
dat_max$d
#hist(dat_max$d)
dim(dat_max) #107
unique(dat_max$d) #all 107 - can use to merge back

dat_max_merged <- dplyr::inner_join(dat, dat_max, by = c("ExperimentID","MeasureType","GroupID","ComparisonCategory", "Sex","d"))

dim(dat_max_merged)
names(dat_max_merged)
#View(dat_max_merged)

dat_max <- dat_max_merged
str(dat_max)

## prepare VCV matrix - all data
VCV_max <- make_VCV_matrix(data = dat_max, V = "Vd", cluster = "GroupID", obs = "EffectID")
```

```{r subset data max2 ES} 
dim(dat) #265 70
names(dat)

# View(tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(n())) ) #how many rows within each group 105, 121 129

dat_max2 <- tbl_df(dat) %>% group_by(ExperimentID, MeasureType, GroupID, ComparisonCategory, Sex) %>% summarise_at("d", funs(max(abs(.), na.rm = TRUE))) #which d value is max within each group
dat_max2$d
#hist(dat_max$d)
dim(dat_max2) #107
unique(dat_max2$d) #all 107 - can use to merge back

dat_max2_merged <- dplyr::inner_join(dat, dat_max2, by = c("ExperimentID","MeasureType","GroupID","ComparisonCategory", "Sex","d"))

dim(dat_max2_merged)
names(dat_max2_merged)
#View(dat_max_merged)

dat_max2 <- dat_max2_merged
str(dat_max2)

## prepare VCV matrix - all data
VCV_max <- make_VCV_matrix(data = dat_max2, V = "Vd", cluster = "GroupID", obs = "EffectID")
```

## Meta-analytical models

```{r MA all data max} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_all_random_max <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     dat=dat_max, method="REML") 
summary(MA_all_random_max) 
calc.I2(dat_max$Vd, MA_all_random_max) 
save(MA_all_random_max, file = "Rdata/MA_all_random_max.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_all_random_VCV_max <- rma.mv(yi = d, V = VCV_max, 
                         random = list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max, method = "REML")
summary(MA_all_random_VCV_max)
calc.I2(dat_max$Vd, MA_all_random_VCV_max)
save(MA_all_random_VCV_max, file = "Rdata/MA_all_random_VCV_max.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
# MA_all_random_VCV_phylo_max <- rma.mv(yi=d, V=VCV_max, 
#                              random=list(~1|Species_Latin, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
#                              R = list(Species_Latin = CorMatrix_all),
#                              data = dat_max, method = "REML")  #no convergence
# summary(MA_all_random_VCV_phylo_max)   
#calc.I2(dat$Vd, MA_all_random_VCV_phylo_max) 
#save(MA_all_random_VCV_phylo_max, file = "Rdata/MA_all_random_VCV_phylo_max.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_all_max <- rma.mv(yi=d, V=VCV_max, 
                             random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max, method = "REML") 
summary(MA_all_max)    #0.5345  0.3857  0.6833  ***
calc.I2(dat_max$Vd, MA_all_max) #78.7% Htotal, 0% phylogeny, 9.1% article
save(MA_all_max, file = "Rdata/MA_all_max.Rdata")
```


## Sensitivity analysis for meta-analytic models

```{r MA all data max - sensitivity tests}
#robumeta (without phylogeny and VCV)
MA_all_max_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat_max)
print(MA_all_max_robu) #0.53   0.4393   0.676 ***
#save(MA_all_max_robu,file="Rdata/MA_all_max_robu.Rdata")

#robust metafor
MA_all_max_robust <- robust(MA_all_max, cluster  =  dat_max$ExperimentID)
summary(MA_all_max_robust) #0.5345  0.3931  0.6760  ***
save(MA_all_max_robust,file = "Rdata/MA_all_max_robust.Rdata")
```

## Meta-regression models    

Univariate models for:    
- Species_Latin (Species model)   
- Sex   
- Age   
- Source of Animals
- AffectManipCat   
- AffectManipTiming   
- ComparisonCategory   
- CueTypeCat   
- FoodDeprived   
- TaskType   
- Randomized_WithinBetween   
- Automated   
- Blind   
- MeasureType 
- ReinforcementCat
- AmbigReinforced
- ScalePoint


#Univariate models:

- Species_Latin (Species model) 
```{r MR all data max - Species model}
MR_all_max_species <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_species) # no species with clear effect
save(MR_all_max_species, file = "Rdata/MR_all_max_species.Rdata")

MR_all_max_species_nophylo <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max, method="REML") 
summary(MR_all_max_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_all_max_species_nophylo, file = "Rdata/MR_all_max_species_nophylo.Rdata")
```


- Sex
```{r MR all data max - Sex}
MR_all_max_sex1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_sex1) # signif intc for all
save(MR_all_max_sex1, file = "Rdata/MR_all_max_sex1.Rdata")

MR_all_max_sex <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_sex) # signif intc for females, ns diff female-male
save(MR_all_max_sex, file = "Rdata/MR_all_max_sex.Rdata")

MR_all_max_sex2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_sex2) # signif intc for males, ns diff female-male
save(MR_all_max_sex2, file = "Rdata/MR_all_max_sex2.Rdata")
```

- Age
```{r MR all data max - Age}
MR_all_max_age1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_age1) # signif intc adult and juvenile
save(MR_all_max_age1, file = "Rdata/MR_all_max_age1.Rdata")

MR_all_max_age <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_age) # ns diff adult-juvenile
save(MR_all_max_age, file = "Rdata/MR_all_max_age.Rdata")
```

- Source (Captive_Wild.caught)
```{r MR all data max - Captive_Wild.caught}
MR_all_max_source1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_source1) # signif intc captive/wild-caught
save(MR_all_max_source1, file = "Rdata/MR_all_max_source1.Rdata")

MR_all_max_source <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_source) # ns diff captive/wild-caught
save(MR_all_max_source, file = "Rdata/MR_all_max_source.Rdata")
```


- AffectManipCat
```{r MR all data max - AffectManipCat}
MR_all_max_AffectManipCat1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipCat1) # signif intc enrichment/stress
save(MR_all_max_AffectManipCat1, file = "Rdata/MR_all_max_AffectManipCat1.Rdata")

MR_all_max_AffectManipCat <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipCat) # ns diff enrichment/stress
save(MR_all_max_AffectManipCat, file = "Rdata/MR_all_max_AffectManipCat.Rdata")
```


- AffectManipTiming
```{r MR all data max - AffectManipTiming}
MR_all_max_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipTiming1) # signif intc before/during / long-term
save(MR_all_max_AffectManipTiming1, file = "Rdata/MR_all_max_AffectManipTiming1.Rdata")

MR_all_max_AffectManipTiming <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AffectManipTiming) # ns diff  before/during / long-term
save(MR_all_max_AffectManipTiming, file = "Rdata/MR_all_max_AffectManipTiming.Rdata")
```


- ComparisonCategory
```{r MR all data max - ComparisonCategory}
MR_all_max_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ComparisonCategory1) # signif intc Benign-Worse / Better-Benign / Better-Benign
save(MR_all_max_ComparisonCategory1, file = "Rdata/MR_all_max_ComparisonCategory1.Rdata")

MR_all_max_ComparisonCategory <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ComparisonCategory) # ns diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_max_ComparisonCategory, file = "Rdata/MR_all_max_ComparisonCategory.Rdata")

MR_all_max_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ComparisonCategory2) # ns diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_max_ComparisonCategory2, file = "Rdata/MR_all_max_ComparisonCategory2.Rdata")
```


- CueTypeCat
```{r MR all data max - CueTypeCat}
MR_all_max_CueTypeCat1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat1) # signif intc for all
save(MR_all_max_CueTypeCat1, file = "Rdata/MR_all_max_CueTypeCat1.Rdata")

MR_all_max_CueTypeCat <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat) # ns diff to auditory
save(MR_all_max_CueTypeCat, file = "Rdata/MR_all_max_CueTypeCat.Rdata")

MR_all_max_CueTypeCat2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat2) # ns diff to visual
save(MR_all_max_CueTypeCat2, file = "Rdata/MR_all_max_CueTypeCat2.Rdata")

MR_all_max_CueTypeCat3 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat3) # ns diff to visual
save(MR_all_max_CueTypeCat3, file = "Rdata/MR_all_max_CueTypeCat3.Rdata")

MR_all_max_CueTypeCat4 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_CueTypeCat4) # ns diff to visual
save(MR_all_max_CueTypeCat4, file = "Rdata/MR_all_max_CueTypeCat4.Rdata")
```


- FoodDeprived
```{r MR all data max - FoodDeprived}
MR_all_max_FoodDeprived1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_FoodDeprived1) # signif intc yes / no
save(MR_all_max_FoodDeprived1, file = "Rdata/MR_all_max_FoodDeprived1.Rdata")

MR_all_max_FoodDeprived <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_FoodDeprived) # ns diff yes / no
save(MR_all_max_FoodDeprived, file = "Rdata/MR_all_max_FoodDeprived.Rdata")
```


- TaskType
```{r MR all data max - TaskType}
MR_all_max_TaskType1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_TaskType1) # signif intc active choice and go/no-go
save(MR_all_max_TaskType1, file = "Rdata/MR_all_max_TaskType1.Rdata")

MR_all_max_TaskType <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_TaskType) # ns diff active choice vs. go/no-go
save(MR_all_max_TaskType, file = "Rdata/MR_all_max_TaskType.Rdata")
```


- WithinBetween
```{r MR all data max - WithinBetween}
MR_all_max_WithinBetween1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_WithinBetween1) # signif intc within and between
save(MR_all_max_WithinBetween1, file = "Rdata/MR_all_max_WithinBetween1.Rdata")

MR_all_max_WithinBetween <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_WithinBetween) # ns diff within / between
save(MR_all_max_WithinBetween, file = "Rdata/MR_all_max_WithinBetween.Rdata")
```


- Automated
```{r MR all data max - Automated}
MR_all_max_Automated1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Automated1) # signif intc yes / no
save(MR_all_max_Automated1, file = "Rdata/MR_all_max_Automated1.Rdata")

MR_all_max_Automated <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Automated) # ns diff yes / no
save(MR_all_max_Automated, file = "Rdata/MR_all_max_Automated.Rdata")
```


- Blind
```{r MR all data max - Blind}
MR_all_max_Blind1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Blind1) # signif intc yes / no
save(MR_all_max_Blind1, file = "Rdata/MR_all_max_Blind1.Rdata")

MR_all_max_Blind <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Blind) # ns diff yes / no
save(MR_all_max_Blind, file = "Rdata/MR_all_max_Blind.Rdata")
```


- MeasureType
```{r MR all data max - MeasureType}
MR_all_max_MeasureType1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_MeasureType1) # signif intc proportion and latency
save(MR_all_max_MeasureType1, file = "Rdata/MR_all_max_MeasureType1.Rdata")

MR_all_max_MeasureType <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_MeasureType) # signif diff proportion / latency
save(MR_all_max_MeasureType, file = "Rdata/MR_all_max_MeasureType.Rdata")
```


- ReinforcementCat
```{r MR all data max - ReinforcementCat}
MR_all_max_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ReinforcementCat1) # ns signif intcfor R-Null, signif for R-P and R-R
save(MR_all_max_ReinforcementCat1, file = "Rdata/MR_all_max_ReinforcementCat1.Rdata")

MR_all_max_ReinforcementCat <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ReinforcementCat) # no signif diff R-Null /  R-R / R-P
save(MR_all_max_ReinforcementCat, file = "Rdata/MR_all_max_ReinforcementCat.Rdata")

MR_all_max_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ReinforcementCat2) # no signif diff R-Null /  R-R / R-P
save(MR_all_max_ReinforcementCat2, file = "Rdata/MR_all_max_ReinforcementCat2.Rdata")
```


- AmbigReinforced
```{r MR all data max - AmbigReinforced}
MR_all_max_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AmbigReinforced1) # signif intc no, ns intc yes
save(MR_all_max_AmbigReinforced1, file = "Rdata/MR_all_max_AmbigReinforced1.Rdata")

MR_all_max_AmbigReinforced <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_AmbigReinforced) # no signif diff yes / no
save(MR_all_max_AmbigReinforced, file = "Rdata/MR_all_max_AmbigReinforced.Rdata")
```


- ScalePoint
```{r MR all data max - ScalePoint}
MR_all_max_ScalePoint1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ScalePoint1) #  signif intc A / B / C
save(MR_all_max_ScalePoint1, file = "Rdata/MR_all_max_ScalePoint1.Rdata")

MR_all_max_ScalePoint <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ScalePoint, ref="A"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ScalePoint) # no signif diff A / B / C
save(MR_all_max_ScalePoint, file = "Rdata/MR_all_max_ScalePoint.Rdata")

MR_all_max_ScalePoint2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$ScalePoint, ref="B"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_ScalePoint2) # no signif diff A / B / C
save(MR_all_max_ScalePoint2, file = "Rdata/MR_all_max_ScalePoint2.Rdata")
```


- Full Models
```{r MR all data max - Full models}

#using all moderators 
MR_all_max_Full_0 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_0) # latency-proportion diff
save(MR_all_max_Full_0, file = "Rdata/MR_all_max_Full_0.Rdata")

MR_all_max_Full_0p <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + relevel(dat_max$MeasureType, ref="proportion") + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_0p) # latency-proportion diff
save(MR_all_max_Full_0p, file = "Rdata/MR_all_max_Full_0p.Rdata")

#only using significant (diff levels) from univariate models
#without interaction (models using different reference levels):
MR_all_max_Full_1 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_1) # signif intc for female, male, mixed-sex at latency,latency diff from proportion
save(MR_all_max_Full_1, file = "Rdata/MR_all_max_Full_1.Rdata")

MR_all_max_Full_2 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_2) # sex female at latency ns diff from male, latency diff from proportion
save(MR_all_max_Full_2, file = "Rdata/MR_all_max_Full_2.Rdata")

MR_all_max_Full_3 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~relevel(dat_max$Sex, ref="male") + relevel(dat_max$MeasureType, ref="proportion"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_3) # male signif intc and ns diff from female, prop diff from latency
save(MR_all_max_Full_3, file = "Rdata/MR_all_max_Full_3.Rdata")

MR_all_max_Full_4 <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + relevel(dat_max$MeasureType, ref="proportion") - 1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_4) # all signif
save(MR_all_max_Full_4, file = "Rdata/MR_all_max_Full_4.Rdata")

#with interaction
MR_all_max_Full_2i <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex * MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_2i) # ns interaction, ns diff male-female, signif diff proportion-latency for female
save(MR_all_max_Full_2i, file = "Rdata/MR_all_max_Full_2i.Rdata")
     

#only using significant (diff levels) from univariate models on full data set, no phylo
MR_all_max_Full_1x <- rma.mv(yi=d, V=VCV_max, 
                     mod = ~Sex + MeasureType, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max, method="REML") 
summary(MR_all_max_Full_1x) # signif intc for female at latency, ns diff between sexes, latency diff from proportion
```



- Full Model robust meatafor
```{r MR all data max - Full model robust metafor}
#only using significant (diff levels) from univariate models in full data set

#without interaction (models using different reference levels):
MR_all_max_Full_1_robust <- robust(MR_all_max_Full_1, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_1_robust) #same pattern as in the original model
save(MR_all_max_Full_1_robust,file = "Rdata/MR_all_max_Full_1_robust.Rdata")

MR_all_max_Full_2_robust <- robust(MR_all_max_Full_2, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_2_robust) #same pattern as in the original model
save(MR_all_max_Full_2_robust,file = "Rdata/MR_all_max_Full_2_robust.Rdata")

MR_all_max_Full_3_robust <- robust(MR_all_max_Full_3, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_3_robust) #same pattern as in the original model
save(MR_all_max_Full_3_robust,file = "Rdata/MR_all_max_Full_3_robust.Rdata")

MR_all_max_Full_4_robust <- robust(MR_all_max_Full_4, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_4_robust) #same pattern as in the original model
save(MR_all_max_Full_4_robust,file = "Rdata/MR_all_max_Full_4_robust.Rdata")

#with interaction
MR_all_max_Full_2i_robust <- robust(MR_all_max_Full_2i, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_2i_robust) #same pattern as in the original model
save(MR_all_max_Full_2i_robust,file = "Rdata/MR_all_max_Full_2i_robust.Rdata")

#only using significant (diff levels) from univariate models no phylo
MR_all_max_Full_1x_robust <- robust(MR_all_max_Full_1x, cluster  =  dat_max$ExperimentID)
summary(MR_all_max_Full_1x_robust) #same pattern as in the original model
save(MR_all_max_Full_1x_robust,file = "Rdata/MR_all_max_Full_1x_robust.Rdata")
```

