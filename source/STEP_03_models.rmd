---
title: "meta-analysis"
author: "ML"
date: "04/01/2020"
output: html_document
---

# MA of cognitive bias (optimism) in animal studies.

## STEP3 - MA modelling
[do not knit]    

(originally script: "Meta-Analaysis_merged_ML2.R")    

This script runs main and additional models that are later used to create plots (STEP_04), tables (STEP_05) and results (STEP_06).    


```{r setup, eval=TRUE, include=FALSE}
sessionInfo()
options(scipen=100)
pacman::p_load(tidyverse, magrittr, fulltext, rotl, ape, dplyr, tidyr, rotl, fulltext, metafor, car, robumeta, MuMIn, lme4, effects, MCMCglmm, multicomp)
source("./functions/functions.R") #functions specific to optimism project (data transformations) and I2 function

#writeLines(capture.output(sessionInfo()), "./log_sessioninfo/sessionInfo.txt") #save session info into a text file
writeLines(capture.output(sessionInfo()), paste0("./log_sessioninfo/sessionInfo_STEP03_", format(Sys.time(), "%d-%b-%Y %H.%M"), ".txt")) #save session info into a text file with timestamp in the file name
```

```{r load data, eval=TRUE, include=FALSE} 
rm(list=ls()) # Clean up
dat <- read.csv("./data/MA_dataset_with_ES_subsets.csv") #for kntting
#dat <- read.csv("data/MA_dataset_with_ES_subsets.csv")
dim(dat) #459 76
#str(dat) 
names(dat)

table(dat$ScalePoint) #we now have 5 scale points: MID   N  NN  NP   P

#### SUBSET with only ambiguous cue data points:
dat_amb <- dplyr::filter(dat, ScalePoint %in% c("MID","NN","NP"))
dim(dat_amb) #269

### SUBSETS from all data (proportion and latency) by picking only one ES from the curves/tests with >1 scale points (we use the prepared columns that already code these choices):
dat_max_ES <- dplyr::filter(dat, max_ES == 1) #subset by picking maximum ES from each curve (i.e. get the most positive=optimistic response available)
dim(dat_max_ES) #108

dat_max_absES <- dplyr::filter(dat, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each curve (i.e. get the most positive or negatve response available)
dim(dat_max_absES) #108

dat_max_meanES <- dplyr::filter(dat, biggest_meandir == 1) #subset by picking ES from each curve which has the biggest absolute value in the direction of the mean value of all ES from the curve (i.e. biggest in the overall direction of the response)
dim(dat_max_meanES) #108

dat_MID_ES <- dplyr::filter(dat, ScalePoint == "MID") #subset by picking only middle (MID) ES from each curve
dim(dat_MID_ES) 


#### SUBSETS by MeasureType:
table(dat$MeasureType) # 201 "latency", 258 "proportion"

## proportion data (all scale points)
dat_prop <- dplyr::filter(dat, MeasureType == "proportion") #subset proportion data
dim(dat_prop)
dat_prop <- droplevels(dat_prop) 
str(dat_prop) # 16 (18?) species

##latency data (all scale points)
dat_lat <- dplyr::filter(dat, MeasureType == "latency") #subset latency data
dim(dat_lat) 
dat_lat <- droplevels(dat_lat) 
str(dat_lat) # 13 species


### SUBSETS from proportion data by picking only one ES from the curves/tests with >1 scale points [we use the columns that code already code these choices):
dat_prop_max_ES <- dplyr::filter(dat_prop, max_ES == 1) #subset by picking maximum ES from each curve (i.e. get the most positive=optimistic response available)
dim(dat_prop_max_ES) 

dat_prop_max_absES <- dplyr::filter(dat_prop, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each curve (i.e. get the most positive or negatve response available)
dim(dat_prop_max_absES) 

dat_prop_max_meanES <- dplyr::filter(dat_prop, biggest_meandir == 1) #subset by picking ES from each curve which has the biggest absolute value in the direction of the mean value of all 3 ES from the curve (i.e. biggest in the overall direction of the response)
dim(dat_prop_max_meanES) 

dat_prop_MID_ES <- dplyr::filter(dat_prop, ScalePoint == "MID") #subset by picking only middle (MID) ES from each curve
dim(dat_prop_MID_ES) 



### SUBSETS from latency data by picking only one ES from the curves/tests with >1 Scale Points [we use the columns that code already code these choices):
dat_lat_max_ES <- dplyr::filter(dat_lat, max_ES == 1) #subset by picking maximum ES from each curve (i.e. get the most positive=optimistic response available)
dim(dat_lat_max_ES) #46

dat_lat_max_absES <- dplyr::filter(dat_lat, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each curve (i.e. get the most positive or negatve response available)
dim(dat_lat_max_absES) 

dat_lat_max_meanES <- dplyr::filter(dat_lat, biggest_meandir == 1) #subset by picking ES from each curve which has the biggest absolute value in the direction of the mean value of all ES from the curve (i.e. biggest in the overall direction of the response)
dim(dat_lat_max_meanES) 

dat_lat_MID_ES <- dplyr::filter(dat_lat, ScalePoint == "MID") #subset by picking only middle (MID) ES from each curve
dim(dat_lat_MID_ES) 
```


```{r VCV matrices, eval=TRUE, include=FALSE} 
#### all data (proportion and latency)
## prepare VCV matrix - all data (proportion and latency)
VCV <- make_VCV_matrix(data = dat, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV)

## data for ambiguous cues only:
VCV_dat_amb <- make_VCV_matrix(data = dat_amb, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_dat_amb)

## all data (proportion and latency) subsets without data triplicates:
## prepare VCV matrix - dat_max_absES all data (proportion and latency)
VCV_max_absES <- make_VCV_matrix(data = dat_max_absES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_max_absES)

## prepare VCV matrix - dat_max_ES all data (proportion and latency)
VCV_max_ES <- make_VCV_matrix(data = dat_max_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_max_ES)

## prepare VCV matrix - dat_max_meanES all data (proportion and latency)
VCV_max_meanES <- make_VCV_matrix(data = dat_max_meanES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_max_meanES)

## prepare VCV matrix - dat_MID_ES all data (proportion and latency)
VCV_MID_ES <- make_VCV_matrix(data = dat_MID_ES, V = "Vd", cluster = "GroupID", obs = "EffectID")
dim(VCV_MID_ES)
```


```{r phylo matrices, eval=TRUE, include=FALSE} 
## prepare species correlation matrix - all data (proportion and latency)
# Note: this matrix is also usable for  ES subsets from ScalePoint curve-based subsets
tree <- read.tree(file="./data/tree_all.tre")
is.binary.tree(tree) #TRUE
is.ultrametric(tree) #TRUE
# plot(tree, cex=0.8) #plot with branch lengths
CorMatrix_all <- vcv(tree, corr=TRUE)
#setdiff(colnames(CorMatrix_all), unique(dat$Species_Latin)) #all ok
```



###############################################################################################################
#########################################       META-ANALYSIS       ########################################### 
###############################################################################################################

########################################################
#### All data points (full data set) - preliminary


## ** Random effect structure to be used**
#Choose random effect structure by conducting LRTs, and for that we need ML estimates
#Possible random effects: Article, Experiment, Species and phylogeny

```{r all data - chose random effects, eval=FALSE, include=FALSE}

meta1null <- rma.mv(yi = d, V = Vd, data=dat, method = 'ML') 
meta1study <- rma.mv(yi = d, V = Vd, random =~1|ArticleID, data=dat, method = 'ML') 
#adding ArticleID as random effects to correct for effect sizes from same paper
anova(meta1study, meta1null) #ArticleID is important

meta1exp <- rma.mv(yi = d, V = Vd, random =list(~1|ArticleID, ~1|ExperimentID), data=dat, method = 'ML') 
#adding ExperimentID as random effects to correct for effect sizes from same experiment
anova(meta1exp, meta1study) #ExperimentID is important

meta1sp = rma.mv(yi = d, V = Vd, random = ~1|Species_Latin, data=dat, method = 'ML')
anova(meta1sp, meta1null)
#Species is important by itself

meta1expsp <- rma.mv(yi = d, V = Vd, random =list(~1|ArticleID, ~1|ExperimentID, ~1|Species_Latin), data=dat, method = 'ML') 
anova(meta1expsp, meta1exp) #Species is not important with Article and Experiment IDs


meta1phy = rma.mv(yi = d, V = Vd, random = list(~1|ArticleID, ~1|ExperimentID, ~1|Species_Latin),
                             R = list(Species_Latin = CorMatrix_all), data=dat, method = 'ML')
anova(meta1phy, meta1null) #Phylogeny important relatively to null
anova(meta1phy, meta1exp) #Phylogeny not important relatively to model with Article and Experiment IDs

#models with VCV (variance-covariance matrices to account for non-independence)
meta1expVCV = rma.mv(yi = d, V = VCV, random = list(~1|ArticleID, ~1|ExperimentID), data=dat, method = 'ML')
#anova(meta1expVCV, meta1exp) #cant compare!

meta1phyVCV = rma.mv(yi = d, V = VCV, random = list(, ~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID),
                             R = list(Species_Latin = CorMatrix_all), data=dat, method = 'ML')
anova(meta1expVCV, meta1phyVCV) #Phylogeny not important relatively to model with Species, Article and Experiment IDs

AIC.rma(meta1null, meta1phy, meta1sp, meta1exp, meta1expsp, meta1expVCV, meta1phyVCV, correct = TRUE) #%>% arrange(AICc)
#meta1exp model has lowest AIC (Article and Experiment ID only), followed closely by meta1phy and meta1expsp (the smaller the AIC the better the fit)
```

########################################################
### All data points (full data set)

```{r MA all data, eval=TRUE, include=TRUE} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_all_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MA_all_random) 
I2(MA_all_random, method = "Shinichi") 
save(MA_all_random, file = "Rdata/MA_all_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_all_random_VCV <- rma.mv(yi = d, V = VCV, 
                         random = list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat, method = "REML")
summary(MA_all_random_VCV)
I2(MA_all_random_VCV, method = "Shinichi")
save(MA_all_random_VCV, file = "Rdata/MA_all_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_all_random_VCV_phylo <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ScientificName, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat, method = "REML") 
summary(MA_all_random_VCV_phylo)   
I2(MA_all_random_VCV_phylo, method = "Shinichi") # 0% speciesID - species identity contributed little to account for this heterogeneity (<0.01%); thus subsequent models will be run without species identity as random factor
save(MA_all_random_VCV_phylo, file = "Rdata/MA_all_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_all <- rma.mv(yi=d, V=VCV, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat, method = "REML") 
summary(MA_all)    
I2(MA_all, method = "Shinichi")
#I2(MA_all, method = "Wolfgang") #this is default method for I2, gives very similar estimates
save(MA_all, file = "Rdata/MA_all.Rdata")


######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_all_nophylo <- rma.mv(yi=d, V=VCV, 
                             random=list( ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat, method = "REML") 
summary(MA_all_nophylo)    
I2(MA_all_nophylo, method = "Shinichi")
save(MA_all_nophylo, file = "Rdata/MA_all_nophylo.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_all_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat)
print(MA_all_robu) #0.191  0.0732    0.31
#save(MA_all_robu,file="Rdata/MA_all_robu.Rdata")

#robust metafor
MA_all_robust <- robust(MA_all, cluster = dat$ExperimentID)
summary(MA_all_robust) #0.19  0.08  0.31
save(MA_all_robust,file = "Rdata/MA_all_robust.Rdata")
```

###############################################################################################################
#########################################     UNIVARIATE  META-REGRESSIONS on ALL DATA      
###############################################################################################################

############################################################
###################  UNIVARIATE META-REGRESSIONS
- Species
- Sex  
- TaskType  
- CueTypeCat 
- ReinforcementCat
- AmbigReinforced
- ScalePoint
- Source of Animals
- Age   
- AffectManipCat   
- AffectManipTiming  
- ComparisonCategory   
- WithinBetween 
- FoodDeprived   
- MeasureType
- Automated   
- Blind   



#### SPECIES ####

### Species_Latin (Species model) on all data points
```{r MR all data - Species model, eval=TRUE, include=TRUE}
#with phylogeny
MR_all_species <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_species) # no species with clear effect
save(MR_all_species, file = "Rdata/MR_all_species.Rdata")

#without phylogeny
MR_all_species_nophylo <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat, method="REML") 
summary(MR_all_species_nophylo) # only rat with clear effect, when phylogeny not taken into account
save(MR_all_species_nophylo, file = "Rdata/MR_all_species_nophylo.Rdata")
```


#####  Sex

```{r MR all data - Sex}
MR_all_sex1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex1) # signif intc for males only
save(MR_all_sex1, file = "Rdata/MR_all_sex1.Rdata")

MR_all_sex <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex) # ns intc for females, signif diff female-male
save(MR_all_sex, file = "Rdata/MR_all_sex.Rdata")

MR_all_sex2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_sex2) # signif intc for males, signif diff female-male
save(MR_all_sex2, file = "Rdata/MR_all_sex2.Rdata")
```

#####  TaskType

```{r MR all data - TaskType}
MR_all_TaskType1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_TaskType1) # signif intc active choice, but not go/no-go
save(MR_all_TaskType1, file = "Rdata/MR_all_TaskType1.Rdata")

MR_all_TaskType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_TaskType) # no signif diff active choice vs. go/no-go
save(MR_all_TaskType, file = "Rdata/MR_all_TaskType.Rdata")
```

#####  CueTypeCat

```{r MR all data - CueTypeCat}
MR_all_CueTypeCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat1) # signif intc for auditory only
save(MR_all_CueTypeCat1, file = "Rdata/MR_all_CueTypeCat1.Rdata")

MR_all_CueTypeCat_auditory <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat_auditory) # spatial and visual signif diff to auditory
save(MR_all_CueTypeCat_auditory, file = "Rdata/MR_all_CueTypeCat_auditory.Rdata")

MR_all_CueTypeCat_olfactory <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat_olfactory) # no signif diff to olfactory
save(MR_all_CueTypeCat_olfactory, file = "Rdata/MR_all_CueTypeCat_olfactory.Rdata")

MR_all_CueTypeCat_spatial <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat_spatial) # auditory signif diff to spatial
save(MR_all_CueTypeCat_spatial, file = "Rdata/MR_all_CueTypeCat_spatial.Rdata")

MR_all_CueTypeCat_tactile <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat_tactile) # no signif diff to tactile
save(MR_all_CueTypeCat_tactile, file = "Rdata/MR_all_CueTypeCat_tactile.Rdata")

MR_all_CueTypeCat_visual <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_CueTypeCat_visual) # auditory signif diff to visual
save(MR_all_CueTypeCat_visual, file = "Rdata/MR_all_CueTypeCat_visual.Rdata")
```

#####  ReinforcementCat

```{r MR all data - ReinforcementCat}
MR_all_ReinforcementCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat1) # signif intc R-P and R-R 
save(MR_all_ReinforcementCat1, file = "Rdata/MR_all_ReinforcementCat1.Rdata")

MR_all_ReinforcementCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat) # signif diff R-Null vs  R-R
save(MR_all_ReinforcementCat, file = "Rdata/MR_all_ReinforcementCat.Rdata")

MR_all_ReinforcementCat2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ReinforcementCat2) # no signif diff R-Null /  R-R / R-P
save(MR_all_ReinforcementCat2, file = "Rdata/MR_all_ReinforcementCat2.Rdata")
```

#####  AmbigReinforced

```{r MR all data - AmbigReinforced}
MR_all_AmbigReinforced1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AmbigReinforced1) # no signif intc yes / no
save(MR_all_AmbigReinforced1, file = "Rdata/MR_all_AmbigReinforced1.Rdata")

MR_all_AmbigReinforced <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AmbigReinforced) # no signif diff yes / no
save(MR_all_AmbigReinforced, file = "Rdata/MR_all_AmbigReinforced.Rdata")
```

#####  ScalePoint

```{r MR all data - ScalePoint}
ScalePoint_ord <- ordered(dat$ScalePoint, levels = c("P", "NP", "MID", "NN", "N"))

MR_all_ScalePoint1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint1) # no signif intc 
save(MR_all_ScalePoint1, file = "Rdata/MR_all_ScalePoint1.Rdata")

MR_all_ScalePoint_P <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint_P) # no signif diff A / B / C
save(MR_all_ScalePoint_P, file = "Rdata/MR_all_ScalePoint_P.Rdata")

MR_all_ScalePoint_NP <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="NP"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint_NP) # no signif diff
save(MR_all_ScalePoint_NP, file = "Rdata/MR_all_ScalePoint_NP.Rdata")

MR_all_ScalePoint_MID <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="MID"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint_MID) # no signif diff 
save(MR_all_ScalePoint_MID, file = "Rdata/MR_all_ScalePoint_MID.Rdata")

MR_all_ScalePoint_NN <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="NN"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint_NN) # no signif diff 
save(MR_all_ScalePoint_NN, file = "Rdata/MR_all_ScalePoint_NN.Rdata")

MR_all_ScalePoint_N <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ScalePoint, ref="N"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint_N) # no signif diff
save(MR_all_ScalePoint_N, file = "Rdata/MR_all_ScalePoint_N.Rdata")


#ordered model 1 - for creating tables
MR_all_ScalePoint1ord <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScalePoint_ord -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ScalePoint1ord) # no signif intc 
save(MR_all_ScalePoint1ord, file = "Rdata/MR_all_ScalePoint1ord.Rdata")


#ordered model 2 - for creating plot (ordered orchard plot) - temporary workaround
dat2 <- dat
dat2$ScalePoint_ord <- dat2$ScalePoint
levels(dat2$ScalePoint_ord) <- c("3_MID", "5_N", "4_NN", "2_NP", "1_P")

MR_all_ScalePoint1ord2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ScalePoint_ord -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat2, method="REML") 
summary(MR_all_ScalePoint1ord2) # no signif intc 
save(MR_all_ScalePoint1ord2, file = "Rdata/MR_all_ScalePoint1ord2.Rdata")
```

#####  Source (Captive_Wild.caught)

```{r MR all data - Captive_Wild.caught}
MR_all_source1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_source1) # no signif intc captive/wild-caught
save(MR_all_source1, file = "Rdata/MR_all_source1.Rdata")

MR_all_source <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_source) # no signif diff captive/wild-caught
save(MR_all_source, file = "Rdata/MR_all_source.Rdata")
```

#####  Age

```{r MR all data - Age}
MR_all_age1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_age1) # no signif intc adult/juvenile
save(MR_all_age1, file = "Rdata/MR_all_age1.Rdata")

MR_all_age <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_age) # no signif diff adult-juvenile
save(MR_all_age, file = "Rdata/MR_all_age.Rdata")
```

#####  AffectManipCat

```{r MR all data - AffectManipCat}
MR_all_AffectManipCat1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipCat1) # no signif intc enrichment/stress
save(MR_all_AffectManipCat1, file = "Rdata/MR_all_AffectManipCat1.Rdata")

MR_all_AffectManipCat <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipCat) # no signif diff enrichment/stress
save(MR_all_AffectManipCat, file = "Rdata/MR_all_AffectManipCat.Rdata")
```

#####  AffectManipTiming

```{r MR all data - AffectManipTiming}
MR_all_AffectManipTiming1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipTiming1) # no signif intc before/during / long-term
save(MR_all_AffectManipTiming1, file = "Rdata/MR_all_AffectManipTiming1.Rdata")

MR_all_AffectManipTiming <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_AffectManipTiming) # no signif diff  before/during / long-term
save(MR_all_AffectManipTiming, file = "Rdata/MR_all_AffectManipTiming.Rdata")
```


#####  ComparisonCategory

```{r MR all data - ComparisonCategory}
MR_all_ComparisonCategory1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory1) # signif intc Benign-Worse only!   (ns intc Better-Benign / Better-Benign)
save(MR_all_ComparisonCategory1, file = "Rdata/MR_all_ComparisonCategory1.Rdata")

MR_all_ComparisonCategory <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_ComparisonCategory, file = "Rdata/MR_all_ComparisonCategory.Rdata")

MR_all_ComparisonCategory2 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_ComparisonCategory2) # no signif diff Benign-Worse / Better-Benign / Better-Benign
save(MR_all_ComparisonCategory2, file = "Rdata/MR_all_ComparisonCategory2.Rdata")
```

#####  WithinBetween

```{r MR all data - WithinBetween}
MR_all_WithinBetween1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_WithinBetween1) # signif intc within, not between
save(MR_all_WithinBetween1, file = "Rdata/MR_all_WithinBetween1.Rdata")

MR_all_WithinBetween <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_WithinBetween) # no signif diff within / between
save(MR_all_WithinBetween, file = "Rdata/MR_all_WithinBetween.Rdata")
```

#####  FoodDeprived

```{r MR all data - FoodDeprived}
MR_all_FoodDeprived1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_FoodDeprived1) # no signif intc yes / no
save(MR_all_FoodDeprived1, file = "Rdata/MR_all_FoodDeprived1.Rdata")

MR_all_FoodDeprived <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_FoodDeprived) # no signif diff yes / no
save(MR_all_FoodDeprived, file = "Rdata/MR_all_FoodDeprived.Rdata")
```

##### MeasureType

```{r MR all data - MeasureType, eval=TRUE, include=TRUE}
#with phylogeny
MR_all_MeasureType <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_MeasureType) # ns diff proportion / latency
save(MR_all_MeasureType, file = "Rdata/MR_all_MeasureType.Rdata")
```

#####  Automated

```{r MR all data - Automated}
MR_all_Automated1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Automated1) # no signif intc yes / no
save(MR_all_Automated1, file = "Rdata/MR_all_Automated1.Rdata")

MR_all_Automated <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Automated) # no signif diff yes / no
save(MR_all_Automated, file = "Rdata/MR_all_Automated.Rdata")
```

#####  Blind

```{r MR all data - Blind}
MR_all_Blind1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Blind1) # no signif intc yes / no
save(MR_all_Blind1, file = "Rdata/MR_all_Blind1.Rdata")

MR_all_Blind <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Blind) # no signif diff yes / no
save(MR_all_Blind, file = "Rdata/MR_all_Blind.Rdata")
```



######################################################## VIF
###########################################################

#### Testing for multicollinearity among potential moderators VIF - all data

https://stats.stackexchange.com/questions/201205/variance-inflation-factors-vif-mer-verus-group-factor-level-vif

https://stackoverflow.com/questions/26633483/collinearity-after-accounting-for-random-mixed-effects

A VIF of 1 indicates there is no detectable linear relationship among the regressors, while a large VIF indicates a tight linear relationship.  A commonly used rule of thumb is that a VIF of 10 or more is evidence of severe multicollinearity (Cohen et )

```{r vif}
vif.mer <- function (fit) {
  ## adapted from rms::vif
  v <- vcov(fit)
  nam <- names(fixef(fit))
  ## exclude intercepts
  ns <- sum(1 * (nam == "Intercept" | nam == "(Intercept)"))
  if (ns > 0) {
    v <- v[-(1:ns), -(1:ns), drop = FALSE]
    nam <- nam[-(1:ns)] }
  d <- diag(v)^0.5
  v <- diag(solve(v/(d %o% d)))
  names(v) <- nam 
  v 
  }

library(lme4)
model <- lmer(d ~ MeasureType + TaskType + (1|ArticleID), data = dat)
vif.mer(model)

model <- lmer(d ~ Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind + MeasureType + ReinforcementCat + AmbigReinforced + ScalePoint + (1|ExperimentID), data = dat)
vif.mer(model) #no VIF >10, but TaskType has 8.8

model <- lmer(d ~ Sex + MeasureType + TaskType + CueTypeCat + FoodDeprived + ReinforcementCat + AmbigReinforced + WithinBetween + ScalePoint + (1|ExperimentID), data = dat)
vif.mer(model) #only TaskTypego/no-g and CueTypeCatspatial have VIF > 3

#as in our full model (simplified):
model <- lmer(d ~ Sex  + TaskType + CueTypeCat + ReinforcementCat + (1|ExperimentID), data = dat)
vif.mer(model) #all ok
```


################## FULL MODEL

- Full Model (all signif moderators, no interactions) 
```{r MR  data - full, all moderators }
#all data
MR_Full_0 <- rma.mv(yi=d, V=VCV, 
#                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
#                     mod = ~Sex + MeasureType + TaskType + CueTypeCat + FoodDeprived + ReinforcementCat + AmbigReinforced + WithinBetween, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_Full_0) # all ns
R2(MR_Full_0) # all ns
save(MR_Full_0, file = "Rdata/MR_Full_0.Rdata")


#relevelling to biggest effect levels:
MR_Full_1 <- rma.mv(yi=d, V=VCV, 
                     mod = ~relevel(dat$Sex, ref="male") + relevel(dat$TaskType, ref="active choice") + relevel(dat$CueTypeCat, ref="visual") + relevel(dat$ReinforcementCat, ref="R-R"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_Full_1) # all ns
save(MR_Full_1, file = "Rdata/MR_Full_1.Rdata")
```


################## Model selection #################

```{r all data -  model selection, eval=FALSE, include=FLASE}
# create a new function to run in MuMIn
#updated.rma.mv <- updateable(rma.mv)
#updated.rma.mv

eval(metafor:::.MuMIn)

# re-run full model with method = "ML" so that we can compare AIC (#does not converge with phylogeny)
mr_full <- rma.mv(yi=d, V=VCV, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
                       test = "t",
                       random=list(~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                       method="ML",
                       data = dat)
summary(mr_full)
save(mr_full, file = "Rdata/mr_full.Rdata")
#R2(mr_full)

# testing call of new function
getCall(mr_full)
# update the new function to run in MuMIn
#update(mr_full)

# using dredge
meta_AICc <- dredge(mr_full, trace=2)
meta_AICc #does not work properly gives Warning: "Extra argument ('formula') disregarded
save(metaAICc, file = "Rdata/meta_AICc.Rdata")
#load(file = "Rdata/meta_AICc.Rdata")
par(mar = c(3,5,6,4))
plot(meta_AICc, labAsExpr = TRUE)

sub_meta_AICc <- subset(meta_AICc, delta < 2)
sub_meta_AICc

plot(sub_meta_AICc, labAsExpr = TRUE)
#write.table(sub_meta_AICc, "Rdata/AICc table .csv", sep = ",", row.names = F)
summary(model.avg(meta_AICc))

# coerce the object out.put into a data frame and tidy up
sel.table <- as.data.frame(sub_meta_AICc)[6:10]
sel.table[,2:3]<- round(sel.table[,2:3],2)
sel.table[,4:5]<- round(sel.table[,4:5],3) 
names(sel.table)[1] = "K" 
sel.table$Model <- rownames(sel.table) 
#for(i in 1:nrow(sel.table)) sel.table$Model[i] <- as.character(formula(paste(sel.table$Model[i])))[3] #invalid formula
sub_meta_AICc #
sel.table$Model <- c("Task type","Reinforcement Category","Sex + Task type", "Reinforcement Category + Task type","Intercept-only (no moderators)") #manually setting model formulas
sel.table <- sel.table[,c(6,1,2,3,4,5)] #reorder rows
sel.table
save(sel.table, file = "Rdata/meta_AICc_seltable.Rdata")

# importance of each predictor
importance(meta_AICc)
#Relative variable importance: 
#                     TaskType ReinforcementCat Sex  CueTypeCat
# Sum of weights:      0.49     0.39             0.32 0.18      
# N containing models:    8        8                8    8   
write.csv(importance(meta_AICc),'Rdata/importance_fullmodels.csv')
#read.csv(file='./Rdata/importance_fullmodels.csv')

#'Best' model
summary(get.models(meta_AICc, 1)[[1]])
# Model Results:        estimate      se    tval    pval    ci.lb   ci.ub 
# intrcpt                0.0117  0.1042  0.1119  0.9109  -0.1931  0.2164    
# intrcpt             0.4407  0.1319   3.3424  0.0009   0.1816   0.6998  *** 
# TaskTypego/no-go   -0.2882  0.1431  -2.0138  0.0446  -0.5695  -0.0070    * 
```


###############################################################################################################
######################################       SENSITIVITY ANALYSIS       ####################################### 
###############################################################################################################


###################################### Meta-analysis alternative robust models ################################

```{r robust model, eval=FALSE, include=FALSE}
#robust metafor
MA_all_robust <- robust(MA_all, cluster  =  dat$ExperimentID)
summary(MA_all_robust) #0.19922  0.0830  0.3014  *** 
save(MA_all_robust,file = "Rdata/MA_all_robust.Rdata")

#MA model - using a marix or vector to W which is equivalent to 'weights' in rma
#should bemore robust to publication bias (Henmi and Copas 2010)
robustml_MA <- rma.mv(yi = d, V = Vd, W = 1/dat$Vd, random = list(~1|ScalePoint, ~1|ArticleID, ~1|EffectID), method = "REML", data = dat)
summary(robustml_MA) #M 0.1778 0.0099  0.3457  *
save(robustml_MA,file = "Rdata/robustml_MA.Rdata")

#robumeta (without phylogeny and VCV)
MA_all_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", small = TRUE, data = dat)
print(MA_all_robu) #0.184   0.0835    0.285 ***
#save(MA_all_robu,file="Rdata/MA_all_robu.Rdata")
```

- Meta-regression - Full Model: meatafor + robust function
```{r MR all data - Full model robust metafor, eval=FALSE, include=FALSE}
MR_Full_0_robust <- robust(MR_Full_0, cluster  =  dat$ExperimentID)
summary(MR_Full_0_robust) #same pattern as in the original model - all na
save(MR_Full_0_robust,file = "Rdata/MR_Full_0_robust.Rdata")
```

- Bayesian models
```{r Bayesian all data, eval=FALSE, include=FALSE}
prior2 <- list( R=list(V=1, nu=.002), G=list(G1=list(V=1, nu=1, alpha.mu=0, alpha.V=1000), G2=list(V=1, nu=1, alpha.mu=0, alpha.V=1000), G3=list(V=1, nu=1, alpha.mu=0, alpha.V=1000), G4=list(V=1, fix=1))) #expanded parameter prior
ES <- dat$d
VES <- dat$Vd
invVC <- as(solve(VCV), "dgCMatrix")

#bayesian models (without phylogeny)

##meta-analysis
set.seed(111)
bayesian_MA1.1 <- MCMCglmm(ES ~ 1, random = ~ ScalePoint + ArticleID + ExperimentID + EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior2)
summary(bayesian_MA1.1)
save(bayesian_MA1.1, file = "Rdata/bayesian_MA1.1.Rdata")
#load(file = "./Rdata/bayesian_MA1.1.Rdata")

set.seed(112)
bayesian_MA1.2 <- MCMCglmm(ES ~ 1, random = ~ ScalePoint + ArticleID + ExperimentID + EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior2)
summary(bayesian_MA1.2)
save(bayesian_MA1.2, file = "Rdata/bayesian_MA1.2.Rdata")
#load(file = "./Rdata/bayesian_MA1.2.Rdata")

set.seed(113)
bayesian_MA1.3 <- MCMCglmm(ES ~ 1, random = ~ ScalePoint + ArticleID + ExperimentID + EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior2)
summary(bayesian_MA1.3)
save(bayesian_MA1.3, file = "Rdata/bayesian_MA1.3.Rdata")
#load(file = "./Rdata/bayesian_MA1.1.Rdata")

#I2 for MA
#s2 <- sum(1/dat$Vd*(length(1/dat$Vd)-1))/(sum(1/dat$Vd)^2-sum(1/dat$Vd^2)) 
#I2 <- 100*(bayesian_MA1.1$VCV[,"ScalePoint"] + bayesian_MA1.1$VCV[,"ArticleID"] + bayesian_MA1.1$VCV[,"ExperimentID"] + bayesian_MA1.1$VCV[,"EffectID"] ) / (bayesian_MA1.1$VCV[,"ScalePoint"] + bayesian_MA1.1$VCV[,"ArticleID"] + bayesian_MA1.1$VCV[,"ExperimentID"] + bayesian_MA1.1$VCV[,"EffectID"]  + bayesian_MA1.1$VCV[,"units"] + s2)
#posterior.mode(I2)
#HPDinterval(I2)
#summary(I2)


##meta-regression
set.seed(111)
bayesian_MR1.1 <- MCMCglmm(ES ~ Sex + TaskType  + CueTypeCat + ReinforcementCat, random = ~ ScalePoint + ArticleID + ExperimentID + EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior2)
summary(bayesian_MR1.1)
save(bayesian_MR1.1, file = "Rdata/bayesian_MR1.1.Rdata")

set.seed(112)
bayesian_MR1.2 <- MCMCglmm(ES ~ Sex + TaskType  + CueTypeCat + ReinforcementCat, random = ~ ScalePoint + ArticleID + ExperimentID + EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior2)
summary(bayesian_MR1.2)
save(bayesian_MR1.2, file = "Rdata/bayesian_MR1.2.Rdata")

set.seed(113)
bayesian_MR1.3 <- MCMCglmm(ES ~ Sex + TaskType  + CueTypeCat + ReinforcementCat, random = ~ ScalePoint + ArticleID + ExperimentID + EffectID, family="gaussian", ginverse = list(EffectID=invVC), data=dat, verbose=T, nitt=110000, thin=100, burnin=10000, pr=T, prior=prior2)
summary(bayesian_MR1.3)
save(bayesian_MR1.3, file = "Rdata/bayesian_MR1.3.Rdata")

#R2 for MR
#(var(mean(bayesian_MR1.1$Sol[,2]) * bayesian_MR1.1$X[, 2] + mean(bayesian_MR1.1$Sol[, 3]) * bayesian_MR1.1$X[, 3] + mean(bayesian_MR1.1$Sol[ ,4]) * bayesian_MR1.1$X[, 4]) + sum(apply(bayesian_MR1.1$VCV,2,mean)[c(-3,-4)])) / (var(mean(bayesian_MR1.1$Sol[,2]) * bayesian_MR1.1$X[, 2] + mean(bayesian_MR1.1$Sol[, 3]) * bayesian_MR1.1$X[, 3] + mean(bayesian_MR1.1$Sol[ ,4]) * bayesian_MR1.1$X[, 4]) + sum(apply(bayesian_MR1.1$VCV,2,mean)[-3]))
```


##################################################### SUBSET ANALYSES #####################################################


###################################   SUBSET 1  - using ambiguous cues only  ################################## 

### Ambiguous cues ES data subset (dat_amb, k=269)    
Subset made from ES with ambiguous cues value from each curve (i.e. excluded responses to non-ambiguous cues)    


#### dat_amb - meta-analysis

```{r MA MA_amb_nophylosubset, eval=TRUE, include=TRUE} 
######## random-effect model with VCV and  phylogeny, removed non-contibuting random effects
MA_amb <- rma.mv(yi=d, V=VCV_dat_amb, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_amb, method = "REML") 
summary(MA_amb)    
I2(MA_amb, method = "Shinichi")
save(MA_amb, file = "Rdata/MA_amb.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny) TODO
MA_amb_random_VCV <- rma.mv(yi = d, V = VCV_dat_amb, 
                         random = list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_amb, method = "REML")
summary(MA_amb_random_VCV)
I2(MA_amb_random_VCV, method = "Shinichi")
save(MA_amb_random_VCV, file = "Rdata/MA_amb_random_VCV.Rdata")

######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_amb_nophylo <- rma.mv(yi=d, V=VCV_dat_amb, 
                             random=list(~1|ArticleID, ~1|ScalePoint, ~1|ExperimentID, ~1|EffectID),
                             data = dat_amb, method = "REML") 
summary(MA_amb_nophylo)    
I2(MA_amb_nophylo, method = "Shinichi")
save(MA_amb_nophylo, file = "Rdata/MA_amb_nophylo.Rdata")
```

#### dat_amb - Species_Latin (Species model)

```{r MR dat_amb - Species, eval=TRUE, include=TRUE}
#with phylogeny
MR_amb_species <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_species)
save(MR_amb_species, file = "Rdata/MR_amb_species.Rdata")

#without phylogeny
MR_amb_species_nophylo <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ScalePoint, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_amb, method="REML")
summary(MR_amb_species_nophylo) 
save(MR_amb_species_nophylo, file = "Rdata/MR_amb_species_nophylo.Rdata")
```

#####  dat_amb - Sex

```{r MR dat_amb - Sex}
MR_amb_sex1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_sex1) 
save(MR_amb_sex1, file = "Rdata/MR_amb_sex1.Rdata")

MR_amb_sex <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_sex) 
save(MR_amb_sex, file = "Rdata/MR_amb_sex.Rdata")

MR_amb_sex2 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_sex2) 
save(MR_amb_sex2, file = "Rdata/MR_amb_sex2.Rdata")
```

#####  dat_amb - TaskType

```{r MR dat_amb - TaskType}
MR_amb_TaskType1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_TaskType1) 
save(MR_amb_TaskType1, file = "Rdata/MR_amb_TaskType1.Rdata")

MR_amb_TaskType <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_TaskType) 
save(MR_amb_TaskType, file = "Rdata/MR_amb_TaskType.Rdata")
```

#####  dat_amb - CueTypeCat

```{r MR dat_amb - CueTypeCat}
MR_amb_CueTypeCat1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_CueTypeCat1)
save(MR_amb_CueTypeCat1, file = "Rdata/MR_amb_CueTypeCat1.Rdata")

MR_amb_CueTypeCat_auditory <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_CueTypeCat_auditory)
save(MR_amb_CueTypeCat_auditory, file = "Rdata/MR_amb_CueTypeCat_auditory.Rdata")

MR_amb_CueTypeCat_olfactory <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_CueTypeCat_olfactory)
save(MR_amb_CueTypeCat_olfactory, file = "Rdata/MR_amb_CueTypeCat_olfactory.Rdata")

MR_amb_CueTypeCat_spatial <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_CueTypeCat_spatial) 
save(MR_amb_CueTypeCat_spatial, file = "Rdata/MR_amb_CueTypeCat_spatial.Rdata")

MR_amb_CueTypeCat_tactile <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_CueTypeCat_tactile) 
save(MR_amb_CueTypeCat_tactile, file = "Rdata/MR_amb_CueTypeCat_tactile.Rdata")

MR_amb_CueTypeCat_visual <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_CueTypeCat_visual)
save(MR_amb_CueTypeCat_visual, file = "Rdata/MR_amb_CueTypeCat_visual.Rdata")
```

#####  dat_amb - ReinforcementCat

```{r MR dat_amb - ReinforcementCat}
MR_amb_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ReinforcementCat1) 
save(MR_amb_ReinforcementCat1, file = "Rdata/MR_amb_ReinforcementCat1.Rdata")

MR_amb_ReinforcementCat <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ReinforcementCat) 
save(MR_amb_ReinforcementCat, file = "Rdata/MR_amb_ReinforcementCat.Rdata")

MR_amb_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ReinforcementCat2) 
save(MR_amb_ReinforcementCat2, file = "Rdata/MR_amb_ReinforcementCat2.Rdata")
```

#####  dat_amb - AmbigReinforced

```{r MR dat_amb - AmbigReinforced}
MR_amb_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_AmbigReinforced1) 
save(MR_amb_AmbigReinforced1, file = "Rdata/MR_amb_AmbigReinforced1.Rdata")

MR_amb_AmbigReinforced <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_AmbigReinforced) 
save(MR_amb_AmbigReinforced, file = "Rdata/MR_amb_AmbigReinforced.Rdata")
```

#####  dat_amb - ScalePoint

```{r MR dat_amb - ScalePoint}
MR_amb_ScalePoint1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ScalePoint1) 
save(MR_amb_ScalePoint1, file = "Rdata/MR_amb_ScalePoint1.Rdata")

MR_amb_ScalePoint_P <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(ScalePoint, ref="P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ScalePoint_P) 
save(MR_amb_ScalePoint_P, file = "Rdata/MR_amb_ScalePoint_P.Rdata")

MR_amb_ScalePoint_NP <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ScalePoint, ref="NP"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ScalePoint_NP) 
save(MR_amb_ScalePoint_NP, file = "Rdata/MR_amb_ScalePoint_NP.Rdata")

MR_amb_ScalePoint_MID <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ScalePoint, ref="MID"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ScalePoint_MID) 
save(MR_amb_ScalePoint_MID, file = "Rdata/MR_amb_ScalePoint_MID.Rdata")

MR_amb_ScalePoint_NN <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ScalePoint, ref="NN"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ScalePoint_NN)  
save(MR_amb_ScalePoint_NN, file = "Rdata/MR_amb_ScalePoint_NN.Rdata")

MR_amb_ScalePoint_N <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ScalePoint, ref="N"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ScalePoint_N) 
save(MR_amb_ScalePoint_N, file = "Rdata/MR_amb_ScalePoint_N.Rdata")
```

#####  dat_amb - Source (Captive vs. Wild.caught)

```{r MR dat_amb - Captive_Wild.caught}
MR_amb_source1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_source1) 
save(MR_amb_source1, file = "Rdata/MR_amb_source1.Rdata")

MR_amb_source <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_source) 
save(MR_amb_source, file = "Rdata/MR_amb_source.Rdata")
```

#####  dat_amb - Age

```{r MR dat_amb - Age}
MR_amb_age1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_age1) 
save(MR_amb_age1, file = "Rdata/MR_amb_age1.Rdata")

MR_amb_age <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_age) 
save(MR_amb_age, file = "Rdata/MR_amb_age.Rdata")
```

#####  dat_amb - AffectManipCat

```{r MR dat_amb - AffectManipCat}
MR_amb_AffectManipCat1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_AffectManipCat1) 
save(MR_amb_AffectManipCat1, file = "Rdata/MR_amb_AffectManipCat1.Rdata")

MR_amb_AffectManipCat <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_AffectManipCat)
save(MR_amb_AffectManipCat, file = "Rdata/MR_amb_AffectManipCat.Rdata")
```

#####  dat_amb - AffectManipTiming

```{r MR dat_amb - AffectManipTiming}
MR_amb_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_AffectManipTiming1) 
save(MR_amb_AffectManipTiming1, file = "Rdata/MR_amb_AffectManipTiming1.Rdata")

MR_amb_AffectManipTiming <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_AffectManipTiming) 
save(MR_amb_AffectManipTiming, file = "Rdata/MR_amb_AffectManipTiming.Rdata")
```

#####  dat_amb - ComparisonCategory

```{r MR dat_amb - ComparisonCategory}
MR_amb_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ComparisonCategory1)
save(MR_amb_ComparisonCategory1, file = "Rdata/MR_amb_ComparisonCategory1.Rdata")

MR_amb_ComparisonCategory <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ComparisonCategory) 
save(MR_amb_ComparisonCategory, file = "Rdata/MR_amb_ComparisonCategory.Rdata")

MR_amb_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_ComparisonCategory2)
save(MR_amb_ComparisonCategory2, file = "Rdata/MR_amb_ComparisonCategory2.Rdata")
```

#####  dat_amb - WithinBetween

```{r MR all data - WithinBetween}
MR_amb_WithinBetween1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_WithinBetween1) 
save(MR_amb_WithinBetween1, file = "Rdata/MR_amb_WithinBetween1.Rdata")

MR_amb_WithinBetween <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_WithinBetween) 
save(MR_amb_WithinBetween, file = "Rdata/MR_amb_WithinBetween.Rdata")
```

#####  dat_amb - FoodDeprived

```{r MR dat_amb - FoodDeprived}
MR_amb_FoodDeprived1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_FoodDeprived1) 
save(MR_amb_FoodDeprived1, file = "Rdata/MR_amb_FoodDeprived1.Rdata")

MR_amb_FoodDeprived <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_FoodDeprived) 
save(MR_amb_FoodDeprived, file = "Rdata/MR_amb_FoodDeprived.Rdata")
```

##### dat_amb - MeasureType

```{r MR dat_amb - MeasureType, eval=TRUE, include=TRUE}
MR_amb_MeasureType <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_MeasureType) 
save(MR_amb_MeasureType, file = "Rdata/MR_amb_MeasureType.Rdata")

#intercepts model
MR_amb_MeasureType1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_MeasureType1) 
save(MR_amb_MeasureType1, file = "Rdata/MR_amb_MeasureType1.Rdata")
```

#####  dat_amb - Automated

```{r MR dat_amb - Automated}
MR_amb_Automated1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_Automated1) # no signif intc yes / no
save(MR_amb_Automated1, file = "Rdata/MR_amb_Automated1.Rdata")

MR_amb_Automated <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_Automated) # no signif diff yes / no
save(MR_amb_Automated, file = "Rdata/MR_amb_Automated.Rdata")
```

#####  dat_amb - Blind

```{r MR dat_amb - Blind}
MR_amb_Blind1 <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_Blind1) # no signif intc yes / no
save(MR_amb_Blind1, file = "Rdata/MR_amb_Blind1.Rdata")

MR_amb_Blind <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~relevel(dat_amb$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_Blind) # no signif diff yes / no
save(MR_amb_Blind, file = "Rdata/MR_amb_Blind.Rdata")
```




#### dat_amb - full model

```{r MR full model - ambiguos cues data subset, eval=FALSE, include=FALSE}
#dat_amb <- dplyr::filter(dat, ScalePoint %in% c("MID","NN","NP"))
dim(dat_amb) #269

#full model
MR_Full_0_ambES <- rma.mv(yi=d, V=VCV_dat_amb, 
#                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_Full_0_ambES) #all ns
R2(MR_Full_0_ambES)
save(MR_Full_0_ambES, file = "Rdata/MR_Full_0_ambES.Rdata")
```



###################################   SUBSET 2  - using MID cue only  ################################## 
### Max MID ES data subset (dat_MID_ES)
Subset of ES from each curve which isin the midpoint (i.e. MID) 


#### dat_MID_ES - meta-analysis

```{r MA dat_MID_ES subset, eval=FALSE, include=FALSE} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_MID_ES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|GroupID, ~1|EffectID), 
                     data = dat_MID_ES, method="REML") 
summary(MA_MID_ES_random) 
I2(MA_MID_ES_random, method = "Shinichi") 
save(MA_MID_ES_random, file = "Rdata/MA_MID_ES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_MID_ES_random_VCV <- rma.mv(yi = d, V = VCV_MID_ES, 
                         random = list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_MID_ES, method = "REML")
summary(MA_MID_ES_random_VCV)
I2(MA_MID_ES_random_VCV, method = "Shinichi")
save(MA_MID_ES_random_VCV, file = "Rdata/MA_MID_ES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_MID_ES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_MID_ES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_MID_ES, method = "REML") 
summary(MA_MID_ES_random_VCV_phylo)   
I2(MA_MID_ES_random_VCV_phylo, method = "Shinichi") 
save(MA_MID_ES_random_VCV_phylo, file = "Rdata/MA_MID_ES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_MID_ES <- rma.mv(yi=d, V=VCV_MID_ES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_MID_ES, method = "REML") 
summary(MA_MID_ES )    
I2(MA_MID_ES, method = "Shinichi") 
save(MA_MID_ES, file = "Rdata/MA_MID_ES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_MID_ES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smB_ES  = TRUE, data = dat_MID_ES)
print(MA_MID_ES_robu)
#save(MA_MID_ES_robu,file="Rdata/MA_MID_ES_robu.Rdata")

#robust metafor
MA_MID_ES_robust <- robust(MA_MID_ES , cluster = dat_MID_ES$ExperimentID)
summary(MA_MID_ES_robust) #0.29  0.09  0.49
save(MA_MID_ES_robust,file = "Rdata/MA_MID_ES_robust.Rdata")
```


########################################################
#### dat_MID - Species_Latin (Species model)

```{r MR dat_max_absES data - Species model, eval=TRUE, include=TRUE}
#with phylogeny
MR_MID_species <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_species) # cow signif positive
save(MR_MID_species, file = "Rdata/MR_MID_species.Rdata")

#without phylogeny
MR_MID_species_nophylo <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ScalePoint, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_MID_ES, method="REML")
summary(MR_MID_species_nophylo) # rat and cow
save(MR_MID_species_nophylo, file = "Rdata/MR_MID_species_nophylo.Rdata")
```




#####  dat_MID_ES - Sex

```{r MR dat_MID_ES - Sex}
MR_MID_sex1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_sex1) 
save(MR_MID_sex1, file = "Rdata/MR_MID_sex1.Rdata")

MR_MID_sex <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_sex) 
save(MR_MID_sex, file = "Rdata/MR_MID_sex.Rdata")

MR_MID_sex2 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_sex2) 
save(MR_MID_sex2, file = "Rdata/MR_MID_sex2.Rdata")
```

#####  dat_MID_ES - TaskType

```{r MR dat_MID_ES - TaskType}
MR_MID_TaskType1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_TaskType1) 
save(MR_MID_TaskType1, file = "Rdata/MR_MID_TaskType1.Rdata")

MR_MID_TaskType <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_TaskType) 
save(MR_MID_TaskType, file = "Rdata/MR_MID_TaskType.Rdata")
```

#####  dat_MID_ES - CueTypeCat

```{r MR dat_MID_ES - CueTypeCat}
MR_MID_CueTypeCat1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_CueTypeCat1)
save(MR_MID_CueTypeCat1, file = "Rdata/MR_MID_CueTypeCat1.Rdata")

MR_MID_CueTypeCat_auditory <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_CueTypeCat_auditory)
save(MR_MID_CueTypeCat_auditory, file = "Rdata/MR_MID_CueTypeCat_auditory.Rdata")

MR_MID_CueTypeCat_olfactory <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_CueTypeCat_olfactory)
save(MR_MID_CueTypeCat_olfactory, file = "Rdata/MR_MID_CueTypeCat_olfactory.Rdata")

MR_MID_CueTypeCat_spatial <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_CueTypeCat_spatial) 
save(MR_MID_CueTypeCat_spatial, file = "Rdata/MR_MID_CueTypeCat_spatial.Rdata")

MR_MID_CueTypeCat_tactile <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_CueTypeCat_tactile) 
save(MR_MID_CueTypeCat_tactile, file = "Rdata/MR_MID_CueTypeCat_tactile.Rdata")

MR_MID_CueTypeCat_visual <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_CueTypeCat_visual)
save(MR_MID_CueTypeCat_visual, file = "Rdata/MR_MID_CueTypeCat_visual.Rdata")
```

#####  dat_MID_ES - ReinforcementCat

```{r MR dat_MID_ES - ReinforcementCat}
MR_MID_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ReinforcementCat1) 
save(MR_MID_ReinforcementCat1, file = "Rdata/MR_MID_ReinforcementCat1.Rdata")

MR_MID_ReinforcementCat <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ReinforcementCat) 
save(MR_MID_ReinforcementCat, file = "Rdata/MR_MID_ReinforcementCat.Rdata")

MR_MID_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ReinforcementCat2) 
save(MR_MID_ReinforcementCat2, file = "Rdata/MR_MID_ReinforcementCat2.Rdata")
```

#####  dat_MID_ES - AmbigReinforced

```{r MR dat_MID_ES - AmbigReinforced}
MR_MID_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_AmbigReinforced1) 
save(MR_MID_AmbigReinforced1, file = "Rdata/MR_MID_AmbigReinforced1.Rdata")

MR_MID_AmbigReinforced <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_AmbigReinforced) 
save(MR_MID_AmbigReinforced, file = "Rdata/MR_MID_AmbigReinforced.Rdata")
```

#####  dat_MID_ES - ScalePoint

```{r MR dat_MID_ES - ScalePoint}
MR_MID_ScalePoint1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ScalePoint1) 
save(MR_MID_ScalePoint1, file = "Rdata/MR_MID_ScalePoint1.Rdata")

MR_MID_ScalePoint_P <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(ScalePoint, ref="P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ScalePoint_P) 
save(MR_MID_ScalePoint_P, file = "Rdata/MR_MID_ScalePoint_P.Rdata")

MR_MID_ScalePoint_NP <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ScalePoint, ref="NP"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ScalePoint_NP) 
save(MR_MID_ScalePoint_NP, file = "Rdata/MR_MID_ScalePoint_NP.Rdata")

MR_MID_ScalePoint_MID <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ScalePoint, ref="MID"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ScalePoint_MID) 
save(MR_MID_ScalePoint_MID, file = "Rdata/MR_MID_ScalePoint_MID.Rdata")

MR_MID_ScalePoint_NN <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ScalePoint, ref="NN"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ScalePoint_NN)  
save(MR_MID_ScalePoint_NN, file = "Rdata/MR_MID_ScalePoint_NN.Rdata")

MR_MID_ScalePoint_N <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ScalePoint, ref="N"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ScalePoint_N) 
save(MR_MID_ScalePoint_N, file = "Rdata/MR_MID_ScalePoint_N.Rdata")
```

#####  dat_MID_ES - Source (Captive vs. Wild.caught)

```{r MR dat_MID_ES - Captive_Wild.caught}
MR_MID_source1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_source1) 
save(MR_MID_source1, file = "Rdata/MR_MID_source1.Rdata")

MR_MID_source <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_source) 
save(MR_MID_source, file = "Rdata/MR_MID_source.Rdata")
```

#####  dat_MID_ES - Age

```{r MR dat_MID_ES - Age}
MR_MID_age1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_age1) 
save(MR_MID_age1, file = "Rdata/MR_MID_age1.Rdata")

MR_MID_age <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_age) 
save(MR_MID_age, file = "Rdata/MR_MID_age.Rdata")
```

#####  dat_MID_ES - AffectManipCat

```{r MR dat_MID_ES - AffectManipCat}
MR_MID_AffectManipCat1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_AffectManipCat1) 
save(MR_MID_AffectManipCat1, file = "Rdata/MR_MID_AffectManipCat1.Rdata")

MR_MID_AffectManipCat <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_AffectManipCat)
save(MR_MID_AffectManipCat, file = "Rdata/MR_MID_AffectManipCat.Rdata")
```

#####  dat_MID_ES - AffectManipTiming

```{r MR dat_MID_ES - AffectManipTiming}
MR_MID_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_AffectManipTiming1) 
save(MR_MID_AffectManipTiming1, file = "Rdata/MR_MID_AffectManipTiming1.Rdata")

MR_MID_AffectManipTiming <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_AffectManipTiming) 
save(MR_MID_AffectManipTiming, file = "Rdata/MR_MID_AffectManipTiming.Rdata")
```

#####  dat_MID_ES - ComparisonCategory

```{r MR dat_MID_ES - ComparisonCategory}
MR_MID_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ComparisonCategory1)
save(MR_MID_ComparisonCategory1, file = "Rdata/MR_MID_ComparisonCategory1.Rdata")

MR_MID_ComparisonCategory <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ComparisonCategory) 
save(MR_MID_ComparisonCategory, file = "Rdata/MR_MID_ComparisonCategory.Rdata")

MR_MID_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_ComparisonCategory2)
save(MR_MID_ComparisonCategory2, file = "Rdata/MR_MID_ComparisonCategory2.Rdata")
```

#####  dat_MID_ES - WithinBetween

```{r MR all data - WithinBetween}
MR_MID_WithinBetween1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_WithinBetween1) 
save(MR_MID_WithinBetween1, file = "Rdata/MR_MID_WithinBetween1.Rdata")

MR_MID_WithinBetween <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_WithinBetween) 
save(MR_MID_WithinBetween, file = "Rdata/MR_MID_WithinBetween.Rdata")
```

#####  dat_MID_ES - FoodDeprived

```{r MR dat_MID_ES - FoodDeprived}
MR_MID_FoodDeprived1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_FoodDeprived1) 
save(MR_MID_FoodDeprived1, file = "Rdata/MR_MID_FoodDeprived1.Rdata")

MR_MID_FoodDeprived <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_FoodDeprived) 
save(MR_MID_FoodDeprived, file = "Rdata/MR_MID_FoodDeprived.Rdata")
```

##### dat_MID_ES - MeasureType

```{r MR dat_MID_ES - MeasureType, eval=TRUE, include=TRUE}
MR_MID_MeasureType <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_MeasureType) 
save(MR_MID_MeasureType, file = "Rdata/MR_MID_MeasureType.Rdata")

#intercepts model
MR_MID_MeasureType1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_MeasureType1) 
save(MR_MID_MeasureType1, file = "Rdata/MR_MID_MeasureType1.Rdata")
```

#####  dat_MID_ES - Automated

```{r MR dat_MID_ES - Automated}
MR_MID_Automated1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_Automated1) # no signif intc yes / no
save(MR_MID_Automated1, file = "Rdata/MR_MID_Automated1.Rdata")

MR_MID_Automated <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_Automated) # no signif diff yes / no
save(MR_MID_Automated, file = "Rdata/MR_MID_Automated.Rdata")
```

#####  dat_MID_ES - Blind

```{r MR dat_MID_ES - Blind}
MR_MID_Blind1 <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_Blind1) # no signif intc yes / no
save(MR_MID_Blind1, file = "Rdata/MR_MID_Blind1.Rdata")

MR_MID_Blind <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~relevel(dat_MID_ES$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_Blind) # no signif diff yes / no
save(MR_MID_Blind, file = "Rdata/MR_MID_Blind.Rdata")
```

#### dat_MID_ES - full model

```{r MR full model - MID_ES cues data subset, eval=FALSE, include=FALSE}
#dat_MID_ES <- dplyr::filter(dat, ScalePoint == "MID") #subset by picking only middle (MID) ES from each curve
dim(dat_MID_ES) #108

#full model
MR_Full_0_MID_ES <- rma.mv(yi=d, V=VCV_MID_ES, 
#                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_Full_0_MID_ES) #all ns
R2(MR_Full_0_MID_ES) 
save(MR_Full_0_MID_ES, file = "Rdata/MR_Full_0_MID_ES.Rdata")
```



###################################   SUBSET 3  - using max_absES  ################################## 
### Max absolute ES data subset (dat_max_absES, k=106)
Subset made from ES with the biggest absolute value from each curve (i.e. get the most positive or negatve response available)

#### dat_max_absES - meta-analysis

```{r MA dat_max_absES subset, eval=TRUE, include=TRUE} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxabsES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_absES, method="REML") 
summary(MA_maxabsES_random) 
I2(dMA_maxabsES_random, method = "Shinichi") 
save(MA_maxabsES_random, file = "Rdata/MA_maxabsES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxabsES_random_VCV <- rma.mv(yi = d, V = VCV_max_absES, 
                         random = list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_absES, method = "REML")
summary(MA_maxabsES_random_VCV)
I2(MA_maxabsES_random_VCV, method = "Shinichi")
save(MA_maxabsES_random_VCV, file = "Rdata/MA_maxabsES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxabsES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_absES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES_random_VCV_phylo)   
I2(MA_maxabsES_random_VCV_phylo, method = "Shinichi")
save(MA_maxabsES_random_VCV_phylo, file = "Rdata/MA_maxabsES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxabsES <- rma.mv(yi=d, V=VCV_max_absES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES)    
I2(MA_maxabsES, method = "Shinichi") 
save(MA_maxabsES, file = "Rdata/MA_maxabsES.Rdata")

######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_maxabsES_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             data = dat_max_absES, method = "REML") 
summary(MA_maxabsES_nophylo)    
I2(MA_maxabsES_nophylo, method = "Shinichi") 
save(MA_maxabsES_nophylo, file = "Rdata/MA_maxabsES_nophylo.Rdata")

## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxabsES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxabsES = TRUE, data = dat_max_absES)
print(MA_maxabsES_robu) #0.35  
#save(MA_maxabsES_robu,file="Rdata/MA_maxabsES_robu.Rdata")

#robust metafor
MA_maxabsES_robust <- robust(MA_maxabsES, cluster = dat_max_absES$ExperimentID)
summary(MA_maxabsES_robust) #0.38  0.8  0.7
save(MA_maxabsES_robust,file = "Rdata/MA_maxabsES_robust.Rdata")
```

#### dat_max_absES - Species_Latin (Species model)

```{r MR dat_max_absES data - Species model, eval=TRUE, include=TRUE}
#with phylogeny
MR_maxabsES_species <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_species) # cow signif positive
save(MR_maxabsES_species, file = "Rdata/MR_maxabsES_species.Rdata")

#without phylogeny
MR_maxabsES_species_nophylo <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ScalePoint, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_absES, method="REML")
summary(MR_maxabsES_species_nophylo) # rat and cow
save(MR_maxabsES_species_nophylo, file = "Rdata/MR_maxabsES_species_nophylo.Rdata")
```

#####  dat_max_absES - Sex

```{r MR dat_max_absES - Sex}
MR_maxabsES_sex1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_sex1) 
save(MR_maxabsES_sex1, file = "Rdata/MR_maxabsES_sex1.Rdata")

MR_maxabsES_sex <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_sex) 
save(MR_maxabsES_sex, file = "Rdata/MR_maxabsES_sex.Rdata")

MR_maxabsES_sex2 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_sex2) 
save(MR_maxabsES_sex2, file = "Rdata/MR_maxabsES_sex2.Rdata")
```

#####  dat_max_absES - TaskType

```{r MR dat_max_absES - TaskType}
MR_maxabsES_TaskType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_TaskType1) 
save(MR_maxabsES_TaskType1, file = "Rdata/MR_maxabsES_TaskType1.Rdata")

MR_maxabsES_TaskType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_TaskType) 
save(MR_maxabsES_TaskType, file = "Rdata/MR_maxabsES_TaskType.Rdata")
```

#####  dat_max_absES - CueTypeCat

```{r MR dat_max_absES - CueTypeCat}
MR_maxabsES_CueTypeCat1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_CueTypeCat1)
save(MR_maxabsES_CueTypeCat1, file = "Rdata/MR_maxabsES_CueTypeCat1.Rdata")

MR_maxabsES_CueTypeCat_auditory <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_CueTypeCat_auditory)
save(MR_maxabsES_CueTypeCat_auditory, file = "Rdata/MR_maxabsES_CueTypeCat_auditory.Rdata")

MR_maxabsES_CueTypeCat_olfactory <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_CueTypeCat_olfactory)
save(MR_maxabsES_CueTypeCat_olfactory, file = "Rdata/MR_maxabsES_CueTypeCat_olfactory.Rdata")

MR_maxabsES_CueTypeCat_spatial <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_CueTypeCat_spatial) 
save(MR_maxabsES_CueTypeCat_spatial, file = "Rdata/MR_maxabsES_CueTypeCat_spatial.Rdata")

MR_maxabsES_CueTypeCat_tactile <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_CueTypeCat_tactile) 
save(MR_maxabsES_CueTypeCat_tactile, file = "Rdata/MR_maxabsES_CueTypeCat_tactile.Rdata")

MR_maxabsES_CueTypeCat_visual <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_CueTypeCat_visual)
save(MR_maxabsES_CueTypeCat_visual, file = "Rdata/MR_maxabsES_CueTypeCat_visual.Rdata")
```

#####  dat_max_absES - ReinforcementCat

```{r MR dat_max_absES - ReinforcementCat}
MR_maxabsES_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ReinforcementCat1) 
save(MR_maxabsES_ReinforcementCat1, file = "Rdata/MR_maxabsES_ReinforcementCat1.Rdata")

MR_maxabsES_ReinforcementCat <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ReinforcementCat) 
save(MR_maxabsES_ReinforcementCat, file = "Rdata/MR_maxabsES_ReinforcementCat.Rdata")

MR_maxabsES_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ReinforcementCat2) 
save(MR_maxabsES_ReinforcementCat2, file = "Rdata/MR_maxabsES_ReinforcementCat2.Rdata")
```

#####  dat_max_absES - AmbigReinforced

```{r MR dat_max_absES - AmbigReinforced}
MR_maxabsES_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_AmbigReinforced1) 
save(MR_maxabsES_AmbigReinforced1, file = "Rdata/MR_maxabsES_AmbigReinforced1.Rdata")

MR_maxabsES_AmbigReinforced <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_AmbigReinforced) 
save(MR_maxabsES_AmbigReinforced, file = "Rdata/MR_maxabsES_AmbigReinforced.Rdata")
```

#####  dat_max_absES - ScalePoint

```{r MR dat_max_absES - ScalePoint}
MR_maxabsES_ScalePoint1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ScalePoint1) 
save(MR_maxabsES_ScalePoint1, file = "Rdata/MR_maxabsES_ScalePoint1.Rdata")

MR_maxabsES_ScalePoint_P <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(ScalePoint, ref="P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ScalePoint_P) 
save(MR_maxabsES_ScalePoint_P, file = "Rdata/MR_maxabsES_ScalePoint_P.Rdata")

MR_maxabsES_ScalePoint_NP <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ScalePoint, ref="NP"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ScalePoint_NP) 
save(MR_maxabsES_ScalePoint_NP, file = "Rdata/MR_maxabsES_ScalePoint_NP.Rdata")

MR_maxabsES_ScalePoint_MID <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ScalePoint, ref="MID"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ScalePoint_MID) 
save(MR_maxabsES_ScalePoint_MID, file = "Rdata/MR_maxabsES_ScalePoint_MID.Rdata")

MR_maxabsES_ScalePoint_NN <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ScalePoint, ref="NN"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ScalePoint_NN)  
save(MR_maxabsES_ScalePoint_NN, file = "Rdata/MR_maxabsES_ScalePoint_NN.Rdata")

MR_maxabsES_ScalePoint_N <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ScalePoint, ref="N"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ScalePoint_N) 
save(MR_maxabsES_ScalePoint_N, file = "Rdata/MR_maxabsES_ScalePoint_N.Rdata")
```

#####  dat_max_absES - Source (Captive vs. Wild.caught)

```{r MR dat_max_absES - Captive_Wild.caught}
MR_maxabsES_source1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_source1) 
save(MR_maxabsES_source1, file = "Rdata/MR_maxabsES_source1.Rdata")

MR_maxabsES_source <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_source) 
save(MR_maxabsES_source, file = "Rdata/MR_maxabsES_source.Rdata")
```

#####  dat_max_absES - Age

```{r MR dat_max_absES - Age}
MR_maxabsES_age1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_age1) 
save(MR_maxabsES_age1, file = "Rdata/MR_maxabsES_age1.Rdata")

MR_maxabsES_age <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_age) 
save(MR_maxabsES_age, file = "Rdata/MR_maxabsES_age.Rdata")
```

#####  dat_max_absES - AffectManipCat

```{r MR dat_max_absES - AffectManipCat}
MR_maxabsES_AffectManipCat1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_AffectManipCat1) 
save(MR_maxabsES_AffectManipCat1, file = "Rdata/MR_maxabsES_AffectManipCat1.Rdata")

MR_maxabsES_AffectManipCat <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_AffectManipCat)
save(MR_maxabsES_AffectManipCat, file = "Rdata/MR_maxabsES_AffectManipCat.Rdata")
```


#####  dat_max_absES - AffectManipTiming

```{r MR dat_max_absES - AffectManipTiming}
MR_maxabsES_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_AffectManipTiming1) 
save(MR_maxabsES_AffectManipTiming1, file = "Rdata/MR_maxabsES_AffectManipTiming1.Rdata")

MR_maxabsES_AffectManipTiming <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_AffectManipTiming) 
save(MR_maxabsES_AffectManipTiming, file = "Rdata/MR_maxabsES_AffectManipTiming.Rdata")
```


#####  dat_max_absES - ComparisonCategory

```{r MR dat_max_absES - ComparisonCategory}
MR_maxabsES_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ComparisonCategory1)
save(MR_maxabsES_ComparisonCategory1, file = "Rdata/MR_maxabsES_ComparisonCategory1.Rdata")

MR_maxabsES_ComparisonCategory <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ComparisonCategory) 
save(MR_maxabsES_ComparisonCategory, file = "Rdata/MR_maxabsES_ComparisonCategory.Rdata")

MR_maxabsES_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_ComparisonCategory2)
save(MR_maxabsES_ComparisonCategory2, file = "Rdata/MR_maxabsES_ComparisonCategory2.Rdata")
```

#####  dat_max_absES - WithinBetween

```{r MR all data - WithinBetween}
MR_maxabsES_WithinBetween1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_WithinBetween1) 
save(MR_maxabsES_WithinBetween1, file = "Rdata/MR_maxabsES_WithinBetween1.Rdata")

MR_maxabsES_WithinBetween <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_WithinBetween) 
save(MR_maxabsES_WithinBetween, file = "Rdata/MR_maxabsES_WithinBetween.Rdata")
```

#####  dat_max_absES - FoodDeprived

```{r MR dat_max_absES - FoodDeprived}
MR_maxabsES_FoodDeprived1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_FoodDeprived1) 
save(MR_maxabsES_FoodDeprived1, file = "Rdata/MR_maxabsES_FoodDeprived1.Rdata")

MR_maxabsES_FoodDeprived <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_FoodDeprived) 
save(MR_maxabsES_FoodDeprived, file = "Rdata/MR_maxabsES_FoodDeprived.Rdata")
```

##### dat_max_absES - MeasureType

```{r MR dat_max_absES - MeasureType, eval=TRUE, include=TRUE}
MR_maxabsES_MeasureType <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType) 
save(MR_maxabsES_MeasureType, file = "Rdata/MR_maxabsES_MeasureType.Rdata")

#intercepts model
MR_maxabsES_MeasureType1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_MeasureType1) 
save(MR_maxabsES_MeasureType1, file = "Rdata/MR_maxabsES_MeasureType1.Rdata")
```

#####  dat_max_absES - Automated

```{r MR dat_max_absES - Automated}
MR_maxabsES_Automated1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_Automated1) # no signif intc yes / no
save(MR_maxabsES_Automated1, file = "Rdata/MR_maxabsES_Automated1.Rdata")

MR_maxabsES_Automated <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_Automated) # no signif diff yes / no
save(MR_maxabsES_Automated, file = "Rdata/MR_maxabsES_Automated.Rdata")
```

#####  dat_max_absES - Blind

```{r MR dat_max_absES - Blind}
MR_maxabsES_Blind1 <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_Blind1) # no signif intc yes / no
save(MR_maxabsES_Blind1, file = "Rdata/MR_maxabsES_Blind1.Rdata")

MR_maxabsES_Blind <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~relevel(dat_max_absES$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_Blind) # no signif diff yes / no
save(MR_maxabsES_Blind, file = "Rdata/MR_maxabsES_Blind.Rdata")
```


#### dat_max_absES - full model

```{r MR full model - max_abs_ES cues data subset, eval=FALSE, include=FALSE}
#dat_max_absES <- dplyr::filter(dat, biggest_ES == 1) #subset by picking ES with the biggest absolute value from each curve (i.e. get the most positive or negatve response available)
dim(dat_max_absES) #108

#full model
MR_Full_0_max_absES <- rma.mv(yi=d, V=VCV_max_absES, 
#                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_Full_0_max_absES) #all ns
R2(MR_Full_0_max_absES)
save(MR_Full_0_max_absES, file = "Rdata/MR_Full_0_max_absES.Rdata")
```



###################################   SUBSET 4  - using max_meanES   ################################## 
##### Max mean ES data subset (dat_max_meanES)
Subset of ES from each curve which has the biggest absolute value in the direction of the mean value of all ES from the curve (i.e. biggest in the overall direction of the overall response) 

#### dat_max_meanES - meta-analysis

```{r MA dat_max_meanES subset, eval=FALSE, include=FALSE} 

#NOTE: this data subset differs only by 13 data points from dat_max_absES data subset! (MA results are almost identical)
table(dat_max_meanES$d==dat_max_absES$d)

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxmeanES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_meanES, method="REML") 
summary(MA_maxmeanES_random) 
I2(MA_maxmeanES_random, method = "Shinichi") 
save(MA_maxmeanES_random, file = "Rdata/MA_maxmeanES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxmeanES_random_VCV <- rma.mv(yi = d, V = VCV_max_meanES, 
                         random = list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_meanES, method = "REML")
summary(MA_maxmeanES_random_VCV)
I2(MA_maxmeanES_random_VCV, method = "Shinichi")
save(MA_maxmeanES_random_VCV, file = "Rdata/MA_maxmeanES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxmeanES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_meanES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_meanES, method = "REML") 
summary(MA_maxmeanES_random_VCV_phylo)   
I2(MA_maxmeanES_random_VCV_phylo, method = "Shinichi")
save(MA_maxmeanES_random_VCV_phylo, file = "Rdata/MA_maxmeanES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxmeanES <- rma.mv(yi=d, V=VCV_max_meanES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_meanES, method = "REML") 
summary(MA_maxmeanES)    
I2(MA_maxmeanES, method = "Shinichi") 
save(MA_maxmeanES, file = "Rdata/MA_maxmeanES.Rdata")


## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxmeanES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxmeanES = TRUE, data = dat_max_meanES)
print(MA_maxmeanES_robu)
#save(MA_maxmeanES_robu,file="Rdata/MA_maxmeanES_robu.Rdata")

#robust metafor
MA_maxmeanES_robust <- robust(MA_maxmeanES, cluster = dat_max_meanES$ExperimentID)
summary(MA_maxmeanES_robust) #0.60  0.29  0.92
save(MA_maxmeanES_robust,file = "Rdata/MA_maxmeanES_robust.Rdata")
```

#### dat_max_meanES - Species_Latin (Species model)

```{r MR dat_max_meanES data - Species model, eval=FALSE, include=FALSE}
#with phylogeny
MR_maxmeanES_species <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_species) 
save(MR_maxmeanES_species, file = "Rdata/MR_maxmeanES_species.Rdata")

#without phylogeny
MR_maxmeanES_species_nophylo <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ArticleID, ~1|ScalePoint, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_species_nophylo)
save(MR_maxmeanES_species_nophylo, file = "Rdata/MR_maxmeanES_species_nophylo.Rdata")
```

#####  dat_max_meanES - Sex

```{r MR dat_max_meanES - Sex}
MR_maxmeanES_sex1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_sex1) 
save(MR_maxmeanES_sex1, file = "Rdata/MR_maxmeanES_sex1.Rdata")

MR_maxmeanES_sex <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_sex) 
save(MR_maxmeanES_sex, file = "Rdata/MR_maxmeanES_sex.Rdata")

MR_maxmeanES_sex2 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_sex2) 
save(MR_maxmeanES_sex2, file = "Rdata/MR_maxmeanES_sex2.Rdata")
```

#####  dat_max_meanES - TaskType

```{r MR dat_max_meanES - TaskType}
MR_maxmeanES_TaskType1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_TaskType1) 
save(MR_maxmeanES_TaskType1, file = "Rdata/MR_maxmeanES_TaskType1.Rdata")

MR_maxmeanES_TaskType <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_TaskType) 
save(MR_maxmeanES_TaskType, file = "Rdata/MR_maxmeanES_TaskType.Rdata")
```

#####  dat_max_meanES - CueTypeCat

```{r MR dat_max_meanES - CueTypeCat}
MR_maxmeanES_CueTypeCat1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_CueTypeCat1)
save(MR_maxmeanES_CueTypeCat1, file = "Rdata/MR_maxmeanES_CueTypeCat1.Rdata")

MR_maxmeanES_CueTypeCat_auditory <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_CueTypeCat_auditory)
save(MR_maxmeanES_CueTypeCat_auditory, file = "Rdata/MR_maxmeanES_CueTypeCat_auditory.Rdata")

MR_maxmeanES_CueTypeCat_olfactory <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_CueTypeCat_olfactory)
save(MR_maxmeanES_CueTypeCat_olfactory, file = "Rdata/MR_maxmeanES_CueTypeCat_olfactory.Rdata")

MR_maxmeanES_CueTypeCat_spatial <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_CueTypeCat_spatial) 
save(MR_maxmeanES_CueTypeCat_spatial, file = "Rdata/MR_maxmeanES_CueTypeCat_spatial.Rdata")

MR_maxmeanES_CueTypeCat_tactile <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_CueTypeCat_tactile) 
save(MR_maxmeanES_CueTypeCat_tactile, file = "Rdata/MR_maxmeanES_CueTypeCat_tactile.Rdata")

MR_maxmeanES_CueTypeCat_visual <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_CueTypeCat_visual)
save(MR_maxmeanES_CueTypeCat_visual, file = "Rdata/MR_maxmeanES_CueTypeCat_visual.Rdata")
```

#####  dat_max_meanES - ReinforcementCat

```{r MR dat_max_meanES - ReinforcementCat}
MR_maxmeanES_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ReinforcementCat1) 
save(MR_maxmeanES_ReinforcementCat1, file = "Rdata/MR_maxmeanES_ReinforcementCat1.Rdata")

MR_maxmeanES_ReinforcementCat <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ReinforcementCat) 
save(MR_maxmeanES_ReinforcementCat, file = "Rdata/MR_maxmeanES_ReinforcementCat.Rdata")

MR_maxmeanES_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ReinforcementCat2) 
save(MR_maxmeanES_ReinforcementCat2, file = "Rdata/MR_maxmeanES_ReinforcementCat2.Rdata")
```

#####  dat_max_meanES - AmbigReinforced

```{r MR dat_max_meanES - AmbigReinforced}
MR_maxmeanES_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_AmbigReinforced1) 
save(MR_maxmeanES_AmbigReinforced1, file = "Rdata/MR_maxmeanES_AmbigReinforced1.Rdata")

MR_maxmeanES_AmbigReinforced <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_AmbigReinforced) 
save(MR_maxmeanES_AmbigReinforced, file = "Rdata/MR_maxmeanES_AmbigReinforced.Rdata")
```

#####  dat_max_meanES - ScalePoint

```{r MR dat_max_meanES - ScalePoint}
MR_maxmeanES_ScalePoint1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ScalePoint1) 
save(MR_maxmeanES_ScalePoint1, file = "Rdata/MR_maxmeanES_ScalePoint1.Rdata")

MR_maxmeanES_ScalePoint_P <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(ScalePoint, ref="P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ScalePoint_P) 
save(MR_maxmeanES_ScalePoint_P, file = "Rdata/MR_maxmeanES_ScalePoint_P.Rdata")

MR_maxmeanES_ScalePoint_NP <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ScalePoint, ref="NP"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ScalePoint_NP) 
save(MR_maxmeanES_ScalePoint_NP, file = "Rdata/MR_maxmeanES_ScalePoint_NP.Rdata")

MR_maxmeanES_ScalePoint_MID <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ScalePoint, ref="MID"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ScalePoint_MID) 
save(MR_maxmeanES_ScalePoint_MID, file = "Rdata/MR_maxmeanES_ScalePoint_MID.Rdata")

MR_maxmeanES_ScalePoint_NN <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ScalePoint, ref="NN"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ScalePoint_NN)  
save(MR_maxmeanES_ScalePoint_NN, file = "Rdata/MR_maxmeanES_ScalePoint_NN.Rdata")

MR_maxmeanES_ScalePoint_N <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ScalePoint, ref="N"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ScalePoint_N) 
save(MR_maxmeanES_ScalePoint_N, file = "Rdata/MR_maxmeanES_ScalePoint_N.Rdata")
```

#####  dat_max_meanES - Source (Captive vs. Wild.caught)

```{r MR dat_max_meanES - Captive_Wild.caught}
MR_maxmeanES_source1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_source1) 
save(MR_maxmeanES_source1, file = "Rdata/MR_maxmeanES_source1.Rdata")

MR_maxmeanES_source <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_source) 
save(MR_maxmeanES_source, file = "Rdata/MR_maxmeanES_source.Rdata")
```

#####  dat_max_meanES - Age

```{r MR dat_max_meanES - Age}
MR_maxmeanES_age1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_age1) 
save(MR_maxmeanES_age1, file = "Rdata/MR_maxmeanES_age1.Rdata")

MR_maxmeanES_age <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_age) 
save(MR_maxmeanES_age, file = "Rdata/MR_maxmeanES_age.Rdata")
```

#####  dat_max_meanES - AffectManipCat

```{r MR dat_max_meanES - AffectManipCat}
MR_maxmeanES_AffectManipCat1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_AffectManipCat1) 
save(MR_maxmeanES_AffectManipCat1, file = "Rdata/MR_maxmeanES_AffectManipCat1.Rdata")

MR_maxmeanES_AffectManipCat <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_AffectManipCat)
save(MR_maxmeanES_AffectManipCat, file = "Rdata/MR_maxmeanES_AffectManipCat.Rdata")
```

#####  dat_max_meanES - AffectManipTiming

```{r MR dat_max_meanES - AffectManipTiming}
MR_maxmeanES_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_AffectManipTiming1) 
save(MR_maxmeanES_AffectManipTiming1, file = "Rdata/MR_maxmeanES_AffectManipTiming1.Rdata")

MR_maxmeanES_AffectManipTiming <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_AffectManipTiming) 
save(MR_maxmeanES_AffectManipTiming, file = "Rdata/MR_maxmeanES_AffectManipTiming.Rdata")
```

#####  dat_max_meanES - ComparisonCategory

```{r MR dat_max_meanES - ComparisonCategory}
MR_maxmeanES_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ComparisonCategory1)
save(MR_maxmeanES_ComparisonCategory1, file = "Rdata/MR_maxmeanES_ComparisonCategory1.Rdata")

MR_maxmeanES_ComparisonCategory <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ComparisonCategory) 
save(MR_maxmeanES_ComparisonCategory, file = "Rdata/MR_maxmeanES_ComparisonCategory.Rdata")

MR_maxmeanES_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_ComparisonCategory2)
save(MR_maxmeanES_ComparisonCategory2, file = "Rdata/MR_maxmeanES_ComparisonCategory2.Rdata")
```

#####  dat_max_meanES - WithinBetween

```{r MR all data - WithinBetween}
MR_maxmeanES_WithinBetween1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_WithinBetween1) 
save(MR_maxmeanES_WithinBetween1, file = "Rdata/MR_maxmeanES_WithinBetween1.Rdata")

MR_maxmeanES_WithinBetween <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_WithinBetween) 
save(MR_maxmeanES_WithinBetween, file = "Rdata/MR_maxmeanES_WithinBetween.Rdata")
```

#####  dat_max_meanES - FoodDeprived

```{r MR dat_max_meanES - FoodDeprived}
MR_maxmeanES_FoodDeprived1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_FoodDeprived1) 
save(MR_maxmeanES_FoodDeprived1, file = "Rdata/MR_maxmeanES_FoodDeprived1.Rdata")

MR_maxmeanES_FoodDeprived <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_FoodDeprived) 
save(MR_maxmeanES_FoodDeprived, file = "Rdata/MR_maxmeanES_FoodDeprived.Rdata")
```

##### dat_max_meanES - MeasureType

```{r MR dat_max_meanES - MeasureType, eval=TRUE, include=TRUE}
MR_maxmeanES_MeasureType <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType) 
save(MR_maxmeanES_MeasureType, file = "Rdata/MR_maxmeanES_MeasureType.Rdata")

#intercepts model
MR_maxmeanES_MeasureType1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_MeasureType1) 
save(MR_maxmeanES_MeasureType1, file = "Rdata/MR_maxmeanES_MeasureType1.Rdata")
```

#####  dat_max_meanES - Automated

```{r MR dat_max_meanES - Automated}
MR_maxmeanES_Automated1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_Automated1) # no signif intc yes / no
save(MR_maxmeanES_Automated1, file = "Rdata/MR_maxmeanES_Automated1.Rdata")

MR_maxmeanES_Automated <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_Automated) # no signif diff yes / no
save(MR_maxmeanES_Automated, file = "Rdata/MR_maxmeanES_Automated.Rdata")
```

#####  dat_max_meanES - Blind

```{r MR dat_max_meanES - Blind}
MR_maxmeanES_Blind1 <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_Blind1) # no signif intc yes / no
save(MR_maxmeanES_Blind1, file = "Rdata/MR_maxmeanES_Blind1.Rdata")

MR_maxmeanES_Blind <- rma.mv(yi=d, V=VCV_max_meanES, 
                     mod = ~relevel(dat_max_meanES$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_maxmeanES_Blind) # no signif diff yes / no
save(MR_maxmeanES_Blind, file = "Rdata/MR_maxmeanES_Blind.Rdata")
```


#### dat_max_meanES - full model

```{r MR full model - max_meanES cues data subset, eval=FALSE, include=FALSE}
#dat_max_meanES <- dplyr::filter(dat, biggest_meandir == 1) #subset by picking ES from each curve which has the biggest absolute value in the direction of the mean value of all ES from the curve (i.e. biggest in the overall direction of the response)
dim(dat_max_meanES) #108

#full model
MR_Full_0_max_meanES <- rma.mv(yi=d, V=VCV_max_meanES, 
#                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_meanES, method="REML") 
summary(MR_Full_0_max_meanES) #all ns
R2(MR_Full_0_max_meanES)
save(MR_Full_0_max_meanES, file = "Rdata/MR_Full_0_max_meanES.Rdata")
```



###################################   SUBSET 5  - using max_ES   ################################## 
### Max ES data subset (dat_max_ES)   
Subset of maximum ES from each curve (i.e. get the most positive=optimistic response available)    


#### dat_max_ES - meta-analysis

```{r MA dat_max_ES subset, eval=FALSE, include=FALSE} 

######## random-effect model (no VCV matrix, no phylogeny)
MA_maxES_random <- rma.mv(yi=d, V=Vd, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_ES, method="REML") 
summary(MA_maxES_random) 
I2(MA_maxES_random, method = "Shinichi") 
save(MA_maxES_random, file = "Rdata/MA_maxES_random.Rdata")


######## random-effect model as above with VCV matrix (no phylogeny)
MA_maxES_random_VCV <- rma.mv(yi = d, V = VCV_max_ES, 
                         random = list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                         data = dat_max_ES, method = "REML") #not converging
summary(MA_maxES_random_VCV)
I2(MA_maxES_random_VCV, method = "Shinichi")
save(MA_maxES_random_VCV, file = "Rdata/MA_maxES_random_VCV.Rdata")


######## random-effect model with VCV, phylogeny (Species_Latin) and species identity (ScientificName)
MA_maxES_random_VCV_phylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ScientificName, ~1|ArticleID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES_random_VCV_phylo)   
I2(MA_maxES_random_VCV_phylo, method = "Shinichi") 
save(MA_maxES_random_VCV_phylo, file = "Rdata/MA_maxES_random_VCV_phylo.Rdata")


######## random-effect model with VCV and phylogeny (Species_Latin), removed non-contibuting random effects
MA_maxES <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                             R = list(Species_Latin = CorMatrix_all),
                             data = dat_max_ES, method = "REML")  #not converging
summary(MA_maxES)    
I2(MA_maxES, method = "Shinichi") 
save(MA_maxES, file = "Rdata/MA_maxES.Rdata")

######## random-effect model with VCV and no phylogeny and no species, removed non-contibuting random effects
MA_maxES_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                             random=list(~1|ArticleID, ~1|ScalePoint, ~1|ExperimentID, ~1|EffectID),
                             data = dat_max_ES, method = "REML") 
summary(MA_maxES_nophylo)    
I2(MA_maxES_nophylo, method = "Shinichi")
save(MA_maxES_nophylo, file = "Rdata/MA_maxES_nophylo.Rdata")

## Robust meta-analytic models:

#robumeta (without phylogeny and VCV)
MA_maxES_robu <- robu(formula = d ~ 1, var.eff.size = Vd, studynum = ExperimentID,  modelweights = "HIER", smmaxES = TRUE, data = dat_max_ES)
print(MA_maxES_robu) #0.54  0.4    0.7
#save(MA_maxES_robu,file="Rdata/MA_maxES_robu.Rdata")

#robust metafor
MA_maxES_robust <- robust(MA_maxES, cluster = dat_max_ES$ExperimentID)
summary(MA_maxES_robust) #0.54  0.4  0.7
save(MA_maxES_robust,file = "Rdata/MA_maxES_robust.Rdata")
```

#### dat_max_ES - Species_Latin (Species model)

```{r MR dat_max_ES data - Species model, eval=FALSE, include=FALSE}
#with phylogeny
MR_maxES_species <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_species) # bee, cow - signif positive
save(MR_maxES_species, file = "Rdata/MR_maxES_species.Rdata")

#without phylogeny
MR_maxES_species_nophylo <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScientificName -1, 
                     random=list(~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_species_nophylo) # some species with clear effect, when phylogeny not taken into account
save(MR_maxES_species_nophylo, file = "Rdata/MR_maxES_species_nophylo.Rdata")
```

#####  dat_max_ES - Sex

```{r MR dat_max_ES - Sex}
MR_maxES_sex1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~Sex -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_sex1) 
save(MR_maxES_sex1, file = "Rdata/MR_maxES_sex1.Rdata")

MR_maxES_sex <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$Sex, ref="female"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_sex) 
save(MR_maxES_sex, file = "Rdata/MR_maxES_sex.Rdata")

MR_maxES_sex2 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$Sex, ref="male"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_sex2) 
save(MR_maxES_sex2, file = "Rdata/MR_maxES_sex2.Rdata")
```

#####  dat_max_ES - TaskType

```{r MR dat_max_ES - TaskType}
MR_maxES_TaskType1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~TaskType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_TaskType1) 
save(MR_maxES_TaskType1, file = "Rdata/MR_maxES_TaskType1.Rdata")

MR_maxES_TaskType <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$TaskType, ref="active choice"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_TaskType) 
save(MR_maxES_TaskType, file = "Rdata/MR_maxES_TaskType.Rdata")
```

#####  dat_max_ES - CueTypeCat

```{r MR dat_max_ES - CueTypeCat}
MR_maxES_CueTypeCat1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~CueTypeCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_CueTypeCat1)
save(MR_maxES_CueTypeCat1, file = "Rdata/MR_maxES_CueTypeCat1.Rdata")

MR_maxES_CueTypeCat_auditory <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$CueTypeCat, ref="auditory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_CueTypeCat_auditory)
save(MR_maxES_CueTypeCat_auditory, file = "Rdata/MR_maxES_CueTypeCat_auditory.Rdata")

MR_maxES_CueTypeCat_olfactory <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$CueTypeCat, ref="olfactory"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_CueTypeCat_olfactory)
save(MR_maxES_CueTypeCat_olfactory, file = "Rdata/MR_maxES_CueTypeCat_olfactory.Rdata")

MR_maxES_CueTypeCat_spatial <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$CueTypeCat, ref="spatial"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_CueTypeCat_spatial) 
save(MR_maxES_CueTypeCat_spatial, file = "Rdata/MR_maxES_CueTypeCat_spatial.Rdata")

MR_maxES_CueTypeCat_tactile <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$CueTypeCat, ref="tactile"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_CueTypeCat_tactile) 
save(MR_maxES_CueTypeCat_tactile, file = "Rdata/MR_maxES_CueTypeCat_tactile.Rdata")

MR_maxES_CueTypeCat_visual <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$CueTypeCat, ref="visual"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_CueTypeCat_visual)
save(MR_maxES_CueTypeCat_visual, file = "Rdata/MR_maxES_CueTypeCat_visual.Rdata")
```

#####  dat_max_ES - ReinforcementCat

```{r MR dat_max_ES - ReinforcementCat}
MR_maxES_ReinforcementCat1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ReinforcementCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ReinforcementCat1) 
save(MR_maxES_ReinforcementCat1, file = "Rdata/MR_maxES_ReinforcementCat1.Rdata")

MR_maxES_ReinforcementCat <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ReinforcementCat, ref="R-Null"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ReinforcementCat) 
save(MR_maxES_ReinforcementCat, file = "Rdata/MR_maxES_ReinforcementCat.Rdata")

MR_maxES_ReinforcementCat2 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ReinforcementCat, ref="R-P"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ReinforcementCat2) 
save(MR_maxES_ReinforcementCat2, file = "Rdata/MR_maxES_ReinforcementCat2.Rdata")
```

#####  dat_max_ES - AmbigReinforced

```{r MR dat_max_ES - AmbigReinforced}
MR_maxES_AmbigReinforced1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~AmbigReinforced -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_AmbigReinforced1) 
save(MR_maxES_AmbigReinforced1, file = "Rdata/MR_maxES_AmbigReinforced1.Rdata")

MR_maxES_AmbigReinforced <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$AmbigReinforced, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_AmbigReinforced) 
save(MR_maxES_AmbigReinforced, file = "Rdata/MR_maxES_AmbigReinforced.Rdata")
```

#####  dat_max_ES - ScalePoint

```{r MR dat_max_ES - ScalePoint}
MR_maxES_ScalePoint1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ScalePoint -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ScalePoint1) 
save(MR_maxES_ScalePoint1, file = "Rdata/MR_maxES_ScalePoint1.Rdata")

MR_maxES_ScalePoint_P <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(ScalePoint, ref="P"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ScalePoint_P) 
save(MR_maxES_ScalePoint_P, file = "Rdata/MR_maxES_ScalePoint_P.Rdata")

MR_maxES_ScalePoint_NP <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ScalePoint, ref="NP"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ScalePoint_NP) 
save(MR_maxES_ScalePoint_NP, file = "Rdata/MR_maxES_ScalePoint_NP.Rdata")

MR_maxES_ScalePoint_MID <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ScalePoint, ref="MID"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ScalePoint_MID) 
save(MR_maxES_ScalePoint_MID, file = "Rdata/MR_maxES_ScalePoint_MID.Rdata")

MR_maxES_ScalePoint_NN <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ScalePoint, ref="NN"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ScalePoint_NN)  
save(MR_maxES_ScalePoint_NN, file = "Rdata/MR_maxES_ScalePoint_NN.Rdata")

MR_maxES_ScalePoint_N <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ScalePoint, ref="N"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ScalePoint_N) 
save(MR_maxES_ScalePoint_N, file = "Rdata/MR_maxES_ScalePoint_N.Rdata")
```

#####  dat_max_ES - Source (Captive vs. Wild.caught)

```{r MR dat_max_ES - Captive_Wild.caught}
MR_maxES_source1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~Captive_Wild.caught -1, 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") #removed  ~1|ScalePoint due to lack of convegence
summary(MR_maxES_source1) 
save(MR_maxES_source1, file = "Rdata/MR_maxES_source1.Rdata")

MR_maxES_source <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$Captive_Wild.caught, ref="captive"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") #removed  ~1|ScalePoint due to lack of convegence
summary(MR_maxES_source) 
save(MR_maxES_source, file = "Rdata/MR_maxES_source.Rdata")
```

#####  dat_max_ES - Age

```{r MR dat_max_ES - Age}
MR_maxES_age1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~Age -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_age1) 
save(MR_maxES_age1, file = "Rdata/MR_maxES_age1.Rdata")

MR_maxES_age <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$Age, ref="adult"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_age) 
save(MR_maxES_age, file = "Rdata/MR_maxES_age.Rdata")
```

#####  dat_max_ES - AffectManipCat

```{r MR dat_max_ES - AffectManipCat}
MR_maxES_AffectManipCat1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~AffectManipCat -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_AffectManipCat1) 
save(MR_maxES_AffectManipCat1, file = "Rdata/MR_maxES_AffectManipCat1.Rdata")

MR_maxES_AffectManipCat <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$AffectManipCat, ref="enrichment"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_AffectManipCat)
save(MR_maxES_AffectManipCat, file = "Rdata/MR_maxES_AffectManipCat.Rdata")
```

#####  dat_max_ES - AffectManipTiming

```{r MR dat_max_ES - AffectManipTiming}
MR_maxES_AffectManipTiming1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~AffectManipTiming -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_AffectManipTiming1) 
save(MR_maxES_AffectManipTiming1, file = "Rdata/MR_maxES_AffectManipTiming1.Rdata")

MR_maxES_AffectManipTiming <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$AffectManipTiming, ref="before/during"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_AffectManipTiming) 
save(MR_maxES_AffectManipTiming, file = "Rdata/MR_maxES_AffectManipTiming.Rdata")
```

#####  dat_max_ES - ComparisonCategory

```{r MR dat_max_ES - ComparisonCategory}
MR_maxES_ComparisonCategory1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~ComparisonCategory -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ComparisonCategory1)
save(MR_maxES_ComparisonCategory1, file = "Rdata/MR_maxES_ComparisonCategory1.Rdata")

MR_maxES_ComparisonCategory <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ComparisonCategory, ref="Benign-Worse"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_ComparisonCategory) 
save(MR_maxES_ComparisonCategory, file = "Rdata/MR_maxES_ComparisonCategory.Rdata")

MR_maxES_ComparisonCategory2 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$ComparisonCategory, ref="Better-Benign"), 
                     random=list(~1|Species_Latin, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") #removed  ~1|ScalePoint due to lack of convegence
summary(MR_maxES_ComparisonCategory2)
save(MR_maxES_ComparisonCategory2, file = "Rdata/MR_maxES_ComparisonCategory2.Rdata")
```

#####  dat_max_ES - WithinBetween

```{r MR all data - WithinBetween}
MR_maxES_WithinBetween1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~WithinBetween -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_WithinBetween1) 
save(MR_maxES_WithinBetween1, file = "Rdata/MR_maxES_WithinBetween1.Rdata")

MR_maxES_WithinBetween <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$WithinBetween, ref="within"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint,  ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_WithinBetween) 
save(MR_maxES_WithinBetween, file = "Rdata/MR_maxES_WithinBetween.Rdata")
```

#####  dat_max_ES - FoodDeprived

```{r MR dat_max_ES - FoodDeprived}
MR_maxES_FoodDeprived1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~FoodDeprived -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_FoodDeprived1) 
save(MR_maxES_FoodDeprived1, file = "Rdata/MR_maxES_FoodDeprived1.Rdata")

MR_maxES_FoodDeprived <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$FoodDeprived, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_FoodDeprived) 
save(MR_maxES_FoodDeprived, file = "Rdata/MR_maxES_FoodDeprived.Rdata")
```

##### dat_max_ES - MeasureType

```{r MR dat_max_ES - MeasureType, eval=TRUE, include=TRUE}
MR_maxES_MeasureType <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$MeasureType, ref="latency"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType) 
save(MR_maxES_MeasureType, file = "Rdata/MR_maxES_MeasureType.Rdata")

#intercepts model
MR_maxES_MeasureType1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~MeasureType -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_MeasureType1) 
save(MR_maxES_MeasureType1, file = "Rdata/MR_maxES_MeasureType1.Rdata")
```

#####  dat_max_ES - Automated

```{r MR dat_max_ES - Automated}
MR_maxES_Automated1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~Automated -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_Automated1) # no signif intc yes / no
save(MR_maxES_Automated1, file = "Rdata/MR_maxES_Automated1.Rdata")

MR_maxES_Automated <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$Automated, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_Automated) # no signif diff yes / no
save(MR_maxES_Automated, file = "Rdata/MR_maxES_Automated.Rdata")
```

#####  dat_max_ES - Blind

```{r MR dat_max_ES - Blind}
MR_maxES_Blind1 <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~Blind -1, 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_Blind1) # no signif intc yes / no
save(MR_maxES_Blind1, file = "Rdata/MR_maxES_Blind1.Rdata")

MR_maxES_Blind <- rma.mv(yi=d, V=VCV_max_ES, 
                     mod = ~relevel(dat_max_ES$Blind, ref="yes"), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_maxES_Blind) # no signif diff yes / no
save(MR_maxES_Blind, file = "Rdata/MR_maxES_Blind.Rdata")
```


#### dat_max_ES - full model

```{r MR full model - max_ES cues data subset, eval=FALSE, include=FALSE}
#dat_max_ES <- dplyr::filter(dat, max_ES == 1) #subset by picking maximum ES from each curve (i.e. get the most positive=optimistic response available)
dim(dat_max_ES) #108

#full model
MR_Full_0_max_ES <- rma.mv(yi=d, V=VCV_max_ES, 
#                     mod = ~Sex + Age + Captive_Wild.caught + AffectManipCat + AffectManipTiming + ComparisonCategory + CueTypeCat + FoodDeprived + TaskType + WithinBetween + Automated + Blind  + ReinforcementCat + AmbigReinforced + ScalePoint, 
                     mod = ~Sex + TaskType + CueTypeCat + ReinforcementCat, 
#                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), #not converging
                    random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_ES, method="REML") 
summary(MR_Full_0_max_ES) #olfactory signif
R2(MR_Full_0_max_ES)
save(MR_Full_0_max_ES, file = "Rdata/MR_Full_0_max_ES.Rdata")
```






###############################################################################################################
########################################         PUBLICATION BIAS       ####################################### 
###############################################################################################################

## Egger's test and calculating RESIDUALS for the final funnel plot

Checking the intercepts of Eggers regressions performed on the model residuals and measurement errors.
Evidence for publication bias if the intercept is significantly different from 0.

```{r funnel plot - full model, eval=FALSE, include=FALSE}
#pdf(file="Fig_funnel_alldata.pdf",width=6,height=4,pointsize=10)
par(mfcol=c(1,1)) 
par(mar=c(4,4,2,1))
#### raw data
#plot(dat$d, sqrt(1/dat$Vd), xlim=c(-8,8), xlab = "Effect size [Hd]", ylab="Precision [1/SE]", main="")
#abline(v=0,lty=3)
### full model - all data
funnel(MR_Full_0, yaxis = "seinv", level=c(90, 95, 99), shade=c("white", "gray55", "gray75"), refline=0, legend=TRUE)
#dev.off()
```


```{ Egger's regression}
#load(file = "./Rdata/MR_Full_0.Rdata")

Residuals <- residuals(MR_Full_0) 
Precision <- sqrt(1/MR_Full_0$vi) 
PB_model <- rma(yi=Residuals, sei=1/Precision) 
summary(PB_model)
#funnel(PB_model, yaxi="seinv")

# Egger's regression test and ranktest for funnel plot asymmetry: 
res_regtest <- regtest(PB_model, model="lm") #t = 0.1708, df = 457, p = 0.8645
# use: res_regtest$zval res_regtest$dfs res_regtest$pval

res_ranktest <- ranktest(PB_model) #endall's tau = 0.0575 p = NA, for MR_Full_0 tau = 0.0299, p = NA
res_ranktest$pval

save(PB_model, file = "Rdata/PB_model.Rdata")
```

## trim and fill and # Egger's regression test

```{r publ bias tests trim and fill Egger, eval=FALSE, include=FALSE }
######## random-effect MA model:
res_MA <- rma.mv(yi=d, V=Vd, random=list(~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID), data=dat, method="REML") 
summary(res_MA) ### estimate  0.2239  CI  0.0913  0.3564  *** 

Residuals <- residuals(res_MA) # try MR_Full_0
Precision <- sqrt(1/res_MA$vi) #try MR_Full_0

PB_model <- rma(yi=Residuals, sei=1/Precision) 
summary(PB_model)
funnel(PB_model, yaxi="seinv")
# Trim and fill
TF <- trimfill(PB_model)
TF #Estimated number of missing studies on the left side: 51 (SE = 13.7423)
funnel(TF, yaxi="seinv")

# Egger's regression test
regtest(PB_model, model="lm") #test for funnel plot asymmetry: t = 0.5683, df = 457, p = 0.5701, for MR_Full_0 t = 0.1708, df = 457, p = 0.8645
ranktest(PB_model) #endall's tau = 0.0575 p = NA, for MR_Full_0 tau = 0.0299, p = NA

# do not use:
#pdf(file="plots/Fig_funnels_preliminary.pdf",width=7,height=3,pointsize=14)
par(mfrow=c(1,2))
par(mar=c(4,4,4,1))
plot(dat$d, sqrt(1/dat$Vd), xlim=c(-10,10), ylim=c(0,7), xlab = "effect size [Hd]", ylab="Precision [1/SE]", frame.plot=FALSE, main="A")
abline(v=0,lty=3)
abline(v=0.168,lty=1)
funnel(TF, xlim=c(-3,3), xlab = "effect size [Hd]", ylab="Standard Error [SE]",
       back="white", shade="lightgray", bg="red", main="B")
abline(v=0,lty=3)
plot(Residuals, Precision, xlim=c(-10,10), ylim=c(0,7), xlab = "Residuals", ylab="Precision [1/SE]", frame.plot=FALSE, main="C")
abline(v=0,lty=3)
#dev.off()
```


### Time-lag bias (univariate MR)

```{r time-lag bias, eval=FALSE, include=FLASE}

### full data set
MR_all_Year <- rma.mv(yi=d, V=VCV, 
                     mod = ~scale(Year), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_all_Year) # no signif slope
save(MR_all_Year, file = "./Rdata/MR_all_Year.Rdata")

# getting marginal R2
#r2_MR_all_Year <- R2(MR_all_Year)
# getting estimates: name does not work for slopes
#res_MR_all_Year <- get_est(MR_all_Year, mod = "Year")
# creating a knittable table
# tibble(
#   `Fixed effect` = c("Intercept", "Year"),
#   Estimate = c(res_time_lag_effect_uni$estimate),
#   `Lower CI [0.025]` = c(res_time_lag_effect_uni$lowerCL),
#   `Upper CI  [0.975]` = c(res_time_lag_effect_uni$upperCL),
#   `V[authors]` = c(time_lag_effect_uni$sigma2, NA),
#   `R2` = c(r2_time_lag_effect_uni[1], NA)) %>% kable("html", digits = 3) %>%
#   kable_styling("striped", position = "left")

### ambiguous cues data subset

MR_amb_Year <- rma.mv(yi=d, V=VCV_dat_amb, 
                     mod = ~scale(Year), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_amb, method="REML") 
summary(MR_amb_Year) # no signif slope
save(MR_amb_Year, file = "./Rdata/MR_amb_Year.Rdata")


### MID cues data subset

MR_MID_Year <- rma.mv(yi=d, V=VCV_MID_ES, 
                     mod = ~~scale(Year), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_MID_ES, method="REML") 
summary(MR_MID_Year) # no signif slope
save(MR_MID_Year, file = "./Rdata/MR_MID_Year.Rdata")


### maxabsES cues data subset

MR_maxabsES_Year <- rma.mv(yi=d, V=VCV_max_absES, 
                     mod = ~scale(Year), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat_max_absES, method="REML") 
summary(MR_maxabsES_Year) # no signif slope
save(MR_maxabsES_Year, file = "./Rdata/MR_maxabsES_Year.Rdata")


### maxmeanES cues data subset

MR_maxmeanES_Year <- rma.mv(yi=d, V=VCV, 
                     mod = ~scale(Year), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_maxmeanES_Year) # no signif slope
save(MR_maxmeanES_Year, file = "./Rdata/MR_maxmeanES_Year.Rdata")


### maxES cues data subset

MR_maxES_Year <- rma.mv(yi=d, V=VCV, 
                     mod = ~scale(Year), 
                     random=list(~1|Species_Latin, ~1|ScalePoint, ~1|ArticleID, ~1|ExperimentID, ~1|EffectID),
                     R = list(Species_Latin = CorMatrix_all), 
                     data = dat, method="REML") 
summary(MR_maxES_Year) # no signif slope
save(MR_maxES_Year, file = "./Rdata/MR_maxES_Year.Rdata")
```

